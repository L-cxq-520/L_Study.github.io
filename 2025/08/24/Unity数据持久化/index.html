<!DOCTYPE html>
<html lang="zh-Hans">

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
<meta name="x5-fullscreen" content="true">
<meta name="full-screen" content="yes">
<meta name="theme-color" content="#317EFB" />
<meta content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=0" name="viewport">
<meta name="description" content="Unity数据持久化 数据持久化就是将内存中的数据模型转换为存储模型，以及将存储模型转换为内存中的数据模型的统称。 说人话：将游戏数据存储到硬盘，硬盘中数据读取到游戏中，也就是传统意义上的存盘。  PlayerPrefsPlayerPrefs基础知识概述基本方法PlayerPrefs是什么？  PlayerPrefs是Unity提供的可以用于存储读取玩家数据的公共类。  存储相关 PlayerPr">
<meta property="og:type" content="article">
<meta property="og:title" content="Unity数据持久化">
<meta property="og:url" content="https://l-cxq-520.github.io/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="Unity数据持久化 数据持久化就是将内存中的数据模型转换为存储模型，以及将存储模型转换为内存中的数据模型的统称。 说人话：将游戏数据存储到硬盘，硬盘中数据读取到游戏中，也就是传统意义上的存盘。  PlayerPrefsPlayerPrefs基础知识概述基本方法PlayerPrefs是什么？  PlayerPrefs是Unity提供的可以用于存储读取玩家数据的公共类。  存储相关 PlayerPr">
<meta property="og:locale">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="og:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">
<meta property="article:published_time" content="2025-08-24T15:01:59.000Z">
<meta property="article:modified_time" content="2025-08-26T15:22:35.718Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="游戏引擎">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://l-cxq-520.github.io/L_Study.github.io/img/404.jpg">


<title >Unity数据持久化</title>

<!-- Favicon -->

    <link href='/L_Study.github.io/img/favicon.svg?v=2.2.4' rel='icon' type='image/png' sizes='16x16' ></link>


    <link href='/L_Study.github.io/img/favicon.svg?v=2.2.4' rel='icon' type='image/png' sizes='32x32' ></link>




<!-- Plugin -->




    
<link rel="stylesheet" href="/L_Study.github.io/css/plugins/bootstrap.row.css">

    
<link rel="stylesheet" href="https://unpkg.com/@fancyapps/ui@4.0/dist/fancybox.css">

    
    




<!-- Icon -->

    
<link rel="stylesheet" href="/L_Study.github.io/css/plugins/font-awesome.min.css">




<!-- Variable -->
<script>window.ASYNC_CONFIG = {"hostname":"l-cxq-520.github.io","author":"John Doe","root":"/L_Study.github.io/","typed_text":["Web Developer"],"theme_version":"2.2.4","theme":{"switch":true,"default":"style-light"},"favicon":{"logo":"/img/favicon.svg","icon16":"/img/favicon.svg","icon32":"/img/favicon.svg","apple_touch_icon":null,"webmanifest":null,"visibilitychange":false,"hidden":"/failure.ico","show_text":"(/≧▽≦/)咦！又好了！","hide_text":"(●—●)喔哟，崩溃啦！"},"i18n":{"placeholder":"搜索文章...","empty":"找不到您查询的内容: ${query}","hits":"找到 ${hits} 条结果","hits_time":"找到 ${hits} 条结果（用时 ${time} 毫秒）","author":"本文作者：","copyright_link":"本文链接：","copyright_license_title":"版权声明：","copyright_license_content":"本博客所有文章除特别声明外，均默认采用 undefined 许可协议。","copy_success":"复制成功","copy_failure":"复制失败","open_read_mode":"进入阅读模式","exit_read_mode":"退出阅读模式","notice_outdate_message":"距离上次更新已经 undefined 天了, 文章内容可能已经过时。","sticky":"置顶","just":"刚刚","min":"分钟前","hour":"小时前","day":"天前","month":"个月前"},"swup":false,"plugin":{"flickr_justified_gallery":"https://unpkg.com/flickr-justified-gallery@latest/dist/fjGallery.min.js"},"icons":{"sun":"far fa-sun","moon":"far fa-moon","play":"fas fa-play","email":"far fa-envelope","next":"fas fa-arrow-right","calendar":"far fa-calendar-alt","clock":"far fa-clock","user":"far fa-user","back_top":"fas fa-arrow-up","close":"fas fa-times","search":"fas fa-search","reward":"fas fa-hand-holding-usd","toc_tag":"fas fa-th-list","read":"fas fa-book-reader","arrows":"fas fa-arrows-alt-h","double_arrows":"fas fa-angle-double-down","copy":"fas fa-copy"},"icontype":"font","highlight":{"plugin":"highlighjs","theme":true,"copy":true,"lang":true,"title":"default","height_limit":200},"toc":{"post_title":false},"live_time":{"start_time":"","prefix":"博客已萌萌哒运行 undefined 天"},"danmu":{"enable":false,"el":".trm-banner"}};</script>
<script id="async-page-config">window.PAGE_CONFIG = {"isPost":true,"isHome":false,"postUpdate":"2025-08-26 23:22:35"};</script>

<!-- Theme mode css -->
<link data-swup-theme rel="stylesheet" href="/L_Study.github.io/css/index.css?v=2.2.4" id="trm-switch-style">
<script>
    let defaultMode = ASYNC_CONFIG.theme.default !=='auto' ?  ASYNC_CONFIG.theme.default : (window.matchMedia("(prefers-color-scheme: light)").matches ? 'style-light' : 'style-dark')
    let catchMode = localStorage.getItem('theme-mode') || defaultMode;
    let type = catchMode === 'style-dark' ? 'add' : 'remove';
    document.documentElement.classList[type]('dark')
</script>

<!-- CDN -->


    
    



<!-- Site Analytics -->

 
<meta name="generator" content="Hexo 7.3.0"></head>

<body>

  <!-- app wrapper -->
  <div class="trm-app-frame">

    <!-- page preloader -->
    <div class="trm-preloader">
    <div class="trm-holder">
        <div class="preloader">
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
            <div></div>
        </div>
    </div>
</div>
    <!-- page preloader end -->

    <!-- change mode preloader -->
    <div class="trm-mode-swich-animation-frame">
    <div class="trm-mode-swich-animation">
        <i class="i-sun"><i class="iconfont far fa-sun"></i></i>
        <div class="trm-horizon"></div>
        <i class="i-moon"><i class="iconfont far fa-moon"></i></i>
    </div>
</div>
    <!-- change mode preloader end -->

      <!-- scroll container -->
      <div id="trm-dynamic-content" class="trm-swup-animation">
        <div id="trm-scroll-container" class="trm-scroll-container" style="opacity: 0">
            <!-- top bar -->
            <header class="trm-top-bar">
	<div class="container">
		<div class="trm-left-side">
			<!-- logo -->
<a href="/L_Study.github.io/" class="trm-logo-frame trm-anima-link">
    
        <img alt="logo" src="/L_Study.github.io/img/favicon.svg">
    
    
        <div class="trm-logo-text">
            Unity<span>Study</span>
        </div>
    
</a>
<!-- logo end -->
		</div>
		<div class="trm-right-side">
			<!-- menu -->
<div class="trm-menu">
    <nav>
        <ul>
            
            <li class="menu-item-has-children ">
                <a  href="/L_Study.github.io/" target="">
                    首页
                </a>
                
                <ul>
                    
                    <li>
                        <a  href="/L_Study.github.io/archives2/" target="">
                            archives2
                        </a>
                    </li>
                    
                </ul>
                
            </li>
            
            <li class="menu-item-has-children ">
                <a  href="/L_Study.github.io/archives/" target="">
                    归档
                </a>
                
            </li>
            
            <li class="menu-item-has-children ">
                <a  href="/L_Study.github.io/categories/" target="">
                    分类
                </a>
                
            </li>
            
            <li class="menu-item-has-children ">
                <a  href="/L_Study.github.io/tags/" target="">
                    标签
                </a>
                
            </li>
            
        </ul>
    </nav>
</div>
<!-- menu end -->
			
    <!-- mode switcher place -->
    <div class="trm-mode-switcher-place">
        <div class="trm-mode-switcher">
            <i class="iconfont far fa-sun"></i>
            <input class="tgl tgl-light" id="trm-swich" type="checkbox">
            <label class="trm-swich" for="trm-swich"></label>
            <i class="iconfont far fa-moon"></i>
        </div>
    </div>
    <!-- mode switcher place end -->

			
		</div>
		<div class="trm-menu-btn">
			<span></span>
		</div>
	</div>
</header>
            <!-- top bar end -->

            <!-- body -->
            
<div class="trm-content-start">
    <!-- banner -->
    <div class="trm-banner">
    
    <!-- banner cover -->
    <img style="object-position:top;object-fit:cover;" alt="banner" class="trm-banner-cover" src="/L_Study.github.io/img/banner.png">
    <!-- banner cover end -->
    

    <!-- banner content -->
    <div class="trm-banner-content trm-overlay">
        <div class="container">
            <div class="row">
                
                <div class="col-lg-4"></div>
                
                <div class="col-lg-8">

                    <!-- banner title -->
                    <div class="trm-banner-text ">
                        <div class="trm-label trm-mb-20">
                            NEWS LETTER
                        </div>
                        <h1 class="trm-mb-30 trm-hsmb-font">
                            Unity数据持久化
                        </h1>

                        
                            <ul class="trm-breadcrumbs trm-label">
                                <li>
                                    <a href="/L_Study.github.io/" class="trm-anima-link">Home</a>
                                </li>
                                <li>
                                    <span>
                                        2025
                                    </span>
                                </li>
                            </ul>
                        
                    </div>
                    <!-- banner title end -->

                    <!-- scroll hint -->
                    <span id="scroll-triger" class="trm-scroll-hint-frame">
                        <div class="trm-scroll-hint"></div>
                        <span class="trm-label">Scroll down</span>
                    </span>
                    <!-- scroll hint end -->

                </div>
            </div>
        </div>
    </div>
    <!-- banner content end -->
</div>
    <!-- banner end -->
    <div class="container">
        <div class="row">
            
                <div class="trm-page-sidebar col-lg-4 hidden-sm">
                    <!-- main card -->
                    <div class="trm-main-card-frame trm-sidebar">
    <div class="trm-main-card"> 
        <!-- card header -->
<div class="trm-mc-header">
    <div class="trm-avatar-frame trm-mb-20">
        <img alt="Avatar" class="trm-avatar" src="/L_Study.github.io/img/Icon.JPG">
    </div>
    <h5 class="trm-name trm-mb-15">
        L
    </h5>
    
        <div class="trm-label">
            I`m
            <span class="trm-typed-text">
                <!-- Words for theme.user.typedText -->
            </span>
        </div>
    
</div>
<!-- card header end -->
        <!-- sidebar social -->

<div class="trm-divider trm-mb-40 trm-mt-40"></div>
<div class="trm-social">
    
        <a href="https://github.com" title="Github" rel="nofollow" target="_blank">
            <i class="iconfont fab fa-github"></i>
        </a>
    
</div>

<!-- sidebar social end -->
        <!-- info -->
<div class="trm-divider trm-mb-40 trm-mt-40"></div>
<ul class="trm-table trm-mb-20">
    
        <li>
            <div class="trm-label">
                Residence:
            </div>
            <div class="trm-label trm-label-light">
                Mars
            </div>
        </li>
    
</ul>
<!-- info end -->

        
    <div class="trm-divider trm-mb-40 trm-mt-40"></div>
    <!-- action button -->
    <div class="text-center">
        <a href="mailto:admin@imalun.com" class="trm-btn">
            联系我
            <i class="iconfont far fa-envelope"></i>
        </a>
    </div>
    <!-- action button end -->

    </div>
</div>
                    <!-- main card end -->
                </div>
            
            <div class="trm-page-content col-lg-8">
                <div id="trm-content" class="trm-content">
                    <div class="trm-post-info row hidden-sm">
    <div class="col-sm-4">
        <div class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-calendar-alt trm-icon"></i><br>
            08/24
        </div>
    </div>
    <div class="col-sm-4">
        <div class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-clock trm-icon"></i><br>
            23:01
        </div>
    </div>
    <div class="col-sm-4">
        <div id="post-author" class="trm-card trm-label trm-label-light text-center">
            <i class="iconfont far fa-user trm-icon"></i><br>
            John Doe
        </div>
    </div>
</div>
<div class="trm-card ">
    <article id="article-container" class="trm-publication">
    <h1 id="Unity数据持久化"><a href="#Unity数据持久化" class="headerlink" title="Unity数据持久化"></a>Unity数据持久化</h1><ul>
<li>数据持久化就是将内存中的数据模型转换为存储模型，以及将存储模型转换为内存中的数据模型的统称。</li>
<li>说人话：将游戏数据存储到硬盘，硬盘中数据读取到游戏中，也就是传统意义上的存盘。</li>
</ul>
<h1 id="PlayerPrefs"><a href="#PlayerPrefs" class="headerlink" title="PlayerPrefs"></a>PlayerPrefs</h1><h2 id="PlayerPrefs基础知识概述"><a href="#PlayerPrefs基础知识概述" class="headerlink" title="PlayerPrefs基础知识概述"></a>PlayerPrefs基础知识概述</h2><h2 id="基本方法"><a href="#基本方法" class="headerlink" title="基本方法"></a>基本方法</h2><p><strong><font size="4">PlayerPrefs是什么？</font></strong></p>
<ul>
<li>PlayerPrefs是Unity提供的可以用于存储读取玩家数据的公共类。</li>
</ul>
<p><strong><font size="4">存储相关</font></strong></p>
<p><strong><font size="3">PlayerPrefs的数据存储</font></strong></p>
<ul>
<li>PlayerPrefs的数据存储类似于键值对存储，一个键对应一个值。</li>
<li>提供了存储3种数据的方法：int、float、string。</li>
<li>键：string类型。</li>
<li>值：int、float、string对应3种API</li>
</ul>
<p><strong><font size="3">存储数据：SetInt方法-SetFloat方法-SetString方法</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="comment">//设置由 key 标识的偏好的值。</span></span><br><span class="line">      PlayerPrefs.SetInt(<span class="string">&quot;myAge&quot;</span>, <span class="number">18</span>);</span><br><span class="line">      PlayerPrefs.SetFloat(<span class="string">&quot;myHeight&quot;</span>, <span class="number">177.5f</span>);</span><br><span class="line">      PlayerPrefs.SetString(<span class="string">&quot;myName&quot;</span>, <span class="string">&quot;林文韬&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">Save方法：存储数据到硬盘中</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//将所有修改的偏好写入磁盘。</span></span><br><span class="line"><span class="comment">//直接调用Set相关方法只会把数据存到内存里。</span></span><br><span class="line"><span class="comment">//当游戏结束时 Unity会自动把数据存到硬盘中。</span></span><br><span class="line"><span class="comment">//如果游戏不是正常结束的而是崩溃 数据是不会存到硬盘中的。</span></span><br><span class="line"><span class="comment">//只要调用该方法 就会马上存储到硬盘中。</span></span><br><span class="line">PlayerPrefs.Save();</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">PlayerPrefs局限性</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="comment">//PlayerPrefs是有局限性的 它只能存3种类型的数据。</span></span><br><span class="line">       <span class="comment">//如果你想要存储别的类型的数据 只能降低精度 或者上升精度来进行存储。</span></span><br><span class="line">       <span class="built_in">bool</span> sex = <span class="literal">true</span>;</span><br><span class="line">       PlayerPrefs.SetInt(<span class="string">&quot;sex&quot;</span>, sex ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">如果不同类型用同一键名进行存储 会进行覆盖</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">   &#123;</span><br><span class="line">       PlayerPrefs.SetInt(<span class="string">&quot;myAge&quot;</span>, <span class="number">18</span>);</span><br><span class="line">       PlayerPrefs.SetFloat(<span class="string">&quot;myAge&quot;</span>, <span class="number">20.2f</span>);<span class="comment">//覆盖上一行存储的myAge数据</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">读取相关</font></strong><br><code>注意：运行时只要你Set了对应键值对 即使你没有马上存储Save在本地 也能够读取出信息</code></p>
<p><strong><font size="3">读取数据：GetInt方法-GetFloat方法-GetString方法</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="comment">//返回偏好设置文件中与 key 对应的值（如果存在）。</span></span><br><span class="line">       <span class="comment">//int</span></span><br><span class="line">       <span class="built_in">int</span> age = PlayerPrefs.GetInt(<span class="string">&quot;myAge&quot;</span>);</span><br><span class="line">       print(age);<span class="comment">//0 int类型的myAge被float类型的myAge覆盖 会返回int类型的默认值0</span></span><br><span class="line">                  <span class="comment">//读取数据相关的方法 可以传入第二个参数充当默认值</span></span><br><span class="line">                  <span class="comment">//前提是 如果找不到myAge对应的值 就会返回函数的第二个参数 默认值</span></span><br><span class="line">       age = PlayerPrefs.GetInt(<span class="string">&quot;myAge&quot;</span>, <span class="number">100</span>);</span><br><span class="line">       print(age);<span class="comment">//100</span></span><br><span class="line">                  <span class="comment">//float</span></span><br><span class="line">       <span class="built_in">float</span> height = PlayerPrefs.GetFloat(<span class="string">&quot;myHeight&quot;</span>, <span class="number">1000f</span>);</span><br><span class="line">       print(height);<span class="comment">//177.5</span></span><br><span class="line">                     <span class="comment">//string</span></span><br><span class="line">       <span class="built_in">string</span> name = PlayerPrefs.GetString(<span class="string">&quot;myName&quot;</span>);</span><br><span class="line">       print(name);</span><br><span class="line">       <span class="comment">//第二个参数 默认值 对于我们的作用</span></span><br><span class="line">       <span class="comment">//就是 在得到没有的数据的时候 就可以用它来进行基础数据的初始化</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">HasKey方法：判断数据是否存在</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="comment">//如果 key 在偏好中存在，则返回 true。</span></span><br><span class="line">       <span class="comment">//主要用于有没有存在相同键的问题 而不是判空保护 因为就算没有也就返回默认值</span></span><br><span class="line">       <span class="keyword">if</span> (PlayerPrefs.HasKey(<span class="string">&quot;myName&quot;</span>))</span><br><span class="line">       &#123;</span><br><span class="line">           print(<span class="string">&quot;存在myName对应的键值对数据&quot;</span>);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">删除数据</font></strong></p>
<p><strong><font size="3">DeleteKey方法：删除指定键值对</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="comment">//从偏好中删除 key 及其对应值。</span></span><br><span class="line">       PlayerPrefs.DeleteKey(<span class="string">&quot;myAge&quot;</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><strong><font size="3">DeleteAll方法：删除所以存储的信息</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="comment">//从偏好中删除所有键和值。请谨慎使用。</span></span><br><span class="line">       PlayerPrefs.DeleteAll();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><strong><font size="4">总结</font></strong></p>
<ul>
<li>Set</li>
<li>Get</li>
<li>HasKey</li>
<li>Del</li>
</ul>
<h3 id="练习题"><a href="#练习题" class="headerlink" title="练习题"></a>练习题</h3><p><strong><font size="4">1.现在有玩家信息类，有名字，年龄，攻击力，防御力等成员，为其封装两个方法，一个用来存储数据，一个用来读取数据</font></strong></p>
<ul>
<li>声明玩家类，添加存储和读取数据的方法</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//玩家类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Player</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//成员变量</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> atk;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> def;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这个变量 是一个 存储和读取的一个唯一key标识</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> keyName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造函数的时候必须传一个唯一key标识</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Player</span>(<span class="params"><span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.keyName = keyName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 存储数据</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Save</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//存储变量数据</span></span><br><span class="line">        PlayerPrefs.SetString(keyName + <span class="string">&quot;_name&quot;</span>, name);</span><br><span class="line">        PlayerPrefs.SetInt(keyName + <span class="string">&quot;_age&quot;</span>, age);</span><br><span class="line">        PlayerPrefs.SetInt(keyName + <span class="string">&quot;_atk&quot;</span>, atk);</span><br><span class="line">        PlayerPrefs.SetInt(keyName + <span class="string">&quot;_def&quot;</span>, def);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//立即存储数据 防止游戏崩溃数据额丢失</span></span><br><span class="line">        PlayerPrefs.Save();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 读取数据</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Load</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//读取数据，没有就给默认值</span></span><br><span class="line">        name = PlayerPrefs.GetString(keyName + <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;未命名&quot;</span>);</span><br><span class="line">        age = PlayerPrefs.GetInt(keyName + <span class="string">&quot;_age&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        atk = PlayerPrefs.GetInt(keyName + <span class="string">&quot;_atk&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        def = PlayerPrefs.GetInt(keyName + <span class="string">&quot;_def&quot;</span>, <span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>在Start函数里调用存储和读取</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    Player p1 = <span class="keyword">new</span> Player(<span class="string">&quot;Player1&quot;</span>);</span><br><span class="line">    p1.Load();</span><br><span class="line">    print(p1.name);</span><br><span class="line">    print(p1.age);</span><br><span class="line">    print(p1.atk);</span><br><span class="line">    print(p1.def);</span><br><span class="line"></span><br><span class="line">    p1.name = <span class="string">&quot;L&quot;</span>;</span><br><span class="line">    p1.age = <span class="number">22</span>;</span><br><span class="line">    p1.atk = <span class="number">40</span>;</span><br><span class="line">    p1.def = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">//改了过后存储</span></span><br><span class="line">    p1.Save();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><font size="4">2.现在在装备信息类，装备类中有id，数量两个成员。上一题的玩家类中包含一个List存储了拥有的所有装备信息。请在上一题的基础上，把装备信息的存储和读取加上</font></strong></p>
<ul>
<li>声明道具类，在玩家类添加道具相关的变量和方法</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//道具类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Item</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//玩家类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Player</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//成员变量</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> atk;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> def;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//拥有的装备信息</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Item&gt; itemList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//这个变量 是一个 存储和读取的一个唯一key标识</span></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">string</span> keyName;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//构造函数的时候必须传一个唯一key标识</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Player</span>(<span class="params"><span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.keyName = keyName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 存储数据</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Save</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//存储变量数据</span></span><br><span class="line">        PlayerPrefs.SetString(keyName + <span class="string">&quot;_name&quot;</span>, name);</span><br><span class="line">        PlayerPrefs.SetInt(keyName + <span class="string">&quot;_age&quot;</span>, age);</span><br><span class="line">        PlayerPrefs.SetInt(keyName + <span class="string">&quot;_atk&quot;</span>, atk);</span><br><span class="line">        PlayerPrefs.SetInt(keyName + <span class="string">&quot;_def&quot;</span>, def);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//存储有多少个装备</span></span><br><span class="line">        PlayerPrefs.SetInt(keyName + <span class="string">&quot;_itemListCount&quot;</span>, itemList.Count);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; itemList.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//存储每一个装备的信息</span></span><br><span class="line">            PlayerPrefs.SetInt(keyName + <span class="string">&quot;_itemID&quot;</span> + i, itemList[i].id);</span><br><span class="line">            PlayerPrefs.SetInt(keyName + <span class="string">&quot;_itemNum&quot;</span> + i, itemList[i].num);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//立即存储数据 防止游戏崩溃数据额丢失</span></span><br><span class="line">        PlayerPrefs.Save();</span><br><span class="line"></span><br><span class="line">        Debug.Log(<span class="string">$&quot;Save keyName:<span class="subst">&#123;keyName&#125;</span> name:<span class="subst">&#123;name&#125;</span> age:<span class="subst">&#123;age&#125;</span> atk:<span class="subst">&#123;atk&#125;</span> def:<span class="subst">&#123;def&#125;</span> itemListCount：<span class="subst">&#123;itemList.Count&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 读取数据</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Load</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//读取数据，没有就给默认值</span></span><br><span class="line">        name = PlayerPrefs.GetString(keyName + <span class="string">&quot;_name&quot;</span>, <span class="string">&quot;未命名&quot;</span>);</span><br><span class="line">        age = PlayerPrefs.GetInt(keyName + <span class="string">&quot;_age&quot;</span>, <span class="number">18</span>);</span><br><span class="line">        atk = PlayerPrefs.GetInt(keyName + <span class="string">&quot;_atk&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        def = PlayerPrefs.GetInt(keyName + <span class="string">&quot;_def&quot;</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//得到有多少个装备</span></span><br><span class="line">        <span class="built_in">int</span> itemListCount = PlayerPrefs.GetInt(keyName + <span class="string">&quot;_itemListCount&quot;</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//初始化容器</span></span><br><span class="line">        itemList = <span class="keyword">new</span> List&lt;Item&gt;();</span><br><span class="line">        Item item;</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; itemListCount; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            item = <span class="keyword">new</span> Item();</span><br><span class="line">            item.id = PlayerPrefs.GetInt(keyName + <span class="string">&quot;_itemID&quot;</span> + i);</span><br><span class="line">            item.num = PlayerPrefs.GetInt(keyName + <span class="string">&quot;_itemNum&quot;</span> + i);</span><br><span class="line">            itemList.Add(item);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        Debug.Log(<span class="string">$&quot;Load keyName:<span class="subst">&#123;keyName&#125;</span> name:<span class="subst">&#123;name&#125;</span> age:<span class="subst">&#123;age&#125;</span> atk:<span class="subst">&#123;atk&#125;</span> def:<span class="subst">&#123;def&#125;</span> itemListCount：<span class="subst">&#123;itemListCount&#125;</span>&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 添加道具方法</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;item&quot;&gt;</span>添加的道具<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddItem</span>(<span class="params">Item item</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">bool</span> isContainItem = IsContainItem(item);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (isContainItem)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//存在item就合并在一起</span></span><br><span class="line">            AddItemNum(item);</span><br><span class="line">            Debug.Log(<span class="string">$&quot;存在item:<span class="subst">&#123;item&#125;</span> item.id:<span class="subst">&#123;item.id&#125;</span> item.num:<span class="subst">&#123;item.num&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            itemList.Add(item);</span><br><span class="line">            Debug.Log(<span class="string">$&quot;不存在item:<span class="subst">&#123;item&#125;</span> item.id:<span class="subst">&#123;item.id&#125;</span> item.num:<span class="subst">&#123;item.num&#125;</span>&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 判断是否存在当前Item</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;item&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">bool</span> <span class="title">IsContainItem</span>(<span class="params">Item item</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (Item curItem <span class="keyword">in</span> itemList)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (curItem.id == item.id)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 添加已有道具数量</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;item&quot;&gt;</span>添加的道具<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">AddItemNum</span>(<span class="params">Item item</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">foreach</span> (Item curItem <span class="keyword">in</span> itemList)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span> (curItem.id == item.id)</span><br><span class="line">            &#123;</span><br><span class="line">                curItem.num += item.num;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>在Start函数里调用增加装备</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    Player p2 = <span class="keyword">new</span> Player(<span class="string">&quot;Player2&quot;</span>);</span><br><span class="line">    p2.Load();</span><br><span class="line">    p2.name = <span class="string">&quot;L&quot;</span>;</span><br><span class="line">    p2.age = <span class="number">22</span>;</span><br><span class="line">    p2.atk = <span class="number">999</span>;</span><br><span class="line">    p2.def = <span class="number">666</span>;</span><br><span class="line">    <span class="comment">//改了过后存储</span></span><br><span class="line">    p2.Save();</span><br><span class="line"></span><br><span class="line">    Player p3 = <span class="keyword">new</span> Player(<span class="string">&quot;Player3&quot;</span>);</span><br><span class="line">    p3.Load();</span><br><span class="line">    p2.Save();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//装备信息</span></span><br><span class="line">    print(p2.itemList.Count);</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; p2.itemList.Count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        print(<span class="string">&quot;道具ID：&quot;</span> + p2.itemList[i].id);</span><br><span class="line">        print(<span class="string">&quot;道具数量：&quot;</span> + p2.itemList[i].num);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//为玩家添加装备</span></span><br><span class="line">    Item item = <span class="keyword">new</span> Item();</span><br><span class="line">    item.id = <span class="number">1</span>;</span><br><span class="line">    item.num = <span class="number">1</span>;</span><br><span class="line">    p2.AddItem(item);</span><br><span class="line"></span><br><span class="line">    item = <span class="keyword">new</span> Item();</span><br><span class="line">    item.id = <span class="number">2</span>;</span><br><span class="line">    item.num = <span class="number">2</span>;</span><br><span class="line">    p2.AddItem(item);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加装备后信息</span></span><br><span class="line">    print(p2.itemList.Count);</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; p2.itemList.Count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        print(<span class="string">&quot;添加装备后道具ID：&quot;</span> + p2.itemList[i].id);</span><br><span class="line">        print(<span class="string">&quot;添加装备后道具数量：&quot;</span> + p2.itemList[i].num);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    p2.Save();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="不同平台的存储位置"><a href="#不同平台的存储位置" class="headerlink" title="不同平台的存储位置"></a>不同平台的存储位置</h2><p><strong><font size="4">PlayerPrefs存储的数据存在哪里？</font></strong></p>
<ul>
<li>在不同的平台上，PlayerPrefs存储的位置会有所不同；</li>
</ul>
<p><strong><font size="4">Windows</font></strong></p>
<ul>
<li>在Windows操作系统下，PlayerPrefs存储在注册表中的以下位置：</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HKCU\Software\[公司名称]\[产品名称]</span><br></pre></td></tr></table></figure>

<ul>
<li>其中，公司名称和产品名称是在Unity的“Project Settings”中的Player栏设置的名称。</li>
<li>你可以通过以下步骤找到对应路径，并修改存储的值：<br>1.运行 regedit<br>2.找到 HKEY_CURRENT_USER<br>3.在其中找到 SOFTWARE<br>4.在其中找到 Unity<br>5.在其中找到 UnityEditor<br>6.在其中找到 公司名称<br>7.在其中找到 产品名称</li>
</ul>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/PlayerPrefs_Windows%E4%B8%8B%E7%9A%84%E5%AD%98%E5%82%A8%E4%BD%8D%E7%BD%AE.png" class="" title="PlayerPrefs_Windows下的存储位置"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<p><strong><font size="4">Android</font></strong></p>
<ul>
<li>在Android操作系统下，PlayerPrefs存储在以下位置：</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/data/data/包名/shared_prefs/pkg-name.xml</span><br></pre></td></tr></table></figure>

<p><strong><font size="4">iOS</font></strong></p>
<ul>
<li>在iOS操作系统下，PlayerPrefs存储在以下位置：</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/Library/Preferences/[应用ID].plist</span><br></pre></td></tr></table></figure>

<p><strong><font size="4">PlayerPrefs数据唯一性</font></strong></p>
<ul>
<li>PlayerPrefs中不同数据的唯一性是由key决定的，不同的key决定了不同的数据。如果在同一项目中不同数据的key相同，会造成数据丢失。因此，要保证数据不丢失，需要建立一个保证key唯一的规则。</li>
</ul>
<h3 id="练习题-1"><a href="#练习题-1" class="headerlink" title="练习题"></a>练习题</h3><p><strong><font size="4">1.将知识点一中的练习题，改为可以支持存储多个玩家信息</font></strong></p>
<ul>
<li>略 将知识点一中的练习题，改为可以支持存储多个玩家信息</li>
</ul>
<p><strong><font size="4">2.要在游戏中做一个排行榜功能，排行榜主要记录玩家名（可重复）,玩家得分，玩家通关时间，请用PlayerPrefs存储读取排行榜相关信息</font></strong></p>
<ul>
<li>创建排行榜类和排行榜单条信息类，添加读取存储添加单条信息逻辑</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 排行榜多条具体信息</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RankListInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//排行榜单条信息列表 </span></span><br><span class="line">    <span class="keyword">public</span> List&lt;RankInfo&gt; rankList;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//初始化的时候就是读取数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RankListInfo</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Load();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 新加排行榜信息</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Add</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> score, <span class="built_in">int</span> time</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        rankList.Add(<span class="keyword">new</span> RankInfo(name, score, time));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//存储数据</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Save</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//存储有多少条数据</span></span><br><span class="line">        PlayerPrefs.SetInt(<span class="string">&quot;rankListCount&quot;</span>, rankList.Count);</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; rankList.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            RankInfo info = rankList[i];</span><br><span class="line">            PlayerPrefs.SetString(<span class="string">&quot;rankInfo&quot;</span> + i, info.playerName);</span><br><span class="line">            PlayerPrefs.SetInt(<span class="string">&quot;rankScore&quot;</span> + i, info.playerScore);</span><br><span class="line">            PlayerPrefs.SetInt(<span class="string">&quot;rankTime&quot;</span> + i, info.playerTime);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//读取数据</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">Load</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> rankListCount = PlayerPrefs.GetInt(<span class="string">&quot;rankListCount&quot;</span>, <span class="number">0</span>);</span><br><span class="line">        rankList = <span class="keyword">new</span> List&lt;RankInfo&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; rankListCount; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            RankInfo info = <span class="keyword">new</span> RankInfo(PlayerPrefs.GetString(<span class="string">&quot;rankInfo&quot;</span> + i),</span><br><span class="line">                                          PlayerPrefs.GetInt(<span class="string">&quot;rankScore&quot;</span> + i),</span><br><span class="line">                                          PlayerPrefs.GetInt(<span class="string">&quot;rankTime&quot;</span> + i));</span><br><span class="line">            rankList.Add(info);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 排行榜单条信息</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RankInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> playerName;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> playerScore;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> playerTime;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">RankInfo</span>(<span class="params"><span class="built_in">string</span> name, <span class="built_in">int</span> score, <span class="built_in">int</span> time</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        playerName = name;</span><br><span class="line">        playerScore = score;</span><br><span class="line">        playerTime = time;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>在Start函数中创建排行榜，添加信息打印保存</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//初始化一个排行榜</span></span><br><span class="line">    RankListInfo rankListInfo = <span class="keyword">new</span> RankListInfo();</span><br><span class="line">    print(rankListInfo.rankList.Count);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//打印排行榜所有信息</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; rankListInfo.rankList.Count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        print(<span class="string">&quot;姓名&quot;</span> + rankListInfo.rankList[i].playerName);</span><br><span class="line">        print(<span class="string">&quot;分数&quot;</span> + rankListInfo.rankList[i].playerScore);</span><br><span class="line">        print(<span class="string">&quot;时间&quot;</span> + rankListInfo.rankList[i].playerTime);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//添加排行榜单条信息保存</span></span><br><span class="line">    rankListInfo.Add(<span class="string">&quot;L&quot;</span>, <span class="number">100</span>, <span class="number">99</span>);</span><br><span class="line">    rankListInfo.Save();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>




<h2 id="PlayerPrefs基础知识总结"><a href="#PlayerPrefs基础知识总结" class="headerlink" title="PlayerPrefs基础知识总结"></a>PlayerPrefs基础知识总结</h2><p><strong><font size="4">优点：</font></strong></p>
<ul>
<li>PlayerPrefs是数据持久化系列中最简单的一部分内容</li>
<li>简单</li>
<li>快捷</li>
<li>易懂</li>
</ul>
<p><strong><font size="4">缺点：</font></strong></p>
<ul>
<li>重复工作量多</li>
<li>自定义数据类，都需要自己去实现存储读取的功能</li>
<li>而且代码的相似度极高</li>
<li>数据容易被修改</li>
<li>只要找到文件位置，就可以轻易的进行数据修改</li>
</ul>
<p><strong><font size="4">主要作用</font></strong></p>
<ul>
<li>单独使用它的原生功能</li>
<li>非常适合存储一些对安全性要求不高的简单数据</li>
<li>但是也不能小看它，对它进行简单的封装也可以让它变得方便又安全</li>
</ul>
<table>
<thead>
<tr>
<th>分类</th>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>存储数据</td>
<td>SetInt(key,value)</td>
<td>设置由Key标识的整数值</td>
</tr>
<tr>
<td>存储数据</td>
<td>SetFloat(key,value)</td>
<td>设置由Key标识的浮点数值</td>
</tr>
<tr>
<td>存储数据</td>
<td>SetString(key,value)</td>
<td>设置由Key标识的字符串值</td>
</tr>
<tr>
<td>存储数据</td>
<td>Save()</td>
<td>将所有修改的偏好写入磁盘</td>
</tr>
<tr>
<td>读取数据</td>
<td>GetInt(key,defaultValue)</td>
<td>返回偏好设置文件中与key对应的值（如果存在），若不存在则返回defaultValue</td>
</tr>
<tr>
<td>读取数据</td>
<td>GetFloat(key,defaultValue)</td>
<td>返回偏好设置文件中与key对应的值（如果存在），若不存在则返回defaultValue</td>
</tr>
<tr>
<td>读取数据</td>
<td>GetString(key, defaultValue)</td>
<td>返回偏好设置文件中与key对应的值（如果存在），若不存在则返回defaultValue</td>
</tr>
<tr>
<td>判断数据是否存在</td>
<td>HasKey(key)</td>
<td>如果key在偏好中存在，则返回true</td>
</tr>
<tr>
<td>删除数据</td>
<td>DeleteKey(key)</td>
<td>从偏好中删除key及其对应值</td>
</tr>
<tr>
<td>删除数据</td>
<td>DeleteAll()</td>
<td>从偏好中删除所有键和值</td>
</tr>
</tbody></table>
<h2 id="PlayerPrefs实践项目"><a href="#PlayerPrefs实践项目" class="headerlink" title="PlayerPrefs实践项目"></a>PlayerPrefs实践项目</h2><p><strong><font size="4">反射知识小补充</font></strong></p>
<p><strong><font size="3">反射知识回顾：</font></strong></p>
<ul>
<li>反射3剑客————1T 两A</li>
<li>Type——用于获取类的所有信息，包括字段、属性、方法等等</li>
<li>Assembly——用于获取程序集，通过程序集获取Type</li>
<li>Activator——用于快速实例化对象</li>
</ul>
<p><strong><font size=3>Type.IsAssignableFrom方法：判断能否父类装子类</font></strong></p>
<ul>
<li>Type 类中的 IsAssignableFrom 方法用于确定一个类型是否可以从另一个类型赋值。它返回一个布尔值，指示调用类型是否可以从指定的类型派生或分配。</li>
<li>这个方法通常用于反射和类型比较的场景中。例如，你可以使用 IsAssignableFrom 来检查一个对象是否可以转换为另一个类型，或者确定一个类型是否是另一个类型的子类或接口的实现类。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Father</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Son</span> : <span class="title">Father</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span>:<span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="meta">#<span class="keyword">region</span> 知识点二 判断一个类型的对象是否可以让另一个类型为自己分配空间</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//父类装子类 是否可以从某一个类型的对象 为自己 分配 空间</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//获得父类和子类的Type</span></span><br><span class="line">        Type fatherType = <span class="keyword">typeof</span>(Father);</span><br><span class="line">        Type sonType = <span class="keyword">typeof</span>(Son);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//IsAssignableFrom方法 调用者 通过该方法进行判断 判断是否可以通过传入的类型为自己 分配空间</span></span><br><span class="line">        <span class="comment">//确定指定类型 c 的实例是否能分配给当前类型的变量。</span></span><br><span class="line">        <span class="keyword">if</span> (fatherType.IsAssignableFrom(sonType))</span><br><span class="line">        &#123;</span><br><span class="line">            print(<span class="string">&quot;可以装&quot;</span>);</span><br><span class="line">            Father f = Activator.CreateInstance(sonType) <span class="keyword">as</span> Father;</span><br><span class="line">            print(f);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            print(<span class="string">&quot;不能装&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">Type.GetGenericArguments方法：获取表示泛型类型参数的Type对象数组</font></strong></p>
<ul>
<li>Type 类中的 GetGenericArguments 方法用于获取表示泛型类型参数的 Type 对象数组。这个方法通常用于处理泛型类型，其中一个类型可能包含一个或多个类型参数。</li>
<li>该方法返回一个 Type 数组，其中包含表示泛型类型参数的 Type 对象。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获得List的Type类</span></span><br><span class="line">    List&lt;<span class="built_in">int</span>&gt; list = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line">    Type listType = list.GetType();</span><br><span class="line">    <span class="comment">// 获得List泛型参数数组的Type</span></span><br><span class="line">    Type[] types = listType.GetGenericArguments();</span><br><span class="line">    print(types[<span class="number">0</span>]); <span class="comment">// System.Int32</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得Dictionary的Type类</span></span><br><span class="line">    Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">float</span>&gt; dic = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">float</span>&gt;();</span><br><span class="line">    Type dicType = dic.GetType();</span><br><span class="line">    <span class="comment">// 获得Dictionary泛型参数数组的Type</span></span><br><span class="line">    types = dicType.GetGenericArguments();</span><br><span class="line">    print(types[<span class="number">0</span>]); <span class="comment">// System.String</span></span><br><span class="line">    print(types[<span class="number">1</span>]); <span class="comment">// System.Single</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">PlayerPrefs数据管理类</font></strong><br><strong><font size="3">创建PlayerPrefs数据管理类，使用单例模式</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> PlayerPrefs数据管理类 统一管理数据的存储和读取</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerPrefsDataMgr</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//管理类用单例模式</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> PlayerPrefsDataMgr instance = <span class="keyword">new</span> PlayerPrefsDataMgr();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> PlayerPrefsDataMgr Instance</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">get</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">return</span> instance;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">PlayerPrefsDataMgr</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">添加存储数据方法，并写出思路</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerPrefsDataMgr</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 存储数据</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;data&quot;&gt;</span>数据对象<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;keyName&quot;&gt;</span>数据对象的唯一key 自己控制<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SaveData</span>(<span class="params"><span class="built_in">object</span> data, <span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//就是要通过 Type 得到传入数据对象的所有的 字段</span></span><br><span class="line">        <span class="comment">//然后结合 PlayerPrefs来进行存储</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">添加读取数据方法，并写出思路</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerPrefsDataMgr</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 读取数据</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;type&quot;&gt;</span>想要读取数据的 数据类型Type<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;keyName&quot;&gt;</span>数据对象的唯一key 自己控制<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">LoadData</span>(<span class="params">Type type, <span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//不用object对象传入 而使用 Type传入</span></span><br><span class="line">        <span class="comment">//主要目的是节约一行代码（在外部）</span></span><br><span class="line">        <span class="comment">//假设现在你要 读取一个Player类型的数据 如果是传入object 你就必须在外部new一个对象传入</span></span><br><span class="line">        <span class="comment">//现在有Type的 你只用传入 一个Type typeof(Player) 然后我在内部动态创建一个对象给你返回出来</span></span><br><span class="line">        <span class="comment">//达到了 让你在外部 少写一行代码的作用</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据你传入的类型 和 keyName</span></span><br><span class="line">        <span class="comment">//依据你存储数据时  key的拼接规则 来进行数据的获取赋值 返回出去</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>这样你就可以通过单例模式的 PlayerPrefsDataMgr.Instance 来访问和管理数据的存储和读取了。</p>
</blockquote>
<p><strong><font size="4">反射存储常用成员数据</font></strong></p>
<p><strong><font size="3">存储数据方法内，获取传入数据对象的所有字段</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SaveData</span>(<span class="params"><span class="built_in">object</span> data, <span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//获得传进来的data的Type</span></span><br><span class="line">    Type dataType = data.GetType();</span><br><span class="line">    <span class="comment">//得到dataType的所有字段的数组</span></span><br><span class="line">    FieldInfo[] infos = dataType.GetFields();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">存储数据方法内，自己定义一个key的规则进行数据存储</font></strong></p>
<ul>
<li>我们存储都是通过PlayerPrefs来进行存储的</li>
<li>保证key的唯一性我们就需要自己定一个key的规则</li>
<li>我们自己定一个规则：keyName_数据类型_字段类型_字段名</li>
</ul>
<p><strong><font size="3">存储数据方法内，遍历所有字段进行数据存储</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SaveData</span>(<span class="params"><span class="built_in">object</span> data, <span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">//设置临时变量 方便遍历字段数组使用</span></span><br><span class="line">   <span class="built_in">string</span> saveKeyName = <span class="string">&quot;&quot;</span>;</span><br><span class="line">   FieldInfo info;</span><br><span class="line"></span><br><span class="line">   <span class="comment">//遍历字段数组</span></span><br><span class="line">   <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; infos.Length; i++)</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="comment">//得到字段数组中每一个具体字段的信息</span></span><br><span class="line">       <span class="comment">//准备对每一个字段进行数据存储</span></span><br><span class="line">       info = infos[i];</span><br><span class="line"></span><br><span class="line">       <span class="comment">//通过FieldInfo可以直接获取到 字段的类型 和字段的名字</span></span><br><span class="line">       <span class="comment">//字段的类型 info.FieldType.Name</span></span><br><span class="line">       <span class="comment">//字段的名字 info.Name;</span></span><br><span class="line">   </span><br><span class="line">       <span class="comment">//要根据我们定的key的拼接规则 来进行唯一key的生成</span></span><br><span class="line">       <span class="comment">//Player1_PlayerInfo_Int32_age</span></span><br><span class="line">       saveKeyName = keyName + <span class="string">&quot;_&quot;</span> + dataType.Name +</span><br><span class="line">       <span class="string">&quot;_&quot;</span> + info.FieldType.Name + <span class="string">&quot;_&quot;</span> + info.Name;</span><br><span class="line">   </span><br><span class="line">       <span class="comment">//现在得到了唯一Key 按照我们的规则</span></span><br><span class="line">       <span class="comment">//接下来就要来通过PlayerPrefs来进行存储</span></span><br><span class="line">       <span class="comment">//如何获取值 info类的GetValue方法传入具体对象data</span></span><br><span class="line">       <span class="comment">//info.GetValue(data)</span></span><br><span class="line"></span><br><span class="line">       <span class="comment">//封装一个专门来存储值的方法 </span></span><br><span class="line">       SaveValue(info.GetValue(data), saveKeyName);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">创建存储具体值的方法，写存储一些常用类型变量的存储逻辑</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 存储具体值的方法</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;value&quot;&gt;</span>值对象<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;keyName&quot;&gt;</span>值对象唯一的key 按自定义规则生成的<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SaveValue</span>(<span class="params"><span class="built_in">object</span> <span class="keyword">value</span>, <span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//直接通过PlayerPrefs来进行存储了</span></span><br><span class="line">    <span class="comment">//就是根据数据类型的不同 来决定使用哪一个API来进行存储</span></span><br><span class="line">    <span class="comment">//PlayerPrefs只支持3种类型存储 </span></span><br><span class="line">    <span class="comment">//判断 数据类型 是什么类型 然后调用具体的方法来存储</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到要存储的值对象的类型</span></span><br><span class="line">    Type fieldType = <span class="keyword">value</span>.GetType();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用多个if堆值对象的类型进行判断</span></span><br><span class="line">    <span class="comment">//是不是int</span></span><br><span class="line">    <span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">int</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;存储int&quot;</span> + keyName);</span><br><span class="line">        PlayerPrefs.SetInt(keyName, (<span class="built_in">int</span>)<span class="keyword">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//是不是float</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">float</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;存储float&quot;</span> + keyName);</span><br><span class="line">        PlayerPrefs.SetFloat(keyName, (<span class="built_in">float</span>)<span class="keyword">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//是不是string</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">string</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;存储string&quot;</span> + keyName);</span><br><span class="line">        PlayerPrefs.SetString(keyName, <span class="keyword">value</span>.ToString());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//是不是bool</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">bool</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;存储bool&quot;</span> + keyName);</span><br><span class="line">        <span class="comment">//自己定义一个存储bool的规则</span></span><br><span class="line">        PlayerPrefs.SetInt(keyName, (<span class="built_in">bool</span>)<span class="keyword">value</span> ? <span class="number">1</span> : <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong><font size="3">创建测试类进行测试</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name = <span class="string">&quot;未命名&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> height = <span class="number">177f</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        PlayerInfo p = <span class="keyword">new</span> PlayerInfo();</span><br><span class="line">        <span class="comment">//需要把这个数据对象的信息 存储到硬盘</span></span><br><span class="line">        PlayerPrefsDataMgr.Instance.SaveData(p, <span class="string">&quot;Player1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">反射存储List成员数据</font></strong></p>
<p><strong><font size="3">存储具体值的方法内，用是否继承的方法判断当前要存储的数据结构是不是List，是的话存储List的长度变量和List存储里面的具体值，会用到递归（假如List的泛型是自定义类的话还会有处理，后面再讲）</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SaveValue</span>(<span class="params"><span class="built_in">object</span> <span class="keyword">value</span>, <span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//上面内容省略......</span></span><br><span class="line">    <span class="comment">//如何判断 泛型类的类型呢</span></span><br><span class="line">    <span class="comment">//通过反射 IsAssignableFrom 方法判断父子关系</span></span><br><span class="line">    <span class="comment">//这相当于是判断这个字段是不是 IList 的子类，是的话基本上就是 List 类了</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(IList).IsAssignableFrom(fieldType))</span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;存储List&quot;</span> + keyName);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//父类装子类 把要存储的值对象的类型转成 IList 在遍历</span></span><br><span class="line">        IList list = <span class="keyword">value</span> <span class="keyword">as</span> IList;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//先存储 List 中元素的数量 </span></span><br><span class="line">        PlayerPrefs.SetInt(keyName, list.Count);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//声明一个 index 用做遍历 List 拼接 key 用</span></span><br><span class="line">        <span class="built_in">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="built_in">object</span> obj <span class="keyword">in</span> list)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//遍历 List 递归存储具体的值</span></span><br><span class="line">            <span class="comment">//这里面存的已经是泛型的变量类型了 比如 List&lt;int&gt; 这个 obj 就是 int 类型的了</span></span><br><span class="line">            <span class="comment">//假如泛型的变量类型不是常规变量 会继续往下递归</span></span><br><span class="line">            SaveValue(obj, keyName + index);</span><br><span class="line">            ++index;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong><font size="3">给测试类的玩家信息类添加List的变量，用于测试</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name = <span class="string">&quot;未命名&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> height = <span class="number">177.5f</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex = <span class="literal">true</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; list = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;() &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span> &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">反射存储Dictionary成员数据</font></strong></p>
<p><strong><font size="3">在存储具体值的方法内，用是否继承的方法判断当前要存储的数据结构是不是Dictionary，是的话存储Dictionary的长度变量和Dictionary存储里面的具体键值对，会用到递归（假如Dictionary的泛型是自定义类的话还会有处理，后面再讲）</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SaveValue</span>(<span class="params"><span class="built_in">object</span> <span class="keyword">value</span>, <span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//上面内容省略......</span></span><br><span class="line">    <span class="comment">//判断是不是 Dictionary 类型 通过 Dictionary 的父类 IDictionary 来判断 和 List 的判断类似</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(IDictionary).IsAssignableFrom(fieldType))</span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;存储Dictionary&quot;</span> + keyName);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//父类装子类 把要存储的值对象的类型转成 IDictionary 在遍历</span></span><br><span class="line">        IDictionary dic = <span class="keyword">value</span> <span class="keyword">as</span> IDictionary;</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//先存储 Dictionary 中元素的数量 </span></span><br><span class="line">        PlayerPrefs.SetInt(keyName, dic.Count);</span><br><span class="line">    </span><br><span class="line">        <span class="comment">//遍历存储 Dictionary 里面的具体值</span></span><br><span class="line">        <span class="comment">//声明一个 index 用做遍历 Dictionary 拼接 key 用</span></span><br><span class="line">        <span class="built_in">int</span> index = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="built_in">object</span> key <span class="keyword">in</span> dic.Keys)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//遍历 Dictionary 递归存储具体的值</span></span><br><span class="line">            <span class="comment">//这里面存的已经是泛型的变量类型了 比如 Dictionary&lt;int,string&gt; 就分别存 int 类型和 string 类型的变量</span></span><br><span class="line">            <span class="comment">//假如泛型的变量类型不是常规变量 会继续往下递归</span></span><br><span class="line">            SaveValue(key, keyName + <span class="string">&quot;_key_&quot;</span> + index);</span><br><span class="line">            SaveValue(dic[key], keyName + <span class="string">&quot;_value_&quot;</span> + index);</span><br><span class="line">            ++index;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">给测试类的玩家信息类添加Dictionary的变量，用于测试</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name = <span class="string">&quot;未命名&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> height = <span class="number">177.5f</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; list = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;() &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; dic = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt;()</span><br><span class="line">    &#123;</span><br><span class="line">        &#123; <span class="number">1</span>,<span class="string">&quot;123&quot;</span>&#125;,</span><br><span class="line">        &#123; <span class="number">2</span>,<span class="string">&quot;234&quot;</span>&#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">反射存储自定义类成员数据</font></strong></p>
<p><strong><font size="3">存储自定义类，可以直接套用一次保存数据方法就行了，因为SaveData本来就是存储自定义类用的。把KeyName跟着传过来，这样KeyName看起来很长，但是能保证唯一性</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">SaveValue</span>(<span class="params"><span class="built_in">object</span> <span class="keyword">value</span>, <span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//上面内容省略......</span></span><br><span class="line">    <span class="comment">//基础数据类型都不是 那么可能就是自定义类型</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        SaveData(<span class="keyword">value</span>, keyName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">添加道具类，给测试类的玩家信息类添加道具类泛型的List和Dictionary的变量，用于测试</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name = <span class="string">&quot;未命名&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> height = <span class="number">177.5f</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; list = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;() &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; dic = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt;()</span><br><span class="line">    &#123;</span><br><span class="line">        &#123; <span class="number">1</span>,<span class="string">&quot;123&quot;</span>&#125;,</span><br><span class="line">        &#123; <span class="number">2</span>,<span class="string">&quot;234&quot;</span>&#125;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> ItemInfo itemInfo = <span class="keyword">new</span> ItemInfo(<span class="number">3</span>, <span class="number">99</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;ItemInfo&gt; itemList = <span class="keyword">new</span> List&lt;ItemInfo&gt;() &#123; </span><br><span class="line">        <span class="keyword">new</span> ItemInfo(<span class="number">1</span>, <span class="number">10</span>),</span><br><span class="line">        <span class="keyword">new</span> ItemInfo(<span class="number">2</span>, <span class="number">20</span>),</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">int</span>, ItemInfo&gt; itemDic = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">int</span>, ItemInfo&gt;()</span><br><span class="line">    &#123;</span><br><span class="line">        &#123; <span class="number">3</span>, <span class="keyword">new</span> ItemInfo(<span class="number">3</span>, <span class="number">22</span>)&#125;,</span><br><span class="line">        &#123; <span class="number">4</span>, <span class="keyword">new</span> ItemInfo(<span class="number">4</span>, <span class="number">33</span>)&#125;,</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ItemInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> num;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ItemInfo</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ItemInfo</span>(<span class="params"><span class="built_in">int</span> id, <span class="built_in">int</span> num</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong><font size="4">反射读取常用成员数据</font></strong></p>
<p><strong><font size="3">对应这存储的key，添加读取数据的逻辑</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 读取数据</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;type&quot;&gt;</span>想要读取数据的 数据类型Type<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;keyName&quot;&gt;</span>数据对象的唯一key 自己控制<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">LoadData</span>(<span class="params">Type type, <span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Log(<span class="string">&quot;读取自定义类型&quot;</span> + keyName);</span><br><span class="line">    <span class="comment">//不用object对象传入 而使用 Type传入</span></span><br><span class="line">    <span class="comment">//主要目的是节约一行代码（在外部）</span></span><br><span class="line">    <span class="comment">//假设现在你要 读取一个Player类型的数据 如果是传入object 你就必须在外部new一个对象传入</span></span><br><span class="line">    <span class="comment">//现在有Type的 你只用传入 一个Type typeof(Player) 然后我在内部动态创建一个对象给你返回出来</span></span><br><span class="line">    <span class="comment">//达到了 让你在外部 少写一行代码的作用</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据你传入的类型 和 keyName</span></span><br><span class="line">    <span class="comment">//依据你存储数据时  key的拼接规则 来进行数据的获取赋值 返回出去</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//根据传入的Type 创建一个对象 用于存储数据 要确保传进来的类型又无参构造</span></span><br><span class="line">    <span class="built_in">object</span> data = Activator.CreateInstance(type);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//接下来的目的就是要往 这个new出来的对象中存储数据 填充数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到这个类所有字段的字段数组</span></span><br><span class="line">    FieldInfo[] infos = type.GetFields();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用于拼接key的字符串</span></span><br><span class="line">    <span class="built_in">string</span> loadKeyName = <span class="string">&quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//用于存储 单个字段信息的 对象 方便等一下遍历使用</span></span><br><span class="line">    FieldInfo info;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//遍历这个类的字段数组</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; infos.Length; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//获得单条字段</span></span><br><span class="line">        info = infos[i];</span><br><span class="line"></span><br><span class="line">        <span class="comment">//key的拼接规则 一定是和存储时一模一样 这样才能找到对应数据</span></span><br><span class="line">        loadKeyName = keyName + <span class="string">&quot;_&quot;</span> + type.Name +</span><br><span class="line">            <span class="string">&quot;_&quot;</span> + info.FieldType.Name + <span class="string">&quot;_&quot;</span> + info.Name;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//有key 就可以结合 PlayerPrefs来读取数据</span></span><br><span class="line">        <span class="comment">//SetValue方法 赋值数据给对象 填充数据到data对象中 </span></span><br><span class="line">        info.SetValue(data, LoadValue(info.FieldType, loadKeyName));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//返回填充完的data对象</span></span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">对应这存储的key，添加读取单个具体数据的逻辑</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 得到单个数据的方法</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;fieldType&quot;&gt;</span>字段类型 用于判断 用哪个api来读取<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;keyName&quot;&gt;</span>用于获取具体数据<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">object</span> <span class="title">LoadValue</span>(<span class="params">Type fieldType, <span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//根据 字段类型 来判断 用哪个API来读取</span></span><br><span class="line">    <span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">int</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> PlayerPrefs.GetInt(keyName, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">float</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> PlayerPrefs.GetFloat(keyName, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">string</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> PlayerPrefs.GetString(keyName, <span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">bool</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//根据自定义存储bool的规则 来进行值的获取</span></span><br><span class="line">        <span class="keyword">return</span> PlayerPrefs.GetInt(keyName, <span class="number">0</span>) == <span class="number">1</span> ? <span class="literal">true</span> : <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong><font size="3">在测试类调用读取逻辑测试</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//读取数据  传入读取数据的类和唯一key</span></span><br><span class="line">        PlayerInfo p2 = PlayerPrefsDataMgr.Instance.LoadData(<span class="keyword">typeof</span>(PlayerInfo), <span class="string">&quot;Player1&quot;</span>) <span class="keyword">as</span> PlayerInfo;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><font size="4">反射读取List成员数据</font></strong></p>
<p><strong><font size="3">读取具体值的方法内，用是否继承的方法判断当前要读取的数据结构是不是List，是的话读取List的长度变量和读取List里面的具体值，会用到递归（假如List的泛型是自定义类的话还会有处理，后面再讲）</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">object</span> <span class="title">LoadValue</span>(<span class="params">Type fieldType, <span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">   <span class="comment">//上面内容省略......</span></span><br><span class="line">   <span class="comment">//通过反射 IsAssignableFrom方法判断 父子关系</span></span><br><span class="line">   <span class="comment">//这相当于是判断 这个字段是不是IList的子类 是的话基本上就是List类了</span></span><br><span class="line">   <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(IList).IsAssignableFrom(fieldType))</span><br><span class="line">   &#123;</span><br><span class="line">       <span class="comment">//得到List长度</span></span><br><span class="line">       <span class="built_in">int</span> listCount = PlayerPrefs.GetInt(keyName, <span class="number">0</span>);</span><br><span class="line">       Log(<span class="string">&quot;读取ListCount&quot;</span> + keyName + <span class="string">&quot;值 = &quot;</span> + (listCount));</span><br><span class="line"></span><br><span class="line">       <span class="comment">//实例化一个List对象 来进行赋值</span></span><br><span class="line">       <span class="comment">//用了反射中双A中 Activator进行快速实例化List对象</span></span><br><span class="line">       IList list = Activator.CreateInstance(fieldType) <span class="keyword">as</span> IList;</span><br><span class="line"></span><br><span class="line">       <span class="comment">//根据List长度 根据长度逐个添加元素</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; listCount; i++)</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="comment">//GetGenericArguments得到List中泛型的类型</span></span><br><span class="line">           <span class="comment">//比如List&lt;int&gt; 这个fieldType.GetGenericArguments()[0]就是int类型了</span></span><br><span class="line">           <span class="comment">//得到了这个类型后 在递归调用读取List里面具体的值</span></span><br><span class="line">           list.Add(LoadValue(fieldType.GetGenericArguments()[<span class="number">0</span>], keyName + i));</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> list;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">反射读取Dictionary成员数据</font></strong></p>
<p><strong><font size="3">读取具体值的方法内，用是否继承的方法判断当前要读取的数据结构是不是Dictionary，是的话读取Dictionary的长度变量和读取Dictionary里面的键值对，会用到递归</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">object</span> <span class="title">LoadValue</span>(<span class="params">Type fieldType, <span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//上面内容省略......</span></span><br><span class="line">    <span class="comment">//通过反射 IsAssignableFrom方法判断 父子关系</span></span><br><span class="line">    <span class="comment">//这相当于是判断 这个字段是不是IDictionary的子类 是的话基本上就是Dictionary类了</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span>(IDictionary).IsAssignableFrom(fieldType))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//得到字典的长度</span></span><br><span class="line">        <span class="built_in">int</span> dictionaryCount = PlayerPrefs.GetInt(keyName, <span class="number">0</span>);</span><br><span class="line">        Log(<span class="string">&quot;读取DictionaryCount&quot;</span> + keyName + <span class="string">&quot;值 = &quot;</span> + (dictionaryCount));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//实例化一个字典对象 用父类装子类</span></span><br><span class="line">        <span class="comment">//用了反射中双A中 Activator进行快速实例化Dictionary对象</span></span><br><span class="line">        IDictionary dic = Activator.CreateInstance(fieldType) <span class="keyword">as</span> IDictionary;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//GetGenericArguments得到Dictionary中泛型的类型数组 0是key 1是value</span></span><br><span class="line">        Type[] kvType = fieldType.GetGenericArguments();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//根据Dictionary长度 根据长度逐个添加键值对</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; dictionaryCount; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            dic.Add(LoadValue(kvType[<span class="number">0</span>], keyName + <span class="string">&quot;_key_&quot;</span> + i),</span><br><span class="line">                 LoadValue(kvType[<span class="number">1</span>], keyName + <span class="string">&quot;_value_&quot;</span> + i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dic;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">反射读取自定义类成员数据</font></strong></p>
<p><strong><font size="3">读取自定义类，可以直接套用一次读取数据方法就行了，因为LoadData本来就是读取自定义类用的。把KeyName跟着传过来，这样KeyName看起来很长，但是能保证唯一性</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="built_in">object</span> <span class="title">LoadValue</span>(<span class="params">Type fieldType, <span class="built_in">string</span> keyName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//上面内容省略......</span></span><br><span class="line">    <span class="comment">//基础数据类型都不是 那么可能就是自定义类型</span></span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//在走一遍读取自定义内的流程</span></span><br><span class="line">        <span class="keyword">return</span> LoadData(fieldType, keyName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">在测试类测试一下</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> height;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex;</span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; list;</span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; dic;</span><br><span class="line">    <span class="keyword">public</span> ItemInfo itemInfo;</span><br><span class="line">    <span class="keyword">public</span> List&lt;ItemInfo&gt; itemList;</span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">int</span>, ItemInfo&gt; itemDic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ItemInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> num;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ItemInfo</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ItemInfo</span>(<span class="params"><span class="built_in">int</span> id, <span class="built_in">int</span> num</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 读取数据</span></span><br><span class="line">        PlayerInfo p = PlayerPrefsDataMgr.Instance.LoadData(<span class="keyword">typeof</span>(PlayerInfo), <span class="string">&quot;Player1&quot;</span>) <span class="keyword">as</span> PlayerInfo;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改玩家数据</span></span><br><span class="line">        p.age = <span class="number">18</span>;</span><br><span class="line">        p.name = <span class="string">&quot;L&quot;</span>;</span><br><span class="line">        p.height = <span class="number">1000</span>;</span><br><span class="line">        p.sex = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">        p.itemList.Add(<span class="keyword">new</span> ItemInfo(<span class="number">1</span>, <span class="number">99</span>));</span><br><span class="line">        p.itemList.Add(<span class="keyword">new</span> ItemInfo(<span class="number">2</span>, <span class="number">199</span>));</span><br><span class="line"></span><br><span class="line">        p.itemDic.Add(<span class="number">3</span>, <span class="keyword">new</span> ItemInfo(<span class="number">3</span>, <span class="number">1</span>));</span><br><span class="line">        p.itemDic.Add(<span class="number">4</span>, <span class="keyword">new</span> ItemInfo(<span class="number">4</span>, <span class="number">2</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 存储游戏数据</span></span><br><span class="line">        PlayerPrefsDataMgr.Instance.SaveData(p, <span class="string">&quot;Player1&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">加密思路</font></strong></p>
<p><strong><font size="3">找不到</font></strong></p>
<ul>
<li>把存在硬盘上的内容放在一个不容易找到的地方</li>
<li>多层文件夹包裹</li>
<li>名字辨识度低</li>
</ul>
<blockquote>
<p>但是对于PlayerPrefs不太适用<br>因为位置已经固定，改变不了</p>
</blockquote>
<p><strong><font size="3">看不懂</font></strong></p>
<ul>
<li>让数据的Key和Value让别人看不懂</li>
<li>俗称加密</li>
<li>为Key和Value加密</li>
</ul>
<p><strong><font size="3">解不出</font></strong></p>
<ul>
<li>不让别人获取到你加密的规则就解不出来了</li>
</ul>
<p><strong><font size="3">注意</font></strong></p>
<ul>
<li>单机游戏加密只是提高别人修改你数据的门槛</li>
<li>主要别人获取到你的源代码</li>
<li>知道你的加密规则</li>
<li>一切都没有任何意义</li>
<li>对于一般玩家来说几乎是不可能的</li>
</ul>
<p><strong><font size="3">加密示例代码</font></strong></p>
<ul>
<li>存储时加密int</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//用多个if堆值对象的类型进行判断</span></span><br><span class="line"><span class="comment">//是不是int</span></span><br><span class="line"><span class="keyword">if</span> (fieldType == <span class="keyword">typeof</span>(<span class="built_in">int</span>))</span><br><span class="line">&#123;</span><br><span class="line">    Log(<span class="string">&quot;存储int:&quot;</span> + keyName + <span class="string">&quot;值 = &quot;</span> + (<span class="built_in">int</span>)<span class="keyword">value</span>);</span><br><span class="line">    <span class="comment">//为int数据加密</span></span><br><span class="line">    <span class="built_in">int</span> rValue = (<span class="built_in">int</span>)<span class="keyword">value</span>;</span><br><span class="line">    rValue += <span class="number">10</span>;</span><br><span class="line">    PlayerPrefs.SetInt(keyName, rValue);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>读取时解密int</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//根据 字段类型 来判断 用哪个API来读取</span></span><br><span class="line"><span class="keyword">if</span>( fieldType == <span class="keyword">typeof</span>(<span class="built_in">int</span>) )</span><br><span class="line">&#123;</span><br><span class="line">    Log(<span class="string">&quot;读取int:&quot;</span> + keyName + <span class="string">&quot;值 = &quot;</span> + (PlayerPrefs.GetInt(keyName, <span class="number">0</span>) - <span class="number">10</span>));</span><br><span class="line">    <span class="comment">//解密 减10</span></span><br><span class="line">    <span class="keyword">return</span> PlayerPrefs.GetInt(keyName, <span class="number">0</span>) - <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h1 id="XML"><a href="#XML" class="headerlink" title="XML"></a>XML</h1><h2 id="XML基础知识概述"><a href="#XML基础知识概述" class="headerlink" title="XML基础知识概述"></a>XML基础知识概述</h2><p><strong><font size="4">什么是XML?</font></strong></p>
<ul>
<li>全称：可拓展标记语言（E<font color=red>X</font>tensible <font color=red>M</font>arkup <font color=red>L</font>anguage）</li>
<li>XML是国际通用的</li>
<li>它是被设计来用于传输和存储数据的一种文本特殊格式。</li>
<li>文件后缀一般为.xml</li>
</ul>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/XML_xml%E6%96%87%E4%BB%B6%E5%8F%8A%E5%86%85%E5%AE%B9.png" class="" title="XML_xml文件及内容"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<p><strong><font size="4">如何理解不同后缀的文件</font></strong></p>
<ul>
<li>文件后缀名决定了文件的格式</li>
<li>不同的软件可以根据后缀名用来判断文件的类型并且在打开文件时以特定的读取规则去解析它</li>
<li>文件后缀名是人为定的规则</li>
<li>可以有无数种，可以自定义</li>
<li>常见后缀有：图片：.png .jpg .gif(动态图) 音乐：.mp3 视频：.mp4 压缩格式：.zip .rar 模型格式：.fbx C#脚本格式：.cs</li>
</ul>
<p><strong><font size="4">我们一般使用XML文件来记录和传输数据</font></strong></p>
<ul>
<li>XML文档就是使用XML格式配置填写的文档后缀一般为.xml</li>
<li>我们在游戏中可以把游戏数据按照XML的格式标准</li>
<li>存储在XML文档中，再将XML文档存储在硬盘上或者传输给远端达到数据持久化的目的</li>
</ul>
<p><strong><font size="4">主要学习内容</font></strong></p>
<ul>
<li>XML文件格式</li>
<li>C#读取和存储XML文件</li>
<li>通过序列化和反序列化快速存储读取XML文件</li>
</ul>
<p><strong><font size="4">学会后对于我们的意义</font></strong></p>
<ul>
<li>1.多了一种存储和传输数据的选择</li>
<li>2.多了一种配置数据的方法</li>
</ul>
<h2 id="XML基本语法"><a href="#XML基本语法" class="headerlink" title="XML基本语法"></a>XML基本语法</h2><p><strong><font size="4">推荐xml文本编辑器</font></strong></p>
<ul>
<li>只要能打开文档的软件都能打开XML文件</li>
<li>常用的一些打开XML文件的方式</li>
<li>1.系统自带：记事本、写字板<br>2.专业XML文本编辑器：XMLSpear、STDU XML Editor等等<br>3.通用文本编辑器：Sublime Text等等</li>
</ul>
<p><strong><font size="4">XML格式是一种树形结构</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/XML_XML%E6%A0%BC%E5%BC%8F%E6%98%AF%E6%A0%91%E5%BD%A2%E7%BB%93%E6%9E%84.png" class="" title="XML_XML格式是树形结构"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>


<p><strong><font size="4">创建XML文件</font></strong></p>
<ul>
<li>直接右键创建文本，后缀改为xml</li>
<li>选择自己喜欢的用于编辑xml的软件进行文本编辑</li>
</ul>
<p><strong><font size="4">注释</font></strong></p>
<ul>
<li>固定语法</li>
</ul>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/XML_%E6%B3%A8%E9%87%8A%E7%9A%84%E5%9B%BA%E5%AE%9A%E8%AF%AD%E6%B3%95.png" class="" title="XML_注释的固定语法"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>


<p><strong><font size="4">固定内容</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/XML_%E5%9B%BA%E5%AE%9A%E5%86%85%E5%AE%B9.png" class="" title="XML_固定内容"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<blockquote>
<p>编码格式就 是读取文件时 解析字符串使用的编码是什么<br>编码格式：不同的字符 在内存中的二进制是不一样的 每个字符对应一个数字<br>不同的编码格式 字符 对应的 二进制 是不一样的<br>举个例子<br>ASCII:A-11<br>UTF-8:A-21<br>乱码的出现就是因为用来不同的编码格式解析文本内容<br>由于字符和对应的二进制不匹配 就会出现乱码</p>
</blockquote>
<p><strong><font size="4">基本语法</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/XML_%E5%9F%BA%E6%9C%AC%E8%AF%AD%E6%B3%95.png" class="" title="XML_基本语法"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<p><strong><font size="4">基本规则</font></strong></p>
<ul>
<li>1.每个元素都必须有关闭标签</li>
<li>2.元素命名规则基本遵照C#中变量命名规则</li>
<li>3.XML标签对大小写敏感</li>
<li>4.XML文档必须有根元素</li>
<li>5.特殊的符号应该用实体引用<br>&amp;lt —— &lt; 小于<br>&amp;gt —— &gt; 大于<br>&amp;amp —— &amp;和号<br>&amp;apos —— ‘单引号<br>&amp;quot —— “引号</li>
</ul>
<p><strong><font size="4">总结</font></strong></p>
<ul>
<li>1.创建XML文件 —— 右键创建文档改后缀</li>
<li>2.注释 —— 注释的语法 </li>
<li>3.固定内容 —— <?xml version="1.0" encoding="UTF-8"?></li>
<li>4.基本语法 —— &lt;元素标签&gt;元素内容&lt;&#x2F;元素标签&gt;多层嵌套包裹 形成树形结构</li>
<li>5.基本规则 —— 必须有根节点 实体引用替代符等等</li>
</ul>
<h2 id="XML属性"><a href="#XML属性" class="headerlink" title="XML属性"></a>XML属性</h2><p><strong><font size="4">属性语法</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/XML_%E5%B1%9E%E6%80%A7%E8%AF%AD%E6%B3%95.png" class="" title="XML_属性语法"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<p><strong><font size="4">属性和元素节点的区别</font></strong></p>
<ul>
<li>属性和元素节点只是写法上的区别而已。</li>
<li>我们可以选择自己喜欢的方式来记录数据</li>
<li>比如：</li>
</ul>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/XML_%E5%B1%9E%E6%80%A7%E5%92%8C%E5%85%83%E7%B4%A0%E8%8A%82%E7%82%B9%E7%9A%84%E5%8C%BA%E5%88%AB.png" class="" title="XML_属性和元素节点的区别"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<p><strong><font size="4">如何查语法错误</font></strong></p>
<ul>
<li>1.元素标签必须配对</li>
<li>2.属性必须有引号</li>
<li>3.注意命名</li>
<li>或者直接复制到<a target="_blank" rel="noopener" href="https://www.runoob.com/xml/xml-validator.html%E7%BD%91%E9%A1%B5%E4%B8%8A%E8%BF%9B%E8%A1%8C%E9%AA%8C%E8%AF%81%E3%80%82">https://www.runoob.com/xml/xml-validator.html网页上进行验证。</a><blockquote>
<p>注意：一般专门编辑xml的软件都会有判错功能</p>
</blockquote>
</li>
</ul>
<p><strong><font size="4">总结</font></strong></p>
<ul>
<li>1.属性语法 —— &lt;元素标签名 属性名&#x3D;”信息”&gt;元素信息&lt;&#x2F;元素标签名&gt;</li>
<li>2.属性和元素的区别 —— 写法上不同，根据实际情况选择使用</li>
<li>3.如何查语法错误 —— 配对，命名，引号等等，或者直接复制信息到网页上检测</li>
</ul>
<h2 id="XML文件存放位置"><a href="#XML文件存放位置" class="headerlink" title="XML文件存放位置"></a>XML文件存放位置</h2><p><code>CSharp操作XMl-XML文件存放位置</code></p>
<ul>
<li>只读不写的XML文件可以放在 Resources或者StreamingAssets 文件夹下</li>
<li>动态存储的XML文件放在 Application.persistentDataPath 路径下</li>
</ul>
<h2 id="读取XML文件"><a href="#读取XML文件" class="headerlink" title="读取XML文件"></a>读取XML文件</h2><p><code>CSharp操作XML-读取XML文件</code></p>
<p><strong><Font size="4">C#读取XML的方法</font></strong></p>
<p><strong><font size="3">XmlDocument：</font></strong></p>
<ul>
<li>把数据加载到内存中，方便读取</li>
</ul>
<p><strong><font size="3">XmlTextReader：</font></strong></p>
<ul>
<li>以流形式加载，内存占用更少，但是是单向只读，使用不是特别方便，除非有特殊需求，否则不会使用</li>
</ul>
<p><strong><font size="3">Linq：</font></strong></p>
<ul>
<li>后面学习</li>
</ul>
<hr>
<ul>
<li>使用XmlDocument类读取是较方便最容易理解和操作的方法 </li>
<li>可以创建Resources和StreamingAssets文件夹，放入相同的测试XML文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>L<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">age</span>&gt;</span>18<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;1&quot;</span> <span class="attr">num</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Friend</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>小明<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">age</span>&gt;</span>8<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Friend</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Friend</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">name</span>&gt;</span>小红<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">age</span>&gt;</span>10<span class="tag">&lt;/<span class="name">age</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">Friend</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">读取xml文件信息</font></strong></p>
<p><strong><font size="3">XmlDocument Xml文档类</font></strong></p>
<ul>
<li>引用 System.Xml 命名空间</li>
<li>表示XML文档的类 XmlDocument</li>
<li>新建一个XML文档对象</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">XmlDocument xmlDocument = <span class="keyword">new</span> XmlDocument();</span><br></pre></td></tr></table></figure>

<p><strong><font size="3">XmlDocument读取xml文件</font></strong></p>
<ul>
<li>XmlDocument.LoadXml方法：传入xml字符串内容来加载xml文件</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//加载存放在Resorces文件夹下的xml文件 类型是TextAsset</span></span><br><span class="line">    TextAsset textAsset = Resources.Load&lt;TextAsset&gt;(<span class="string">&quot;TestXml&quot;</span>);</span><br><span class="line">    print(textAsset.text);<span class="comment">//可以输出xml文本</span></span><br><span class="line">    <span class="comment">//XmlDocument类中的LoadXml方法 能够翻译字符串为xml对象</span></span><br><span class="line">    xmlDocument.LoadXml(textAsset.text);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>xmlDocument.Load方法：通过xml文件的路径加载</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//XML文件要在StreamingAssets文件夹下 因为StreamingAssets不会被压缩加密 Resources文件夹会</span></span><br><span class="line">    <span class="comment">//XmlDocument类中的Load方法 传入xml文件的路径直接加载xml</span></span><br><span class="line">    xmlDocument.Load(Application.streamingAssetsPath + <span class="string">&quot;/TestXml.xml&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>加载完成后 XML文档的所有信息就存在XML文档对象中</p>
</blockquote>
<p><strong><font size="4">读取元素和属性信息</font></strong></p>
<p><strong><font size="3">XmlNode: Xml节点信息类</font></strong><br><strong><font size="3">XmlNodeList: Xml节点列表信息类</font></strong></p>
<p><strong><font size="3">XmlDocument.SelectSingleNode方法: </font></strong></p>
<ul>
<li>获取xml当中的根节点</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//XmlDocument中的SelectSingleNode方法 获取xml当中的根节点</span></span><br><span class="line">    XmlNode root = xmlDocument.SelectSingleNode(<span class="string">&quot;Root&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><font size="3">XmlNode.SelectSingleNode方法：</font></strong></p>
<ul>
<li>通过根节点去获取下面的子节点</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//XmlNode中的SelectSingleNode方法 再通过根节点 去获取下面的子节点</span></span><br><span class="line">    XmlNode nodeName = root.SelectSingleNode(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><font size="3">XmlNode.InnerText变量：</font></strong></p>
<ul>
<li>获取节点包裹的元素信息</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//XmlNode中的InnerText变量 获取节点包裹的元素信息</span></span><br><span class="line">    <span class="comment">//如果想要获取节点包裹的元素信息 直接 .InnerText</span></span><br><span class="line">    print(nodeName.InnerText);<span class="comment">//L</span></span><br><span class="line">    XmlNode nodeAge = root.SelectSingleNode(<span class="string">&quot;age&quot;</span>);</span><br><span class="line">    print(nodeAge.InnerText);<span class="comment">//18</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><font size="3">获得Xml节点中的属性信息</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    XmlNode nodeItem = root.SelectSingleNode(<span class="string">&quot;Item&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><font size="3">XmlNode.Attributes[“属性名”].Value</font></strong></p>
<ul>
<li>直接中括号获取信息</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//XmlNode中的Attributes用中括号传入对应属性名字后.出Value  直接中括号获取信息</span></span><br><span class="line">    print(nodeItem.Attributes[<span class="string">&quot;id&quot;</span>].Value);<span class="comment">//1</span></span><br><span class="line">    print(nodeItem.Attributes[<span class="string">&quot;num&quot;</span>].Value);<span class="comment">//10</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">XmlNode.Attributes.GetNamedItem(“属性名”).Value</font></strong></p>
<ul>
<li>用GetNamedItem方法获取信息</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//XmlNode中的Attributes用GetNamedItem方法传入对应属性名字后.出Value  用GetNamedItem方法获取信息</span></span><br><span class="line">    print(nodeItem.Attributes.GetNamedItem(<span class="string">&quot;id&quot;</span>).Value);<span class="comment">//1</span></span><br><span class="line">    print(nodeItem.Attributes.GetNamedItem(<span class="string">&quot;num&quot;</span>).Value);<span class="comment">//10</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><font size="3">XmlNodeList.SelectNodes方法：</font></strong></p>
<ul>
<li>获取一个节点下的同名节点的方法</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//XmlNodeList中的SelectNodes方法 获取一个节点下的同名节点的方法</span></span><br><span class="line">    XmlNodeList friendList = root.SelectNodes(<span class="string">&quot;Friend&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><font size="3">遍历获得XmlNodeList每个节点信息</font></strong></p>
<ul>
<li>迭代器遍历</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//遍历方式一：迭代器遍历</span></span><br><span class="line">    <span class="keyword">foreach</span> (XmlNode item <span class="keyword">in</span> friendList)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//相当于item选择是父节点了 像单个节点一样获得子节点</span></span><br><span class="line">        print(item.SelectSingleNode(<span class="string">&quot;name&quot;</span>).InnerText);</span><br><span class="line">        print(item.SelectSingleNode(<span class="string">&quot;age&quot;</span>).InnerText);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>for循环遍历</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//遍历方式二：通过for循环遍历</span></span><br><span class="line">    <span class="comment">//通过XmlNodeList中的 成员变量 Count可以得到 节点数量</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; friendList.Count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        print(friendList[i].SelectSingleNode(<span class="string">&quot;name&quot;</span>).InnerText);</span><br><span class="line">        print(friendList[i].SelectSingleNode(<span class="string">&quot;age&quot;</span>).InnerText);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><strong><font size="4">1.读取XML文件：</font></strong></p>
<ul>
<li>XmlDocument xmlDocument &#x3D; new XmlDocument();</li>
<li>读取文本方式1-xmlDocument.LoadXml(传入xml文本字符串)</li>
<li>读取文本方式2-xmlDocument.Load(传入路径)</li>
</ul>
<p><strong><font size="4">2.读取元素和属性：</font></strong></p>
<ul>
<li><p>获取单个节点 : XmlNode node &#x3D; xmlDocument.SelectSingleNode(节点名)</p>
</li>
<li><p>获取多个节点 : XmlNodeList nodeList &#x3D; xmlDocument.SelectNodes(节点名)</p>
</li>
<li><p>获取节点元素内容：node.InnerText</p>
</li>
</ul>
<p><strong><font size="3">获取节点元素属性：</font></strong></p>
<ul>
<li><p>item.Attributes[“属性名”].Value</p>
</li>
<li><p>item.Attributes.GetNamedItem(“属性名”).Value</p>
</li>
<li><p>通过迭代器遍历或者循环遍历XmlNodeList对象可以获取到各单个元素节点</p>
</li>
</ul>
<h3 id="练习题-2"><a href="#练习题-2" class="headerlink" title="练习题"></a>练习题</h3><p><strong><font size="4">1.有一个玩家数据类，请为该类写一个方法结合XML读取知识点，将XML中数据读取到PlayerInfo的一个对象中</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Item</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> num;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> atk;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> def;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> moveSpeed;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> roundSpeed;</span><br><span class="line">    <span class="keyword">public</span> Item weapon;</span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; listInt;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Item&gt; itemList;</span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">int</span>, Item&gt; itemDic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>StreamAssets文件夹下创建PlayerInfo.xml</li>
</ul>
<p><strong><font size="3">PlayerInfo.xml</font></strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PlayerInfo</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--自己定一个xml代表 类对象数据的规则</span></span><br><span class="line"><span class="comment">    我们的元素节点名 就用我们的变量名命名</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span>&gt;</span>L<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">atk</span>&gt;</span>10<span class="tag">&lt;/<span class="name">atk</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">def</span>&gt;</span>5<span class="tag">&lt;/<span class="name">def</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">moveSpeed</span>&gt;</span>20<span class="tag">&lt;/<span class="name">moveSpeed</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">roundSpeed</span>&gt;</span>20<span class="tag">&lt;/<span class="name">roundSpeed</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">weapon</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">num</span>&gt;</span>1<span class="tag">&lt;/<span class="name">num</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">weapon</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--当出现没有变量名的数据时 我们就用变量类型名命名--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listInt</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">int</span>&gt;</span>1<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">int</span>&gt;</span>2<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">int</span>&gt;</span>3<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listInt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">itemList</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;1&quot;</span> <span class="attr">num</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;2&quot;</span> <span class="attr">num</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;3&quot;</span> <span class="attr">num</span>=<span class="string">&quot;30&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;4&quot;</span> <span class="attr">num</span>=<span class="string">&quot;40&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">itemList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">itemDic</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">int</span>&gt;</span>1<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;1&quot;</span> <span class="attr">num</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">int</span>&gt;</span>2<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;2&quot;</span> <span class="attr">num</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">int</span>&gt;</span>3<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;3&quot;</span> <span class="attr">num</span>=<span class="string">&quot;1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 另一种写法 但是建议大家都统一</span></span><br><span class="line"><span class="comment">        &lt;int&gt;4&lt;/int&gt;</span></span><br><span class="line"><span class="comment">        &lt;Item&gt;</span></span><br><span class="line"><span class="comment">            &lt;id&gt;4&lt;/id&gt;</span></span><br><span class="line"><span class="comment">            &lt;num&gt;1&lt;/num&gt;</span></span><br><span class="line"><span class="comment">        &lt;/Item&gt;</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">itemDic</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PlayerInfo</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">定义Item类</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义Item类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Item</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> num;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">定义一个名为PlayerInfo的公共类</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//定义一个名为 PlayerInfo 的公共类</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//以下为 PlayerInfo 类的成员变量</span></span><br><span class="line">    <span class="comment">//玩家昵称，字符串类型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="comment">//攻击力，整型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> atk;</span><br><span class="line">    <span class="comment">//防御力，整型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> def;</span><br><span class="line">    <span class="comment">//移动速度，浮点型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> moveSpeed;</span><br><span class="line">    <span class="comment">//回合速度，浮点型</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> roundSpeed;</span><br><span class="line">    <span class="comment">//武器信息，Item 类型</span></span><br><span class="line">    <span class="keyword">public</span> Item weapon;</span><br><span class="line">    <span class="comment">//整数列表，使用 List&lt;int&gt; 实现</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; listInt;</span><br><span class="line">    <span class="comment">//物品列表，使用 List&lt;Item&gt; 实现</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Item&gt; itemList;</span><br><span class="line">    <span class="comment">//物品字典，使用 Dictionary&lt;int, Item&gt; 实现</span></span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">int</span>, Item&gt; itemDic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">PlayerInfo中定义一个名为LoadData的公共方法，参数为文件名字符串fileName</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//定义一个名为 LoadData 的公共方法，参数为文件名字符串 fileName</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LoadData</span>(<span class="params"><span class="built_in">string</span> fileName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//构建文件路径，用于读取玩家存档数据</span></span><br><span class="line">    <span class="built_in">string</span> path = Application.persistentDataPath + <span class="string">&quot;/&quot;</span> + fileName + <span class="string">&quot;.xml&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//如果存档文件不存在，则从默认资源中获取数据</span></span><br><span class="line">    <span class="keyword">if</span> (!File.Exists(path))</span><br><span class="line">    &#123;</span><br><span class="line">        path = Application.streamingAssetsPath + <span class="string">&quot;/&quot;</span> + fileName + <span class="string">&quot;.xml&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//加载 XML 文件信息</span></span><br><span class="line">    XmlDocument xml = <span class="keyword">new</span> XmlDocument();</span><br><span class="line">    <span class="comment">//加载</span></span><br><span class="line">    xml.Load(path);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//从文件中加载出具体的数据</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//加载根节点才能加载后面的内容</span></span><br><span class="line">    XmlNode playerInfo = xml.SelectSingleNode(<span class="string">&quot;PlayerInfo&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//通过根节点去加载具体的信息</span></span><br><span class="line">    <span class="keyword">this</span>.name = playerInfo.SelectSingleNode(<span class="string">&quot;name&quot;</span>).InnerText;</span><br><span class="line">    <span class="keyword">this</span>.atk = <span class="built_in">int</span>.Parse(playerInfo.SelectSingleNode(<span class="string">&quot;atk&quot;</span>).InnerText);</span><br><span class="line">    <span class="keyword">this</span>.def = <span class="built_in">int</span>.Parse(playerInfo.SelectSingleNode(<span class="string">&quot;def&quot;</span>).InnerText);</span><br><span class="line">    <span class="keyword">this</span>.moveSpeed = <span class="built_in">float</span>.Parse(playerInfo.SelectSingleNode(<span class="string">&quot;moveSpeed&quot;</span>).InnerText);</span><br><span class="line">    <span class="keyword">this</span>.roundSpeed = <span class="built_in">float</span>.Parse(playerInfo.SelectSingleNode(<span class="string">&quot;roundSpeed&quot;</span>).InnerText);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//加载武器信息节点</span></span><br><span class="line">    XmlNode weaponNode = playerInfo.SelectSingleNode(<span class="string">&quot;weapon&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>.weapon = <span class="keyword">new</span> Item();</span><br><span class="line">    <span class="keyword">this</span>.weapon.id = <span class="built_in">int</span>.Parse(weaponNode.SelectSingleNode(<span class="string">&quot;id&quot;</span>).InnerText);</span><br><span class="line">    <span class="keyword">this</span>.weapon.num = <span class="built_in">int</span>.Parse(weaponNode.SelectSingleNode(<span class="string">&quot;num&quot;</span>).InnerText);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//加载整数列表节点</span></span><br><span class="line">    XmlNode listIntNode = playerInfo.SelectSingleNode(<span class="string">&quot;listInt&quot;</span>);</span><br><span class="line">    XmlNodeList intList = listIntNode.SelectNodes(<span class="string">&quot;int&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>.listInt = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; intList.Count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.listInt.Add(<span class="built_in">int</span>.Parse(intList[i].InnerText));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//加载物品列表节点</span></span><br><span class="line">    XmlNode itemListNode = playerInfo.SelectSingleNode(<span class="string">&quot;itemList&quot;</span>);</span><br><span class="line">    XmlNodeList items = itemListNode.SelectNodes(<span class="string">&quot;Item&quot;</span>);</span><br><span class="line">    <span class="keyword">this</span>.itemList = <span class="keyword">new</span> List&lt;Item&gt;();</span><br><span class="line">    <span class="keyword">foreach</span> (XmlNode item <span class="keyword">in</span> items)</span><br><span class="line">    &#123;</span><br><span class="line">        Item item2 = <span class="keyword">new</span> Item();</span><br><span class="line">        item2.id = <span class="built_in">int</span>.Parse(item.Attributes[<span class="string">&quot;id&quot;</span>].Value);</span><br><span class="line">        item2.num = <span class="built_in">int</span>.Parse(item.Attributes[<span class="string">&quot;num&quot;</span>].Value);</span><br><span class="line">        <span class="keyword">this</span>.itemList.Add(item2);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//加载物品字典节点</span></span><br><span class="line">    XmlNode itemDicNode = playerInfo.SelectSingleNode(<span class="string">&quot;itemDic&quot;</span>);</span><br><span class="line">    XmlNodeList keyInt = itemDicNode.SelectNodes(<span class="string">&quot;int&quot;</span>);</span><br><span class="line">    XmlNodeList valueItem = itemDicNode.SelectNodes(<span class="string">&quot;Item&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.itemDic = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">int</span>, Item&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; keyInt.Count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="built_in">int</span> key = <span class="built_in">int</span>.Parse(keyInt[i].InnerText);</span><br><span class="line">        Item <span class="keyword">value</span> = <span class="keyword">new</span> Item();</span><br><span class="line">        <span class="keyword">value</span>.id = <span class="built_in">int</span>.Parse(valueItem[i].Attributes[<span class="string">&quot;id&quot;</span>].Value);</span><br><span class="line">        <span class="keyword">value</span>.num = <span class="built_in">int</span>.Parse(valueItem[i].Attributes[<span class="string">&quot;num&quot;</span>].Value);</span><br><span class="line">        <span class="keyword">this</span>.itemDic.Add(key, <span class="keyword">value</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">创建测试脚本，测试脚本中断点测试看能不能获得XML文件数据</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        PlayerInfo p = <span class="keyword">new</span> PlayerInfo();</span><br><span class="line">        p.LoadData(<span class="string">&quot;PlayerInfo&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="存储和修改Xml文件"><a href="#存储和修改Xml文件" class="headerlink" title="存储和修改Xml文件"></a>存储和修改Xml文件</h2><p><code>Csharp操作XML-存储和修改XML文件</code></p>
<p><strong><font size="4">Xml决定存储在哪个文件夹下</font></strong></p>
<ul>
<li>注意：存储xml文件 在Unity中一定是使用各平台都可读可写可找到的路径</li>
</ul>
<p><strong><font size="3">Resources：</font></strong> </p>
<ul>
<li>可读 不可写 打包加密后通过路径找不到 X</li>
</ul>
<p><strong><font size="3">Application.StreamingAssetsPath</font></strong> </p>
<ul>
<li>可读 PC端可写 但是其他平台不可写 打包加密后通过路径找得到，可以存些不会改的xml文件 X</li>
</ul>
<p><strong><font size="3">Application.persistentDataPath</font></strong></p>
<ul>
<li><p>可读可写 各个平台找得到 √</p>
</li>
<li><p>准备好我们最终要存储的路径</p>
</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> path = Application.persistentDataPath + <span class="string">&quot;/PlayerInfo2.xml&quot;</span>;</span><br><span class="line">print(Application.persistentDataPath);<span class="comment">//C:/Users/LinWentao/AppData/LocalLow/DefaultCompany/XML教程</span></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">存储xml文件</font></strong><br>存储xml文件用到的关键类：</p>
<ul>
<li><p>XmlDocument(xml文档类)：用于创建节点存储文件</p>
</li>
<li><p>XmlDeclaration(Xml声明类)：用于添加版本信息</p>
</li>
<li><p>XmlElement(Xml元素类)</p>
</li>
</ul>
<p><strong><font size="3">存储xml文件具体的五个步骤：</font></strong></p>
<ul>
<li>创建XmlDocument文档对象</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//创建XmlDocument类文本对象 </span></span><br><span class="line">    <span class="comment">//相当于新建xml文件</span></span><br><span class="line">    XmlDocument xmlDocument = <span class="keyword">new</span> XmlDocument();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>添加固定版本信息</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">region</span> XmlDocument.CreateXmlDeclaration方法 添加固定版本信息</span></span><br><span class="line">   <span class="comment">//XmlDocument类中的CreateXmlDeclaration方法 添加固定版本信息</span></span><br><span class="line">   <span class="comment">//这一句代码 相当于就是创建&lt;?xmlDocument version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;这句内容</span></span><br><span class="line">   XmlDeclaration xmlDec = xmlDocument.CreateXmlDeclaration(<span class="string">&quot;1.0&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line"><span class="meta">#<span class="keyword">endregion</span></span></span><br></pre></td></tr></table></figure>


<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">region</span> XmlDocument.AppendChild方法 把对象添加到xml文本对象中</span></span><br><span class="line">    <span class="comment">//XmlDocument类中的AppendChild方法 把版本信息对象添加到xml文本对象中 </span></span><br><span class="line">    <span class="comment">//创建完成过后 要添加进入 文本对象中</span></span><br><span class="line">    xmlDocument.AppendChild(xmlDec);</span><br><span class="line"><span class="meta">#<span class="keyword">endregion</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>添加根节点</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">region</span> XmlDocument.CreateElement方法 创建根节点</span></span><br><span class="line">    <span class="comment">//XmlDocument类中的CreateElement方法 添加根节点</span></span><br><span class="line">    XmlElement root = xmlDocument.CreateElement(<span class="string">&quot;Root&quot;</span>);</span><br><span class="line">    <span class="comment">//创建完成过后 要添加进入 文本对象中</span></span><br><span class="line">    xmlDocument.AppendChild(root);</span><br><span class="line"><span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>为根节点添加子节点</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">region</span> XmlElement.SetAttribute方法 给节点设置属性和属性值</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//为根节点添加子节点</span></span><br><span class="line">    <span class="comment">//创建了了一个name子节点</span></span><br><span class="line">    XmlElement name = xmlDocument.CreateElement(<span class="string">&quot;name&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//XmlElement中的InnerText属性 设置包裹信息</span></span><br><span class="line">    name.InnerText = <span class="string">&quot;L&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//XmlElement类中的AppendChild方法 把子节点添加到xml文本对象中 </span></span><br><span class="line">    root.AppendChild(name);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用CreateElement方法在根节点下创建名称为“atk”的节点，并设置其InnerText（即节点内部的文本值）为“10”</span></span><br><span class="line">    XmlElement atk = xmlDocument.CreateElement(<span class="string">&quot;atk&quot;</span>);</span><br><span class="line">    atk.InnerText = <span class="string">&quot;10&quot;</span>;</span><br><span class="line">    <span class="comment">//将“atk”子节点添加至根节点“Root”中</span></span><br><span class="line">    root.AppendChild(atk);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用CreateElement方法在根节点下创建名称为“listInt”的XmlNode节点，并将三个名为“int”的子节点添加到该节点中。</span></span><br><span class="line">    XmlElement listInt = xmlDocument.CreateElement(<span class="string">&quot;listInt&quot;</span>);</span><br><span class="line">    <span class="comment">//遍历给listInt添加子节点</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">3</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//使用CreateElement方法在“listInt”节点下依次创建三个名为“int”的XmlElement节点</span></span><br><span class="line">        XmlElement childNode = xmlDocument.CreateElement(<span class="string">&quot;int&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//依次设置三个“int”子节点的InnerText值，分别为1、2、3</span></span><br><span class="line">        childNode.InnerText = i.ToString();</span><br><span class="line">        listInt.AppendChild(childNode);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将“listInt”子节点添加至根节点“Root”中</span></span><br><span class="line">    root.AppendChild(listInt);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//使用CreateElement方法在根节点下创建名称为“itemList”的XmlElement节点，并将三个名为“Item”的子节点添加到该节点中，</span></span><br><span class="line">    XmlElement itemList = xmlDocument.CreateElement(<span class="string">&quot;itemList&quot;</span>);</span><br><span class="line">    <span class="comment">//遍历给itemList添加子节点</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">3</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//使用CreateElement方法在“itemList”节点下依次创建三个名为“Item”的XmlElement节点</span></span><br><span class="line">        XmlElement childNode = xmlDocument.CreateElement(<span class="string">&quot;Item&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//XmlElement中的SetAttribute方法 给节点设置属性和属性值</span></span><br><span class="line">        <span class="comment">//使用SetAttribute方法给每个“Item”节点设置两个属性，分别为“id”和“num”</span></span><br><span class="line">        childNode.SetAttribute(<span class="string">&quot;id&quot;</span>, i.ToString());</span><br><span class="line">        childNode.SetAttribute(<span class="string">&quot;num&quot;</span>, (i * <span class="number">10</span>).ToString());</span><br><span class="line">        itemList.AppendChild(childNode);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//将“itemList”节点添加至根节点“Root”中</span></span><br><span class="line">    root.AppendChild(itemList);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endregion</span></span></span><br></pre></td></tr></table></figure>

<ul>
<li>保存</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">region</span> XmlDocument.Save方法 在指定路径保存xml文件</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//XmlDocument类中的Save方法 在指定路径保存xml文件</span></span><br><span class="line">    xmlDocument.Save(path);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endregion</span></span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>保存后的xml文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>L<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">atk</span>&gt;</span>10<span class="tag">&lt;/<span class="name">atk</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listInt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>1<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>2<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>3<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listInt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">itemList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;1&quot;</span> <span class="attr">num</span>=<span class="string">&quot;10&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;2&quot;</span> <span class="attr">num</span>=<span class="string">&quot;20&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;3&quot;</span> <span class="attr">num</span>=<span class="string">&quot;30&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">itemList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">修改Xml文件</font></strong></p>
<p><strong><font size="3">File.Exists方法：判断某路径是否存在文件</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//File类中的Exists方法 判断路径是否存在</span></span><br><span class="line"><span class="keyword">if</span> ( File.Exists(path) )</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><font size=3>加载后利用学过的方法修改xml文件</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//File类中的Exists方法 判断路径是否存在</span></span><br><span class="line"><span class="keyword">if</span> ( File.Exists(path) )</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//2.加载后 直接添加节点 移除节点即可</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建xml文本对象 加载对应路径的xml文件</span></span><br><span class="line">    XmlDocument newXml = <span class="keyword">new</span> XmlDocument();</span><br><span class="line">    newXml.Load(path);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//修改就是在原有文件基础上 去移除 或者添加</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//移除节点</span></span><br><span class="line"></span><br><span class="line">    XmlNode node;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//可以在XmlNode中连续使用SelectSingleNode方法得到子节点</span></span><br><span class="line">    node = newXml.SelectSingleNode(<span class="string">&quot;Root&quot;</span>).SelectSingleNode(<span class="string">&quot;atk&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//也可以通过/来区分父子节点的关系 得到子节点</span></span><br><span class="line">    node = newXml.SelectSingleNode(<span class="string">&quot;Root/atk&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到自己的父节点</span></span><br><span class="line">    XmlNode root2 = newXml.SelectSingleNode(<span class="string">&quot;Root&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//XmlNode类中的RemoveChild方法 移除子节点方法</span></span><br><span class="line">    root2.RemoveChild(node);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加节点</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//CreateElement创建一个节点</span></span><br><span class="line">    XmlElement moveSpeed = newXml.CreateElement(<span class="string">&quot;moveSpeed&quot;</span>);</span><br><span class="line">    <span class="comment">//设置包裹内容</span></span><br><span class="line">    moveSpeed.InnerText = <span class="string">&quot;20&quot;</span>;</span><br><span class="line">    <span class="comment">//加到更节点</span></span><br><span class="line">    root2.AppendChild(moveSpeed);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//改了记得保存文档对象</span></span><br><span class="line">    newXml.Save(path);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">修改后的结果</font></strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Root</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>L<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listInt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>1<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>2<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>3<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listInt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">itemList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;1&quot;</span> <span class="attr">num</span>=<span class="string">&quot;10&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;2&quot;</span> <span class="attr">num</span>=<span class="string">&quot;20&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;3&quot;</span> <span class="attr">num</span>=<span class="string">&quot;30&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">itemList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">moveSpeed</span>&gt;</span>20<span class="tag">&lt;/<span class="name">moveSpeed</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Root</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">总结</font></strong><br><strong><font size="3">路径选取</font></strong></p>
<ul>
<li>在运行过程中存储 只能往可写且能找到的文件夹存储</li>
<li>故选择了Application.persistentDataPath</li>
</ul>
<p><strong><font size="3">存储xml关键类</font></strong></p>
<ul>
<li>XmlDocument 文件</li>
</ul>
<p>创建节点 CreateElement<br>创建固定内容方法 CreateXmlDeclaration<br>添加节点 AppendChild<br>保存 Save</p>
<ul>
<li>XmlDeclaration 版本</li>
<li>XmlElement 元素节点</li>
</ul>
<p>设置属性方法 SetAttribute</p>
<p><strong><font size="3">修改</font></strong></p>
<ul>
<li>RemoveChild 移除节点</li>
<li>可以通过 &#x2F; 的形式来表示子节点的子节点</li>
</ul>
<h3 id="练习题-3"><a href="#练习题-3" class="headerlink" title="练习题"></a>练习题</h3><p><strong><font size="4">1.结合上一个知识点的练习题，实现将PlayerInfo数据存储到XML文件</font></strong><br><strong><font size="3">在PlayerInfo类创建用XMl存储数据的方法，分五步骤存储xml文件</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//定义一个名为 SaveData 的公共方法，参数为文件名字符串 fileName</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SaveData</span>(<span class="params"><span class="built_in">string</span> fileName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//决定存储路径</span></span><br><span class="line">        <span class="built_in">string</span> path = Application.persistentDataPath + <span class="string">&quot;/&quot;</span> + fileName + <span class="string">&quot;.xml&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//输出该XML文档将保存在何处。</span></span><br><span class="line">        Debug.Log(Application.persistentDataPath);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//初始化5步操作。</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//1.创建XmlDocument对象。稍后它将包含所需的Xml数据。</span></span><br><span class="line">        XmlDocument xml = <span class="keyword">new</span> XmlDocument();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//2.使用CreateXmlDeclaration()方法创建XmlDeclaration对象声明文档类型和版本。</span></span><br><span class="line">        XmlDeclaration xmlDec = xml.CreateXmlDeclaration(<span class="string">&quot;1.0&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">        <span class="comment">//将XmlDeclaration对象添加到XmlDocument对象中。</span></span><br><span class="line">        <span class="comment">//这将把该声明作为XML文件的第一行。</span></span><br><span class="line">        xml.AppendChild(xmlDec);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.添加根节点</span></span><br><span class="line">        <span class="comment">//使用CreateElement()方法，创建一个根节点XmlElement对象并命名为“PlayerInfo”。</span></span><br><span class="line">        XmlElement playerInfo = xml.CreateElement(<span class="string">&quot;PlayerInfo&quot;</span>);</span><br><span class="line">        <span class="comment">//向XmlDocument对象添加根节点XmlElement对象“playerInfo”</span></span><br><span class="line">        xml.AppendChild(playerInfo);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//4.添加子节点 或者 属性相关</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//使用CreateElement方法创建Xml子项XmlElement对象并设置它们的InnerText值。</span></span><br><span class="line">        <span class="comment">//XmlElement对象表示不带数据的标记或元素。</span></span><br><span class="line">        XmlElement name = xml.CreateElement(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        name.InnerText = <span class="keyword">this</span>.name;</span><br><span class="line">        playerInfo.AppendChild(name);</span><br><span class="line"></span><br><span class="line">        XmlElement atk = xml.CreateElement(<span class="string">&quot;atk&quot;</span>);</span><br><span class="line">        atk.InnerText = <span class="keyword">this</span>.atk.ToString();</span><br><span class="line">        playerInfo.AppendChild(atk);</span><br><span class="line"></span><br><span class="line">        XmlElement def = xml.CreateElement(<span class="string">&quot;def&quot;</span>);</span><br><span class="line">        def.InnerText = <span class="keyword">this</span>.def.ToString();</span><br><span class="line">        playerInfo.AppendChild(def);</span><br><span class="line"></span><br><span class="line">        XmlElement moveSpeed = xml.CreateElement(<span class="string">&quot;moveSpeed&quot;</span>);</span><br><span class="line">        moveSpeed.InnerText = <span class="keyword">this</span>.moveSpeed.ToString();</span><br><span class="line">        playerInfo.AppendChild(moveSpeed);</span><br><span class="line"></span><br><span class="line">        XmlElement roundSpeed = xml.CreateElement(<span class="string">&quot;roundSpeed&quot;</span>);</span><br><span class="line">        roundSpeed.InnerText = <span class="keyword">this</span>.roundSpeed.ToString();</span><br><span class="line">        playerInfo.AppendChild(roundSpeed);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建XmlElement对象表示装备与其属性</span></span><br><span class="line">        XmlElement weapon = xml.CreateElement(<span class="string">&quot;weapon&quot;</span>);</span><br><span class="line"></span><br><span class="line">        XmlElement id = xml.CreateElement(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        id.InnerText = <span class="keyword">this</span>.weapon.id.ToString();</span><br><span class="line">        weapon.AppendChild(id);</span><br><span class="line"></span><br><span class="line">        XmlElement num = xml.CreateElement(<span class="string">&quot;num&quot;</span>);</span><br><span class="line">        num.InnerText = <span class="keyword">this</span>.weapon.num.ToString();</span><br><span class="line">        weapon.AppendChild(num);</span><br><span class="line"></span><br><span class="line">        playerInfo.AppendChild(weapon);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建XmlAttribute对象表示一个整数列表（listInt）</span></span><br><span class="line">        XmlElement listInt = xml.CreateElement(<span class="string">&quot;listInt&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.listInt.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//使用CreateElement方法创建名为“int”的子节点，设置InnerText值并添加到根节点中的列表项。</span></span><br><span class="line">            XmlElement intNode = xml.CreateElement(<span class="string">&quot;int&quot;</span>);</span><br><span class="line">            intNode.InnerText = <span class="keyword">this</span>.listInt[i].ToString();</span><br><span class="line">            listInt.AppendChild(intNode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        playerInfo.AppendChild(listInt);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//构建名为$itemList的XmlElement对象，该对象将保存所有的Item项目 .</span></span><br><span class="line">        XmlElement itemList = xml.CreateElement(<span class="string">&quot;itemList&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; <span class="keyword">this</span>.itemList.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//使用CreateElement方法分别在itemList根节点下创建三个Xml子项&lt;Element&gt;对象。</span></span><br><span class="line">            XmlElement itemNode = xml.CreateElement(<span class="string">&quot;Item&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//谁每个XmlElement对象的ID和Num属性各自包含了itemList中的Item对象的ID属性和Num属性。</span></span><br><span class="line">            itemNode.SetAttribute(<span class="string">&quot;id&quot;</span>, <span class="keyword">this</span>.itemList[i].id.ToString());</span><br><span class="line">            itemNode.SetAttribute(<span class="string">&quot;num&quot;</span>, <span class="keyword">this</span>.itemList[i].num.ToString());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//将三个XmlElement对象都添加到itemList节点之下。</span></span><br><span class="line">            itemList.AppendChild(itemNode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        playerInfo.AppendChild(itemList);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//创建一个名为itemDict的XmlElement对象，该对象将保存所有Item相关数据</span></span><br><span class="line">        XmlElement itemDic = xml.CreateElement(<span class="string">&quot;itemDic&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> (<span class="built_in">int</span> key <span class="keyword">in</span> <span class="keyword">this</span>.itemDic.Keys)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//分别实例化intNode和itemNode对象来存储Dictionary&lt;int,Item&gt;对象的键值对数据。</span></span><br><span class="line">            XmlElement intNode = xml.CreateElement(<span class="string">&quot;int&quot;</span>);</span><br><span class="line">            intNode.InnerText = key.ToString();   <span class="comment">//key作为标记内部的InnerText值</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//itemNode的ID属性和Num属性包含字典项的Id属性和Num属性。</span></span><br><span class="line">            XmlElement itemNode = xml.CreateElement(<span class="string">&quot;Item&quot;</span>);</span><br><span class="line">            itemNode.SetAttribute(<span class="string">&quot;id&quot;</span>, <span class="keyword">this</span>.itemDic[key].id.ToString());</span><br><span class="line">            itemNode.SetAttribute(<span class="string">&quot;num&quot;</span>, <span class="keyword">this</span>.itemDic[key].num.ToString());</span><br><span class="line"></span><br><span class="line">            <span class="comment">//添加这两个XmlElement对象到XmlDocument对象中。</span></span><br><span class="line">            itemDic.AppendChild(intNode);</span><br><span class="line">            itemDic.AppendChild(itemNode);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//将此XmlElement对象添加到根XmlElement对象之下</span></span><br><span class="line">        playerInfo.AppendChild(itemDic);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//5.使用XmlDocument类的Save()方法将生成的XML文本与指定路径path的文件进行存储。</span></span><br><span class="line">        xml.Save(path);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">在测试类修改PlayerInfo对象的内容测试保存</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        p.name = <span class="string">&quot;L修改后的内容&quot;</span>;</span><br><span class="line">        p.listInt.Add(<span class="number">99</span>);</span><br><span class="line"></span><br><span class="line">        Item i = <span class="keyword">new</span> Item();</span><br><span class="line">        i.id = <span class="number">666</span>;</span><br><span class="line">        i.num = <span class="number">999</span>;</span><br><span class="line">        p.itemList.Add(i);</span><br><span class="line">        p.itemDic.Add(<span class="number">250</span>, i);</span><br><span class="line"></span><br><span class="line">        p.SaveData(<span class="string">&quot;PlayerInfo&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">保存XML文件</font></strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">PlayerInfo</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>L修改后的内容<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">atk</span>&gt;</span>10<span class="tag">&lt;/<span class="name">atk</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">def</span>&gt;</span>5<span class="tag">&lt;/<span class="name">def</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">moveSpeed</span>&gt;</span>20<span class="tag">&lt;/<span class="name">moveSpeed</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">roundSpeed</span>&gt;</span>20<span class="tag">&lt;/<span class="name">roundSpeed</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">weapon</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">num</span>&gt;</span>1<span class="tag">&lt;/<span class="name">num</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">weapon</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listInt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>1<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>2<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>3<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>99<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listInt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">itemList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;1&quot;</span> <span class="attr">num</span>=<span class="string">&quot;10&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;2&quot;</span> <span class="attr">num</span>=<span class="string">&quot;20&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;3&quot;</span> <span class="attr">num</span>=<span class="string">&quot;30&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;4&quot;</span> <span class="attr">num</span>=<span class="string">&quot;40&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;666&quot;</span> <span class="attr">num</span>=<span class="string">&quot;999&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">itemList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">itemDic</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>1<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;1&quot;</span> <span class="attr">num</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>2<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;2&quot;</span> <span class="attr">num</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>3<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;3&quot;</span> <span class="attr">num</span>=<span class="string">&quot;1&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>250<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Item</span> <span class="attr">id</span>=<span class="string">&quot;666&quot;</span> <span class="attr">num</span>=<span class="string">&quot;999&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">itemDic</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">PlayerInfo</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="Xml基础知识总结"><a href="#Xml基础知识总结" class="headerlink" title="Xml基础知识总结"></a>Xml基础知识总结</h2><p><strong><font size="3">优点</font></strong></p>
<ul>
<li>XML是国际通用规则<br>跨平台（游戏，软件，网页等等都能用）<br>文件结构清晰易懂<br>非常容易编辑和理解<br>可以用于网络通信交换数据</li>
</ul>
<p><strong><font size="4">缺点</font></strong></p>
<ul>
<li>重复工作量繁多<br>自定义数据类，都需要自己去实现存储读取的功能<br>而且代码的相似度极高<br>数据容易被修改<br>只要找到文件位置，就可以轻易的进行数据修改</li>
</ul>
<p><strong>&lt;font size&#x3D;””4&gt;主要用处</font></strong><br>网络游戏：</p>
<ul>
<li>可以用于存储一些客户端的简单不重要数据<br>可以用于传输信息（基本不会大范围使用，因为比较耗流量）</li>
</ul>
<p>单机游戏：</p>
<ul>
<li>用于存储游戏相关数据<br>用于配置游戏数据</li>
</ul>
<p><strong><font size="4">核心要点速览</font></strong></p>
<p><strong><font size="3">路径选择对比</font></strong></p>
<table>
<thead>
<tr>
<th>路径</th>
<th>可读</th>
<th>可写</th>
<th>打包后访问</th>
<th>使用场景</th>
</tr>
</thead>
<tbody><tr>
<td>Resources</td>
<td>✔</td>
<td>✖</td>
<td>✖（加密）</td>
<td>只读配置（如初始 XML）</td>
</tr>
<tr>
<td>StreamingAssets</td>
<td>✔</td>
<td>✖（部分平台）</td>
<td>✔</td>
<td>只读资源（如内置 XML）</td>
</tr>
<tr>
<td>Application.persistentDataPath</td>
<td>✔</td>
<td>✔</td>
<td>✔</td>
<td>玩家存档（推荐）</td>
</tr>
<tr>
<td>Application.dataPath</td>
<td>✔</td>
<td>✖</td>
<td>✖</td>
<td>编辑器调试（勿用于发布）</td>
</tr>
</tbody></table>
<h2 id="XML实践项目"><a href="#XML实践项目" class="headerlink" title="XML实践项目"></a>XML实践项目</h2><p><strong><font size="4">序列化XML</font></strong><br><code>必备知识点-CSharp中XML序列化</code></p>
<p><strong><font size="3">什么是序列化和反序列化？</font></strong></p>
<ul>
<li>序列化：把对象转化为可传输的字节序列过程称为序列化。</li>
<li>反序列化：把字节序列还原为对象的过程称为反序列化。</li>
<li>说人话：<br>序列化就是把想要存储的内容转换为字节序列用于存储或传递。<br>反序列化就是把存储或收到的字节序列信息解析读取出来使用。</li>
</ul>
<p><strong><font size="3">XML序列化</font></strong></p>
<ul>
<li>创建测试用于存储的两个类</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Lesson1Test</span></span><br><span class="line">   &#123;</span><br><span class="line">       <span class="keyword">public</span> <span class="built_in">int</span> testPublic = <span class="number">1</span>;</span><br><span class="line">       [<span class="meta">XmlElement(<span class="string">&quot;testPublic2222222222&quot;</span>)</span>]</span><br><span class="line">       <span class="keyword">public</span> <span class="built_in">int</span> testPublic2 = <span class="number">2</span>;</span><br><span class="line">       <span class="keyword">private</span> <span class="built_in">int</span> testPrivate = <span class="number">3</span>;</span><br><span class="line">       <span class="keyword">protected</span> <span class="built_in">int</span> testProtected = <span class="number">4</span>;</span><br><span class="line">       <span class="keyword">internal</span> <span class="built_in">int</span> testInternal = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">public</span> <span class="built_in">string</span> testPublicStr = <span class="string">&quot;我是testPublicStr&quot;</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">public</span> <span class="built_in">int</span> testPro &#123; <span class="keyword">get</span>; <span class="keyword">set</span>; &#125;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">public</span> Lesson1Test2 testClass = <span class="keyword">new</span> Lesson1Test2();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">public</span> <span class="built_in">int</span>[] arrayInt = <span class="keyword">new</span> <span class="built_in">int</span>[<span class="number">3</span>] &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line"></span><br><span class="line">       [<span class="meta">XmlArray(<span class="string">&quot;IntList&quot;</span>)</span>]</span><br><span class="line">       [<span class="meta">XmlArrayItem(<span class="string">&quot;Int32&quot;</span>)</span>]</span><br><span class="line">       <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; listInt = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt; &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span> &#125;;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; listInt2 = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt; &#123; <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span> &#125;;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">public</span> List&lt;Lesson1Test2&gt; listItem = <span class="keyword">new</span> List&lt;Lesson1Test2&gt; &#123; <span class="keyword">new</span> Lesson1Test2(), <span class="keyword">new</span> Lesson1Test2() &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">       <span class="comment">//不支持字典</span></span><br><span class="line">       <span class="comment">//public Dictionary&lt;int, string&gt; testDic = new Dictionary&lt;int, string&gt;() &#123; &#123; 1, &quot;123&quot; &#125; &#125;;</span></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Lesson1Test2</span></span><br><span class="line">   &#123;</span><br><span class="line">       [<span class="meta">XmlAttribute(<span class="string">&quot;Test1&quot;</span>)</span>]</span><br><span class="line">       <span class="keyword">public</span> <span class="built_in">int</span> test1 = <span class="number">1</span>;</span><br><span class="line">       [<span class="meta">XmlAttribute()</span>]</span><br><span class="line">       <span class="keyword">public</span> <span class="built_in">float</span> test2 = <span class="number">1.1f</span>;</span><br><span class="line">       [<span class="meta">XmlAttribute()</span>]</span><br><span class="line">       <span class="keyword">public</span> <span class="built_in">bool</span> test3 = <span class="literal">true</span>;</span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong><font size="3">使用XML序列化的函数存储XML</font></strong></p>
<p>1.第一步准备一个数据结构类</p>
<ul>
<li>准备一个数据结构类对象</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">   Lesson1Test lesson1Test = <span class="keyword">new</span> Lesson1Test();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>2.进行序列化</p>
<ul>
<li>关键类和语法：</li>
<li>XmlSerializer Xml序列化器类：用于序列化对象为XML的关键类</li>
<li>StreamWriter 流写入器类：用于存储文件</li>
<li>using：用于方便流对象释放和销毁</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//第一步：确定存储路径</span></span><br><span class="line"><span class="built_in">string</span> path = Application.persistentDataPath + <span class="string">&quot;/Lesson1Test.xml&quot;</span>;</span><br><span class="line">print(Application.persistentDataPath);</span><br><span class="line"></span><br><span class="line"><span class="comment">//第二步：结合 using知识点 和 StreamWriter这个流对象 来写入文件</span></span><br><span class="line"><span class="comment">// 括号内的StreamWriter相关代码的作用：写入一个文件流 传入路径 如果路径上有该文件 直接打开并修改 如果路径上没有该文件 直接新建一个文件</span></span><br><span class="line"><span class="comment">// using的新用法：括号当中包裹的声明的对象 会在 大括号语句块结束后 自动释放掉 </span></span><br><span class="line"><span class="comment">// 当大括号语句块结束 会自动帮助我们调用 对象的 Dispose这个方法 让其进行销毁</span></span><br><span class="line"><span class="comment">// using一般都是配合 内存占用比较大 或者 有读写操作时  进行使用的 </span></span><br><span class="line"><span class="keyword">using</span> (StreamWriter streamWriter = <span class="keyword">new</span> StreamWriter(path))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//第三步：进行xml文件序列化</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//创建XmlSerializer类 传入要存储的类的反射类</span></span><br><span class="line">    <span class="comment">//可以XmlSerializer理解为一个翻译成xml的翻译机器</span></span><br><span class="line">    XmlSerializer xmlSerializer = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(Lesson1Test));</span><br><span class="line"></span><br><span class="line">    <span class="comment">//XmlSerializer类中的Serialize方法 序列化对象转成xml传入六文件中</span></span><br><span class="line">    <span class="comment">//这句代码的含义 就是通过序列化对象 对我们类对象进行翻译 将其翻译成我们的xml文件 写入到对应的文件中</span></span><br><span class="line">    <span class="comment">//第一个参数 ： 文件流对象</span></span><br><span class="line">    <span class="comment">//第二个参数: 想要备翻译 的对象</span></span><br><span class="line">    <span class="comment">//注意 ：翻译机器的类型 一定要和传入的对象是一致的 不然会报错</span></span><br><span class="line">    xmlSerializer.Serialize(streamWriter, lesson1Test);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//只要是公共的的成员 都能存储 不支持字典</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>XmlSerializer.Serialize 配合流实例化对应类的序列化器进行序列化</p>
</blockquote>
<p><strong><font size="3">查看存储的XML文件</font></strong></p>
<ul>
<li>private protected internal 的变量都不能序列化 public的变量才能存储</li>
<li>不支持字典 会报错</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">Lesson1Test</span> <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">testPublic</span>&gt;</span>1<span class="tag">&lt;/<span class="name">testPublic</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">testPublic2222222222</span>&gt;</span>2<span class="tag">&lt;/<span class="name">testPublic2222222222</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">testPublicStr</span>&gt;</span>我是testPublicStr<span class="tag">&lt;/<span class="name">testPublicStr</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">testClass</span> <span class="attr">Test1</span>=<span class="string">&quot;1&quot;</span> <span class="attr">test2</span>=<span class="string">&quot;1.1&quot;</span> <span class="attr">test3</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arrayInt</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>1<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>2<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>3<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">arrayInt</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">IntList</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Int32</span>&gt;</span>1<span class="tag">&lt;/<span class="name">Int32</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Int32</span>&gt;</span>2<span class="tag">&lt;/<span class="name">Int32</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Int32</span>&gt;</span>3<span class="tag">&lt;/<span class="name">Int32</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Int32</span>&gt;</span>4<span class="tag">&lt;/<span class="name">Int32</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">IntList</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listInt2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>5<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>6<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>7<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>8<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listInt2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">listItem</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Lesson1Test2</span> <span class="attr">Test1</span>=<span class="string">&quot;1&quot;</span> <span class="attr">test2</span>=<span class="string">&quot;1.1&quot;</span> <span class="attr">test3</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">Lesson1Test2</span> <span class="attr">Test1</span>=<span class="string">&quot;1&quot;</span> <span class="attr">test2</span>=<span class="string">&quot;1.1&quot;</span> <span class="attr">test3</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">listItem</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">testPro</span>&gt;</span>0<span class="tag">&lt;/<span class="name">testPro</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Lesson1Test</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">自定义节点名或设置属性</font></strong><br>可以通过特性设置节点或设置属性，并且修改名字。</p>
<ul>
<li>[XmlAttribute()]：这个字段要变成XML的属性</li>
<li>[XmlAttribute(“Test1”)]：这个字段要变成XML的属性，并且属性名是Test1</li>
<li>[XmlElement(“testPublic123123”)]：这个字段要变成XML的元素节点，并且节点名是testPublic123123</li>
<li>[XmlArray(“IntList”)]：改变数组对象存储XML的节点名为IntList</li>
<li>[XmlArrayItem(“Int32”)]：改变数组元素对象存储XML的节点名，每个元素的节点名都变成Int32</li>
</ul>
<p><strong><font size=3>总结</font></strong><br>序列化流程：</p>
<ul>
<li>有一个想要保存的类对象</li>
<li>使用XmlSerializer序列化该对象</li>
<li>通过StreamWriter配合using将数据存储写入文件</li>
</ul>
<p>注意：</p>
<ul>
<li>只能序列化公共成员</li>
<li>不支持字典序列化</li>
<li>可以通过特性修改节点信息或者设置属性信息</li>
<li>Stream相关要配合using使用</li>
</ul>
<p><strong><font size="4">反序列化Xml</font></strong><br><code>必备知识点-CSharp中XML反序列化</code></p>
<p><strong><font size="3">知识回顾</font></strong></p>
<ul>
<li>序列化就是把类对象转换为可存储和传输的数据。</li>
<li>反序列化就是把存储或收到的数据转换为类对象。</li>
</ul>
<p><strong><font size="3">XML序列化关键知识：</font></strong></p>
<ul>
<li>1.using和StreamWriter</li>
<li>2.XmlSerializer的Serialize序列化方法</li>
</ul>
<p><strong><font size="3">判断文件是否存在</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> path = Application.persistentDataPath + <span class="string">&quot;/Lesson1Test.xml&quot;</span>;</span><br><span class="line"><span class="comment">// 存在再进行反序列化的处理，不存在就不能反序列化</span></span><br><span class="line"><span class="keyword">if</span> (File.Exists(path))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 反序列化处理</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">XmlSerializer.Deserialize：配合流实例化对应类的序列化器进行反序列化</font></strong></p>
<ul>
<li>如果路径指向的文件存在，则进行反序列化处理。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">// 使用 StreamReader 读取文件对象初始化，传入路径</span></span><br><span class="line"><span class="keyword">using</span> (StreamReader streamReader = <span class="keyword">new</span> StreamReader(path))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建 XmlSerializer 类，传入要反序列化的类的反射类</span></span><br><span class="line">    XmlSerializer xmlSerializer = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(Lesson1Test));</span><br><span class="line"></span><br><span class="line">    <span class="comment">// XmlSerializer 类中的 Deserialize 反序列化方法，反序列化对应 streamReader 读取到的内容，返回值是万物之父</span></span><br><span class="line">    Lesson1Test lesson1Test = xmlSerializer.Deserialize(streamReader) <span class="keyword">as</span> Lesson1Test;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 注意：如果要读取的类的列表成员变量声明时初始化就赋值了，反序列化出来会有两倍数组</span></span><br><span class="line">    <span class="comment">// 比如：public List&lt;int&gt; listInt = new List&lt;int&gt; &#123; 1, 2, 3 &#125;; 反序列化出来的 listInt 会有 &#123; 1, 2, 3,1, 2, 3 &#125;;</span></span><br><span class="line">    <span class="comment">// 所以最好不要在读取的类的列表成员变量声明时初始化就赋值</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意：如果要读取的类的列表成员变量声明时初始化就赋值了，反序列化出来会有两倍数组<br>比如：public List<int> listInt &#x3D; new List<int> { 1, 2, 3 }; 反序列化出来的 listInt 会有 { 1, 2, 3,1, 2, 3 };<br>所以最好不要在读取的类的列表成员变量声明时初始化就赋值</p>
</blockquote>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/XML%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E7%9A%84%E5%B0%8F%E5%9D%91.png" class="" title="XML反序列化的小坑"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<p><strong><font size="3">总结</font></strong></p>
<ul>
<li>判断文件是否存在使用 File.Exists</li>
<li>获取文件流使用 StreamReader streamReader &#x3D; new StreamReader(path)</li>
<li>根据文件流，通过 XmlSerializer 的 Deserialize 反序列化出对象</li>
<li>注意：List 对象如果有默认值，在反序列化时不会清空，会往后面添加。</li>
</ul>
<p><strong><font size="4">IXmlSerializable接口</font></strong><br><code>必备知识点-IXmlSerializable接口</code></p>
<p><strong><font size="3">IXmlSerializable是什么</font></strong></p>
<ul>
<li>C# 的 XmlSerializer 接口提供了可拓展内容，可以让一些不能被序列化和反序列化的特殊类能够被处理。通过让特殊类继承 IXmlSerializable 接口并实现其中的方法，就能实现这一点。例如，字典就不能直接序列化，但可以通过自定义拓展让其序列化。</li>
</ul>
<p><strong><font size="3">自定义类实践</font></strong></p>
<ul>
<li>创建 TestLesson3 自定义类，实现IXmlSerializable接口</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//让自定义的类TestLesson3继承IXmlSerializable这个接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestLesson3</span> : <span class="title">IXmlSerializable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> test1;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> test2;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//继承IXmlSerializable接口必须要实现的方法 返回结构</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> XmlSchema <span class="title">GetSchema</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//返回空就行</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//继承IXmlSerializable接口必须要实现的方法 反序列化时 会自动调用的方法</span></span><br><span class="line">    <span class="comment">//在里面可以自定义反序列化 的规则</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ReadXml</span>(<span class="params">XmlReader xmlReader</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//如果要自定义 序列化的规则 一定会用到 XmlReader中的一些方法 来进行序列化</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/1.读属性</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/XmlReader[&quot;属性名&quot;] 读属性 看要不要转类型</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/<span class="doctag">&lt; TestLesson3 test1 = &quot;0&quot; test2 = &quot;123&quot; /&gt;</span></span></span><br><span class="line">        <span class="comment">//this.test1 = int.Parse(xmlReader[&quot;test1&quot;]);</span></span><br><span class="line">        <span class="comment">//this.test2 = xmlReader[&quot;test2&quot;];</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/2.读节点</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/XmlReader读节点</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/<span class="doctag">&lt; TestLesson3 &gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/  <span class="doctag">&lt; test1 &gt;</span> 0 <span class="doctag">&lt;/ test1 &gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/  <span class="doctag">&lt; test2 &gt;</span> 123 <span class="doctag">&lt;/ test2 &gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/<span class="doctag">&lt;/ TestLesson3 &gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/有两种方式</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/方式一</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/XmlReader中的Read方法</span></span><br><span class="line">        <span class="comment">//xmlReader.Read();//这时是读到的是第一个子节点的首节点 test1节点 &lt;test1&gt;</span></span><br><span class="line">        <span class="comment">//xmlReader.Read();//这时是读到的是第一个子节点包裹的内容 test1节点包裹的内容 0</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/XmlReader中的Value变量 得到当前内容的值 在转类型</span></span><br><span class="line">        <span class="comment">//this.test1 = int.Parse(xmlReader.Value);//得到当前内容的值 0</span></span><br><span class="line">        <span class="comment">//xmlReader.Read();//这时读到的是第一个子节点的尾部节点 包裹节点 &lt;/test1&gt;</span></span><br><span class="line">        <span class="comment">//xmlReader.Read();//这时是读到的是第二个子节点的首节点 test2节点 &lt;test2&gt;</span></span><br><span class="line">        <span class="comment">//xmlReader.Read();//这时是读到的是第二个子节点包裹的内容 test2节点包裹的内容 123</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/XmlReader中的Value变量 得到当前内容的值 本来就是string 不用转类型</span></span><br><span class="line">        <span class="comment">//this.test2 = xmlReader.Value;////得到当前内容的值 123</span></span><br><span class="line">        <span class="comment">//xmlReader.Read();//这时读到的是第二个子节点的尾部节点 包裹节点 &lt;/test2&gt;</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/方式二</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/XmlReader中的Read方法有返回值 假如能读就一直读</span></span><br><span class="line">        <span class="comment">//while (xmlReader.Read())</span></span><br><span class="line">        <span class="comment">//&#123;</span></span><br><span class="line">        <span class="comment">//    //XmlReaderd中的NodeType变量 判断当前节点是不是元素</span></span><br><span class="line">        <span class="comment">//    if (xmlReader.NodeType == XmlNodeType.Element)</span></span><br><span class="line">        <span class="comment">//    &#123;</span></span><br><span class="line">        <span class="comment">//        //判断当前xmlReader读到的名字</span></span><br><span class="line">        <span class="comment">//        switch (xmlReader.Name)</span></span><br><span class="line">        <span class="comment">//        &#123;</span></span><br><span class="line">        <span class="comment">//            //如果名字和自己想要读的节点名的名字相同 就在读一次 获取里面的值</span></span><br><span class="line">        <span class="comment">//            case &quot;test1&quot;:</span></span><br><span class="line">        <span class="comment">//                xmlReader.Read();</span></span><br><span class="line">        <span class="comment">//                this.test1 = int.Parse(xmlReader.Value);</span></span><br><span class="line">        <span class="comment">//                break;</span></span><br><span class="line">        <span class="comment">//            case &quot;test2&quot;:</span></span><br><span class="line">        <span class="comment">//                xmlReader.Read();</span></span><br><span class="line">        <span class="comment">//                this.test2 = xmlReader.Value;</span></span><br><span class="line">        <span class="comment">//                break;</span></span><br><span class="line">        <span class="comment">//        &#125;</span></span><br><span class="line">        <span class="comment">//    &#125;</span></span><br><span class="line">        <span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.读包裹元素节点</span></span><br><span class="line">        <span class="comment">//使用XmlSerializer翻译机器配合着XmlReader中的ReadStartElement方法、XmlReader中的Deserialize方法和XmlWriter中的ReadEndElement方法</span></span><br><span class="line">        <span class="comment">//读在节点中间再包裹一层节点</span></span><br><span class="line">        <span class="comment">//&lt; TestLesson3 &gt;</span></span><br><span class="line">        <span class="comment">//  &lt; test1 &gt;</span></span><br><span class="line">        <span class="comment">//    &lt; int &gt; 0 &lt;/ int &gt;</span></span><br><span class="line">        <span class="comment">//  &lt;/ test1 &gt;</span></span><br><span class="line">        <span class="comment">//  &lt; test2 &gt;</span></span><br><span class="line">        <span class="comment">//    &lt; string &gt; 123 &lt;/ string &gt;</span></span><br><span class="line">        <span class="comment">//  &lt;/ test2 &gt;</span></span><br><span class="line">        <span class="comment">//&lt;/ TestLesson3 &gt;</span></span><br><span class="line">        <span class="comment">// 创建两个XmlSerializer实例。其中一个用于将XML中的int类型数据反序列化，另一个用于将XML中的string类型数据反序列化。</span></span><br><span class="line">        XmlSerializer xmlSerializer1 = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(<span class="built_in">int</span>));</span><br><span class="line">        XmlSerializer xmlSerializer2 = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(<span class="built_in">string</span>));</span><br><span class="line">        <span class="comment">// 跳过根节点，开始读取XML中的内容。</span></span><br><span class="line">        xmlReader.Read();</span><br><span class="line">        <span class="comment">//XmlReader中的ReadStartElement方法 ReadStartElement将XML阅读器移动到下一个元素并检查它是否具有给定的本地名称和命名空间</span></span><br><span class="line">        <span class="comment">//这里我们将XML阅读器移动到&quot;test1&quot;元素，并准备将其反序列化为 int 类型。</span></span><br><span class="line">        xmlReader.ReadStartElement(<span class="string">&quot;test1&quot;</span>);</span><br><span class="line">        <span class="comment">//XmlReader中的Deserialize方法 反序列化从 XML 中读取的int值，和前面代码块序列化时对应的成员名必须一致</span></span><br><span class="line">        test1 = (<span class="built_in">int</span>)xmlSerializer1.Deserialize(xmlReader);</span><br><span class="line">        <span class="comment">//XmlWriter中的ReadEndElement方法 阅读器从当前位置读取并跳过此元素的内容，然后向前移动到兄弟元素或父元素关闭，即关闭“test1”元素。</span></span><br><span class="line">        xmlReader.ReadEndElement();</span><br><span class="line">        <span class="comment">// 将XML阅读器移动到XML文档中的&quot;test2&quot;元素。准备将它反序列化为 string类型，</span></span><br><span class="line">        xmlReader.ReadStartElement(<span class="string">&quot;test2&quot;</span>);</span><br><span class="line">        <span class="comment">// 反序列化从 XML 中读取的string值。和前面代码块序列化时对应的成员名必须保持一致。</span></span><br><span class="line">        <span class="comment">//由于反序列化string之后获得的是object类型的结果，因此需要使用ToString()将其转换为string类型。</span></span><br><span class="line">        test2 = xmlSerializer2.Deserialize(xmlReader).ToString();</span><br><span class="line">        <span class="comment">// 阅读器从当前位置读取并跳过此元素的内容，然后向前移动到兄弟元素或父元素关闭，即“test2”元素。</span></span><br><span class="line">        xmlReader.ReadEndElement();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//继承IXmlSerializable接口必须要实现的方法</span></span><br><span class="line">    <span class="comment">//假如继继承IXmlSerializable接口 序列化时 会自动调用的方法</span></span><br><span class="line">    <span class="comment">//在里面可以自定义序列化 的规则</span></span><br><span class="line">    <span class="comment">//假如继承IXmlSerializable接口 但是里面又啥都没写 序列化出来的xml就只有固定内容和一个根节点</span></span><br><span class="line">    <span class="comment">//&lt;TestLesson3 /&gt;</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">WriteXml</span>(<span class="params">XmlWriter xmlWriter</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//如果要自定义 序列化的规则 一定会用到 XmlWriter中的一些方法 来进行序列化</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/1.写属性</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/XmlWriter类中的WriteAttributeString方法 写属性 传入属性名并且传入属性值转string</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/<span class="doctag">&lt; TestLesson3 test1 = &quot;0&quot; test2 = &quot;123&quot; /&gt;</span></span></span><br><span class="line">        <span class="comment">//xmlWriter.WriteAttributeString(&quot;test1&quot;, this.test1.ToString());</span></span><br><span class="line">        <span class="comment">//xmlWriter.WriteAttributeString(&quot;test2&quot;, this.test2);</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/这样根节点下就有test1和test2两个属性</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/2.写节点</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/XmlWriter类中的WriteElementString方法 写节点 传入节点名并且传入节点值转string</span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/<span class="doctag">&lt; TestLesson3 &gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/  <span class="doctag">&lt; test1 &gt;</span> 0 <span class="doctag">&lt;/ test1 &gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/  <span class="doctag">&lt; test2 &gt;</span> 123 <span class="doctag">&lt;/ test2 &gt;</span></span></span><br><span class="line">        <span class="comment"><span class="doctag">///</span>/<span class="doctag">&lt;/ TestLesson3 &gt;</span></span></span><br><span class="line">        <span class="comment">//xmlWriter.WriteElementString(&quot;test1&quot;, this.test1.ToString());</span></span><br><span class="line">        <span class="comment">//xmlWriter.WriteElementString(&quot;test2&quot;, this.test2);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//3.写包裹节点</span></span><br><span class="line">        <span class="comment">//使用XmlSerializer翻译机器配合着XmlWriter中的WriteStartElement方法、XmlWriter中的Serialize方法和XmlWriter中的WriteEndElement方法</span></span><br><span class="line">        <span class="comment">//在节点中间再包裹一层节点</span></span><br><span class="line">        <span class="comment">//&lt; TestLesson3 &gt;</span></span><br><span class="line">        <span class="comment">//  &lt; test1 &gt;</span></span><br><span class="line">        <span class="comment">//    &lt; int &gt; 0 &lt;/ int &gt;</span></span><br><span class="line">        <span class="comment">//  &lt;/ test1 &gt;</span></span><br><span class="line">        <span class="comment">//  &lt; test2 &gt;</span></span><br><span class="line">        <span class="comment">//    &lt; string &gt; 123 &lt;/ string &gt;</span></span><br><span class="line">        <span class="comment">//  &lt;/ test2 &gt;</span></span><br><span class="line">        <span class="comment">//&lt;/ TestLesson3 &gt;</span></span><br><span class="line">        <span class="comment">// 创建XmlSerializer实例，指定我们要序列化/反序列化的对象类型为int。</span></span><br><span class="line">        XmlSerializer xmlSerializer1 = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(<span class="built_in">int</span>));</span><br><span class="line">        <span class="comment">// XmlWriter中的WriteStartElement方法  将一个名为&quot;test1&quot;的元素写入XML Writer流中</span></span><br><span class="line">        xmlWriter.WriteStartElement(<span class="string">&quot;test1&quot;</span>);</span><br><span class="line">        <span class="comment">//XmlWriter中的Serialize方法 使用XmlSerializer将test1 int变量序列化成XML格式，并将其写入由xmlWriter引用的文本编写器位置。</span></span><br><span class="line">        xmlSerializer1.Serialize(xmlWriter, test1);</span><br><span class="line">        <span class="comment">// XmlWriter中的WriteEndElement方法  标记已完成在此元素周围对属性和子元素的操作，即关闭“test1”元素。</span></span><br><span class="line">        xmlWriter.WriteEndElement();</span><br><span class="line">        <span class="comment">// 接下来，建立另一个XmlSerializer实例，指定其被序列化的对象类型为string。</span></span><br><span class="line">        XmlSerializer xmlSerializer2 = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(<span class="built_in">string</span>));</span><br><span class="line">        <span class="comment">// 将名为&quot;test2&quot;的元素写入XML Writer流中</span></span><br><span class="line">        xmlWriter.WriteStartElement(<span class="string">&quot;test2&quot;</span>);</span><br><span class="line">        <span class="comment">//XmlWriter中的Serialize方法 使用XmlSerializer将test2 string变量序列化成XML格式，并将其写入由xmlWriter引用的文本编写器位置.</span></span><br><span class="line">        xmlSerializer2.Serialize(xmlWriter, test2);</span><br><span class="line">        <span class="comment">// 标记已完成在此元素周围对属性和子元素的操作，即关闭“test2”元素。</span></span><br><span class="line">        xmlWriter.WriteEndElement();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">实践序列化和反序列化</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建一个TestLesson3实例</span></span><br><span class="line">        TestLesson3 TestLesson3_1 = <span class="keyword">new</span> TestLesson3();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 给TestLesson3_1的test1和test2赋值</span></span><br><span class="line">        TestLesson3_1.test1 = <span class="number">666</span>;</span><br><span class="line">        <span class="comment">// 注意：假如是引用类型对象 没有初始化的话不会存到xml上去</span></span><br><span class="line">        TestLesson3_1.test2 = <span class="string">&quot;123&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取应用程序可以访问的持久数据路径，并在其末尾添加要保存的文件名。</span></span><br><span class="line">        <span class="built_in">string</span> path = Application.persistentDataPath + <span class="string">&quot;/TestLesson3.xml&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 用Writter对象创建StreamWriter实例流来写文件到path上</span></span><br><span class="line">        <span class="keyword">using</span> (StreamWriter streamWriter = <span class="keyword">new</span> StreamWriter(path))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 先创建一个XmlSerializer实例，以说明我们正在序列化什么类型的对象</span></span><br><span class="line">            XmlSerializer xmlSerializer = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(TestLesson3));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 使用XmlSerializer将已创建的TestLesson3序列化为XML，并将其写入由streamReader引用的位置。</span></span><br><span class="line">            <span class="comment">// 在序列化时  如果对象中的引用成员 为空 那么xml里面是看不到该字段的</span></span><br><span class="line">            xmlSerializer.Serialize(streamWriter, TestLesson3_1);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用StreamReader从磁盘中读取path路径上的XML信息并读取到此代码块中自定义的新的实例中</span></span><br><span class="line">        <span class="keyword">using</span> (StreamReader streamReader = <span class="keyword">new</span> StreamReader(path))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 序列化&quot;翻译机器&quot;，这里也是通过XmlSerializer实现反序列化操作</span></span><br><span class="line">            XmlSerializer xmlSerializer = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(TestLesson3));</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 反序列化 把流传进去as成TestLesson3</span></span><br><span class="line">            TestLesson3 TestLesson3_2 = xmlSerializer.Deserialize(streamReader) <span class="keyword">as</span> TestLesson3;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">验证序列化和反序列化</font></strong></p>
<ul>
<li>查看路径下序列化的xml文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">TestLesson3</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">test1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>666<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">test1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">test2</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>123<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">test2</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">TestLesson3</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">断点查看反序列化是否成功</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/XML_IXmlSerializable%E6%8E%A5%E5%8F%A3%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96.png" class="" title="XML_IXmlSerializable接口反序列化"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<p><strong><font size="3">总结</font></strong></p>
<ul>
<li>IXmlSerializable 接口允许自定义类的序列化和反序列化。</li>
<li>在自定义类中实现 IXmlSerializable 接口的方法，可以定义序列化和反序列化的规则。</li>
<li>在 Start 方法中，可以实践序列化和反序列化操作。</li>
</ul>
<p><strong><font size="4">Dictionary支持Xml序列化反序列化</font></strong><br><code>必备知识点-让Dictionary支持序列化反序列化</code></p>
<p><strong><font size="3">思考如何让Dictionary支持xml序列和反序列化</font></strong></p>
<ul>
<li>我们没办法修改C#自带的类</li>
<li>那我们可以重写一个类 继承Dictionary 然后让这个类继承序列化拓展接口IXmlSerializable</li>
<li>实现里面的序列化和反序列化方法即可</li>
</ul>
<p><strong><font size="3">让Dictionary支持序列化和反序列化</font></strong></p>
<ul>
<li>声明SerizlizerDictionary类，继承Dictionary和IXmlSerializable接口，实现自定义序列化反序列化字典</li>
<li>这是一个继承自Dictionary，实现了IXmlSerializable接口的自定义字典类型，用于XML序列化和反序列化键值对数据。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">SerizlizerDictionary</span>&lt;<span class="title">TKey</span>, <span class="title">TValue</span>&gt; : <span class="title">Dictionary</span>&lt;<span class="title">TKey</span>, <span class="title">TValue</span>&gt;, <span class="title">IXmlSerializable</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 返回空值。GetSchema方法是必须由接口 IXMlSerializable实现的方法，但在此类中不需要使用它。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> XmlSchema <span class="title">GetSchema</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义字典类型（继承自Dictionary）的反序列化规则。接受一个XmlReader阅读器作为反序列化数据源。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">ReadXml</span>(<span class="params">XmlReader xmlReader</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 创建两个XmlSerializer实例，一个key的类型、一个是value的类型，用于反序列化XML流中的键值对数据。</span></span><br><span class="line">        XmlSerializer keyXmlSerializer = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(TKey));</span><br><span class="line">        XmlSerializer valueXmlSerializer = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(TValue));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 要跳过根节点</span></span><br><span class="line">        xmlReader.Read();</span><br><span class="line">        <span class="comment">// 只要当前节点不为EndElement，则意味着还可以读取到新的节点，继续反序列化操作。</span></span><br><span class="line">        <span class="keyword">while</span> (xmlReader.NodeType != XmlNodeType.EndElement)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 反序列化从XML阅读器读取的键对象，并进行强制类型转换到泛型TKey类别 </span></span><br><span class="line">            TKey key = (TKey)keyXmlSerializer.Deserialize(xmlReader);</span><br><span class="line">            <span class="comment">// 反序列化从XML阅读器读取的值对象，并进行强制类型转换到泛型TValue类别 </span></span><br><span class="line">            TValue <span class="keyword">value</span> = (TValue)valueXmlSerializer.Deserialize(xmlReader);</span><br><span class="line">            <span class="comment">// 将键和值添加到字典中</span></span><br><span class="line">            <span class="keyword">this</span>.Add(key, <span class="keyword">value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 要跳过尾节点 避免影响之后的数据读取</span></span><br><span class="line">        xmlReader.Read();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 自定义字典类型的序列化规则。使用提供的XmlWriter实例将该字典序列化为XML。</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">WriteXml</span>(<span class="params">XmlWriter xmlWriter</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 创建两个XmlSerializer实例，一个key的类型、一个是value的类型，用于序列化键值对数据。</span></span><br><span class="line">        XmlSerializer keyXmlSerializer = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(TKey));</span><br><span class="line">        XmlSerializer valueXmlSerializer = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(TValue));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用foreach循环安全遍历字典中所有的键值对象，并依次将其序列化到由writer引用的输出流中。</span></span><br><span class="line">        <span class="keyword">foreach</span> (KeyValuePair&lt;TKey, TValue&gt; kv <span class="keyword">in</span> <span class="keyword">this</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 序列化键和值到writer流。</span></span><br><span class="line">            keyXmlSerializer.Serialize(xmlWriter, kv.Key);</span><br><span class="line">            valueXmlSerializer.Serialize(xmlWriter, kv.Value);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong><font size="3">测试自定义序列化字典的序列化和反序列化</font></strong></p>
<ul>
<li>在TestLesson4类定义了一个公共int类型成员test1，“SerizlizerDictionary&lt;int, string&gt;”自定义字典类型变量serizlizerDictionary。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestLesson4</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> test1; <span class="comment">// 定义一个公共int类型变量 test1.</span></span><br><span class="line">    <span class="keyword">public</span> SerizlizerDictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; serizlizerDictionary;<span class="comment">//自定义一个 字典 类型 serizlizerDictionary.</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 先通过创建TestLesson4类类型变量testLesson4_1并为其 serizlizerDictionary 成员 添加了三个键值对数据，调用Application对象的 persistentDataPath 成员获取应用程序数据路径，使用StreamWriter类打开要输出的文件流</span></span><br><span class="line">    TestLesson4 testLesson4_1 = <span class="keyword">new</span> TestLesson4();</span><br><span class="line">    testLesson4_1.serizlizerDictionary = <span class="keyword">new</span> SerizlizerDictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt;();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 向 serizlizerDictionary 添加三个键值对。</span></span><br><span class="line">    testLesson4_1.serizlizerDictionary.Add(<span class="number">1</span>, <span class="string">&quot;123&quot;</span>);</span><br><span class="line">    testLesson4_1.serizlizerDictionary.Add(<span class="number">2</span>, <span class="string">&quot;234&quot;</span>);</span><br><span class="line">    testLesson4_1.serizlizerDictionary.Add(<span class="number">3</span>, <span class="string">&quot;345&quot;</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 通过Application对象的 persistentDataPath 成员获取用于存储数据文件的路径。并将路径记录在日志中以进行调试验证.</span></span><br><span class="line">    <span class="built_in">string</span> path = Application.persistentDataPath + <span class="string">&quot;/TestLesson4.xml&quot;</span>;</span><br><span class="line">    Debug.Log(path);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用StreamWriter类为指定的文件建立新的编写器，并使用测试程序运行时序列化器生成 XML 文档。然后将XML文档提交给StreamWriter文本流进行保存。</span></span><br><span class="line">    <span class="keyword">using</span> (StreamWriter streamWriter = <span class="keyword">new</span> StreamWriter(path))</span><br><span class="line">    &#123;</span><br><span class="line">        XmlSerializer xmlSerializer = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(TestLesson4));</span><br><span class="line">        xmlSerializer.Serialize(streamWriter, testLesson4_1);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 接下来我们要反序列化上面序列化的文件，将XML数据中的内容读取到一个新的 TestLesson4实例 对象testLesson4_2中</span></span><br><span class="line">    TestLesson4 testLesson4_2 = <span class="keyword">new</span> TestLesson4();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用StreamReader打开创建的存成XML格式的文件，XmlSerializer生成适当的类以反序列化 XML 文档，动态将其转换为 TestLesson4 类型，然后将反序列化得到TestLesson4对象的应用返回到 testLesson4_2.</span></span><br><span class="line">    <span class="keyword">using</span> (StreamReader streamReader = <span class="keyword">new</span> StreamReader(path))</span><br><span class="line">    &#123;</span><br><span class="line">        XmlSerializer xmlSerializer = <span class="keyword">new</span> XmlSerializer(<span class="keyword">typeof</span>(TestLesson4));</span><br><span class="line">        testLesson4_2 = xmlSerializer.Deserialize(streamReader) <span class="keyword">as</span> TestLesson4;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 至此，整个操作过程完成，TestLesson4 对象已被序列化为XML，再通过反序列化将XML数据导入了一个新的TestLesson4实例对象testLesson4_2中。</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">验证序列化和反序列化</font></strong></p>
<ul>
<li>查看路径下序列化的xml文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">TestLesson4</span> <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">test1</span>&gt;</span>0<span class="tag">&lt;/<span class="name">test1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">serizlizerDictionary</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>1<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>123<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>2<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>234<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>3<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">string</span>&gt;</span>345<span class="tag">&lt;/<span class="name">string</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">serizlizerDictionary</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">TestLesson4</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">断点查看反序列化是否成功</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/XML_Dictionary%E6%94%AF%E6%8C%81Xml%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96.png" class="" title="XML_Dictionary支持Xml反序列化"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>



<p><strong><font size="4">需求分析和Xml数据管理类创建</font></strong><br><code>需求分析和Xml数据管理类创建</code></p>
<p><strong><font size="3">需求分析</font></strong><br>目标：</p>
<ul>
<li>提供公共的序列化和反序列化方法给外部</li>
<li>方便外部存储和获取数据</li>
</ul>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/XML%E6%95%B0%E6%8D%AE%E7%AE%A1%E7%90%86%E7%B1%BB.png" class="" title="XML数据管理类-需求分析"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>


<p><strong><font size="3">创建XML数据管理类并实现单例</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">XmlDataMgr</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> XmlDataMgr instance = <span class="keyword">new</span> XmlDataMgr();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> XmlDataMgr Instance =&gt; instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">XmlDataMgr</span>()</span> &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">声明存储和读取的方法</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 保存数据到xml文件中</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;data&quot;&gt;</span>数据对象<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;fileName&quot;&gt;</span>文件名<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SaveData</span>(<span class="params"><span class="built_in">object</span> data, <span class="built_in">string</span> fileName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 从xml文件中读取内容 </span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;type&quot;&gt;</span>对象类型<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;fileName&quot;&gt;</span>文件名<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">LoadData</span>(<span class="params">Type type, <span class="built_in">string</span> fileName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong><font size="4">存储数据和读取数据</font></strong><br><code>Xml数据管理类存储数据和读取数据</code></p>
<p><strong><font size="3">实现存储逻辑</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 将数据对象序列化之后保存到xml格式文件中。</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;data&quot;&gt;</span>要存储的数据对象<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;fileName&quot;&gt;</span>指定存储的文件名。注意，不需要包括后缀&quot;.xml&quot;。<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SaveData</span>(<span class="params"><span class="built_in">object</span> data, <span class="built_in">string</span> fileName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获取该数据类型存储XML文件的路径</span></span><br><span class="line">    <span class="built_in">string</span> path = Application.persistentDataPath + <span class="string">&quot;/&quot;</span> + fileName + <span class="string">&quot;.xml&quot;</span>;</span><br><span class="line">    <span class="keyword">using</span> (StreamWriter streamWriter = <span class="keyword">new</span> StreamWriter(path))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 对数据进行序列化处理（使用 XML 序列化方式）</span></span><br><span class="line">        XmlSerializer xmlSerializer = <span class="keyword">new</span> XmlSerializer(data.GetType());</span><br><span class="line">        xmlSerializer.Serialize(streamWriter, data);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">实现读取逻辑</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 从指定的xml文件反序列化出对象实例并返回。</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;type&quot;&gt;</span>指定反序列化得到的对象类型<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;fileName&quot;&gt;</span>指定读取的文件名。注意，请不要包含后缀&quot;.xml&quot;。<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>返回反序列化得到的对象实例。<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="built_in">object</span> <span class="title">LoadData</span>(<span class="params">Type type, <span class="built_in">string</span> fileName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获取该数据类型存储XML文件的路径</span></span><br><span class="line">    <span class="built_in">string</span> path = Application.persistentDataPath + <span class="string">&quot;/&quot;</span> + fileName + <span class="string">&quot;.xml&quot;</span>;</span><br><span class="line">    <span class="comment">// 如果数据文件不存在，则不做任何处理，直接返回一个实例对象</span></span><br><span class="line">    <span class="keyword">if</span> (!File.Exists(path))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 尝试从默认读取路径中尝试读取文件。如果包含该文件，则尝试获取其信息并进行反序列化。</span></span><br><span class="line">        path = Application.streamingAssetsPath + <span class="string">&quot;/&quot;</span> + fileName + <span class="string">&quot;.xml&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span> (!File.Exists(path))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 不幸的是，即使在默认路径中也找不到该文件，因此我们将无法从XML文件中反序列化任何内容，所以要新建一个对象来返回。</span></span><br><span class="line">            <span class="keyword">return</span> Activator.CreateInstance(type);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 存在XML文件，于是我们创建文本读写器，将XML文件转换为对象并返回之。</span></span><br><span class="line">    <span class="keyword">using</span> (StreamReader streamReader = <span class="keyword">new</span> StreamReader(path))</span><br><span class="line">    &#123;</span><br><span class="line">        XmlSerializer xmlSerializer = <span class="keyword">new</span> XmlSerializer(type);</span><br><span class="line">        <span class="keyword">return</span> xmlSerializer.Deserialize(streamReader);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">测试Xml数据管理类</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestItem99</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> id = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> num = <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestClass99</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> test1;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> test2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> TestItem99 item;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> TestItem99[] array;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;TestItem99&gt; list;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> SerizlizerDictionary&lt;<span class="built_in">int</span>, TestItem99&gt; dic;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">XmlDataMgrTest</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        TestClass99 t99 = XmlDataMgr.Instance.LoadData(<span class="keyword">typeof</span>(TestClass99), <span class="string">&quot;Test99&quot;</span>) <span class="keyword">as</span> TestClass99;</span><br><span class="line">        Debug.Log(<span class="string">$&quot;t99.test1:<span class="subst">&#123;t99.test1&#125;</span> t99.test2:<span class="subst">&#123;t99.test2&#125;</span> t99.item:<span class="subst">&#123;t99.item&#125;</span> t99.array:<span class="subst">&#123;t99.array&#125;</span> t99.list:<span class="subst">&#123;t99.list&#125;</span> t99.dic:<span class="subst">&#123;t99.dic&#125;</span>&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        t99 = <span class="keyword">new</span> TestClass99();</span><br><span class="line">        t99.test1 = <span class="number">1</span>;</span><br><span class="line">        t99.test2 = <span class="string">&quot;L&quot;</span>;</span><br><span class="line">        t99.item = <span class="keyword">new</span> TestItem99();</span><br><span class="line">        t99.array = <span class="keyword">new</span> TestItem99[<span class="number">2</span>] &#123; <span class="keyword">new</span> TestItem99(), <span class="keyword">new</span> TestItem99() &#125;;</span><br><span class="line"></span><br><span class="line">        t99.list = <span class="keyword">new</span> List&lt;TestItem99&gt;() &#123; <span class="keyword">new</span> TestItem99() &#125;;</span><br><span class="line"></span><br><span class="line">        t99.dic = <span class="keyword">new</span> SerizlizerDictionary&lt;<span class="built_in">int</span>, TestItem99&gt;() &#123; &#123; <span class="number">1</span>, <span class="keyword">new</span> TestItem99() &#125;, &#123; <span class="number">2</span>, <span class="keyword">new</span> TestItem99() &#125; &#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        XmlDataMgr.Instance.SaveData(t99, <span class="string">&quot;Test99&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">查看测试结果</font></strong></p>
<ul>
<li>查看路径下的xml文件</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;utf-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">TestClass99</span> <span class="attr">xmlns:xsd</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema&quot;</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">test1</span>&gt;</span>1<span class="tag">&lt;/<span class="name">test1</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">test2</span>&gt;</span>L<span class="tag">&lt;/<span class="name">test2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span>&gt;</span>1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">num</span>&gt;</span>10<span class="tag">&lt;/<span class="name">num</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">array</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TestItem99</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">num</span>&gt;</span>10<span class="tag">&lt;/<span class="name">num</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">TestItem99</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TestItem99</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">num</span>&gt;</span>10<span class="tag">&lt;/<span class="name">num</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">TestItem99</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">array</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TestItem99</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">num</span>&gt;</span>10<span class="tag">&lt;/<span class="name">num</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">TestItem99</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">dic</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>1<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TestItem99</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">num</span>&gt;</span>10<span class="tag">&lt;/<span class="name">num</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">TestItem99</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">int</span>&gt;</span>2<span class="tag">&lt;/<span class="name">int</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">TestItem99</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">num</span>&gt;</span>10<span class="tag">&lt;/<span class="name">num</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">TestItem99</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">dic</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">TestClass99</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">查看测试读取存储的Log</font></strong></p>
<h1 id="Json"><a href="#Json" class="headerlink" title="Json"></a>Json</h1><h2 id="Json基础知识概述"><a href="#Json基础知识概述" class="headerlink" title="Json基础知识概述"></a>Json基础知识概述</h2><h2 id="Json基本语法"><a href="#Json基本语法" class="headerlink" title="Json基本语法"></a>Json基本语法</h2><p><strong><font size="4">学习内容</font></strong></p>
<ul>
<li>1.用什么编辑JSon文件</li>
<li>2.创建Json文件</li>
<li>3.注释</li>
<li>4.语法规则</li>
</ul>
<p><strong><font size="4">用什么编辑Json文件？</font></strong></p>
<ul>
<li>只要能打开文档的软件都能打开Json文件</li>
<li>常用的一些编辑Json文件的方式</li>
<li>1.系统自带——记事本、写字板</li>
<li>2.通用文件编辑器——Sublime Text等等</li>
<li>3.网页上的Json编辑器</li>
</ul>
<p><strong><font size="4">创建Json</font></strong></p>
<ul>
<li>直接右键创建文本，后缀改为Json</li>
<li>选择自己喜欢的用于编辑Json的软件进行文本编辑</li>
</ul>
<p><strong><font size="4">注释</font></strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注释内容</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*sakjdfkasdf</span></span><br><span class="line"><span class="comment">sadfasdf</span></span><br><span class="line"><span class="comment">asdfasdfsadf*/</span></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">Json格式是一种键值对结构</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/Json_%E9%94%AE%E5%80%BC%E5%AF%B9%E7%BB%93%E6%9E%84.png" class="" title="Json_键值对结构"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<p><strong><font size="4">语法规则</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/Json_%E8%AF%AD%E6%B3%95%E8%A7%84%E5%88%99.png" class="" title="Json_语法规则"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<p><strong><font size="4">Json数据和类对象的对应关系</font></strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//大括号包裹的代表一个对象</span></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="comment">//冒号 代表的是 键值对的对应关系</span></span><br><span class="line">    <span class="comment">//逗号 就是分割成员变量的间隔符</span></span><br><span class="line">    <span class="comment">//Json当中的键一定要用 双引号包裹</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;L&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">//用于测试的 浮点类型 是支持浮点数的</span></span><br><span class="line">    <span class="attr">&quot;testF&quot;</span><span class="punctuation">:</span><span class="number">1.4</span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">//中括号代表数组</span></span><br><span class="line">    <span class="attr">&quot;ids&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;students&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;小红&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span> <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;小明&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span> <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">                <span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;小强&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span> <span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;home&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;address&quot;</span><span class="punctuation">:</span><span class="string">&quot;成都&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;street&quot;</span><span class="punctuation">:</span><span class="string">&quot;春熙路&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;son&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span></span><br><span class="line">    <span class="comment">//字典的话 键会变成双引号 以后转换时要注意！！！</span></span><br><span class="line">    <span class="attr">&quot;dic&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;1&quot;</span><span class="punctuation">:</span><span class="string">&quot;123&quot;</span><span class="punctuation">,</span> <span class="attr">&quot;2&quot;</span><span class="punctuation">:</span><span class="string">&quot;234&quot;</span><span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MrTang</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex;</span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; ids;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Person&gt; students;</span><br><span class="line">    <span class="keyword">public</span> Home home;</span><br><span class="line">    <span class="keyword">public</span> Person son;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Person</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Home</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> address;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> street;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">配置Json文档时的注意事项</font></strong></p>
<ul>
<li>1.如果数据表示对象那么最外层有大括号</li>
<li>2.一定是键值对形式</li>
<li>3.键一定是字符串格式</li>
<li>4.键值对用逗号分开</li>
<li>5.数组用[]包裹</li>
<li>6.对象用{}包裹</li>
</ul>
<p><strong><font size="4">总结</font></strong></p>
<ul>
<li>1.创建Json文件 ——右键创建文档改后缀</li>
<li>2.注释 —— &#x2F;&#x2F;和&#x2F;**&#x2F;</li>
<li>3.语法规则 —— 对象用大括号，数组用中括号，键值对用冒号，数组分割用逗号</li>
</ul>
<h3 id="练习题-4"><a href="#练习题-4" class="headerlink" title="练习题"></a>练习题</h3><p><strong><font size="4">1.请用Json语法描述一个玩家对象类</font></strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;L&quot;</span><span class="punctuation">,</span>                                         <span class="comment">// 名字字段，存储角色的名称</span></span><br><span class="line">    <span class="attr">&quot;atk&quot;</span><span class="punctuation">:</span> <span class="number">10</span><span class="punctuation">,</span>                                                 <span class="comment">// 攻击力字段，存储角色的攻击力值</span></span><br><span class="line">    <span class="attr">&quot;def&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span>                                                  <span class="comment">// 防御力字段，存储角色的防御力值</span></span><br><span class="line">    <span class="attr">&quot;moveSpeed&quot;</span><span class="punctuation">:</span> <span class="number">1.4</span><span class="punctuation">,</span>                                          <span class="comment">// 移动速度字段，存储角色的移动速度值</span></span><br><span class="line">    <span class="attr">&quot;roundSpeed&quot;</span><span class="punctuation">:</span> <span class="number">1.4</span><span class="punctuation">,</span>                                         <span class="comment">// 旋转速度字段，存储角色的旋转速度值</span></span><br><span class="line">    <span class="attr">&quot;weapon&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>                                                <span class="comment">// 武器字段，存储角色的武器信息</span></span><br><span class="line">        <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span>                                               <span class="comment">// 武器ID字段，存储武器的唯一标识符</span></span><br><span class="line">        <span class="attr">&quot;num&quot;</span><span class="punctuation">:</span> <span class="number">1</span>                                               <span class="comment">// 武器数量字段，存储角色拥有该武器的数量</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span>                                                          <span class="comment">// 如果没有武器，则直接值为null</span></span><br><span class="line">    <span class="attr">&quot;listInt&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span> <span class="number">2</span><span class="punctuation">,</span> <span class="number">3</span><span class="punctuation">,</span> <span class="number">4</span><span class="punctuation">,</span> <span class="number">5</span><span class="punctuation">]</span><span class="punctuation">,</span>                                <span class="comment">// 整型列表字段，存储整型数值的列表</span></span><br><span class="line">    <span class="attr">&quot;itemList&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span>                                              <span class="comment">// 物品列表字段，存储物品信息的列表</span></span><br><span class="line">        <span class="punctuation">&#123;</span>                                                      <span class="comment">// 物品信息对象</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span>                                           <span class="comment">// 物品ID字段，存储物品的唯一标识符</span></span><br><span class="line">            <span class="attr">&quot;num&quot;</span><span class="punctuation">:</span> <span class="number">10</span>                                          <span class="comment">// 物品数量字段，存储角色拥有该物品的数量</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;num&quot;</span><span class="punctuation">:</span> <span class="number">99</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">4</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;num&quot;</span><span class="punctuation">:</span> <span class="number">55</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;itemDic&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>                                               <span class="comment">// 物品字典字段，存储物品信息的字典</span></span><br><span class="line">        <span class="attr">&quot;2&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>                                                 <span class="comment">// 字典键为字符串型的物品ID</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span>                                           <span class="comment">// 物品ID字段，存储物品的唯一标识符</span></span><br><span class="line">            <span class="attr">&quot;num&quot;</span><span class="punctuation">:</span> <span class="number">1</span>                                           <span class="comment">// 物品数量字段，存储角色拥有该物品的数量</span></span><br><span class="line">        <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;3&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">3</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;num&quot;</span><span class="punctuation">:</span> <span class="number">10</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;itemDic2&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>                                              <span class="comment">// 物品字典字段2，存储物品信息的字典</span></span><br><span class="line">        <span class="attr">&quot;2&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span>                                                 <span class="comment">// 字典键为字符串型的物品ID</span></span><br><span class="line">            <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span>                                           <span class="comment">// 物品ID字段，存储物品的唯一标识符</span></span><br><span class="line">            <span class="attr">&quot;num&quot;</span><span class="punctuation">:</span> <span class="number">1</span>                                           <span class="comment">// 物品数量字段，存储角色拥有该物品的数量</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;privateI&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span>                                             <span class="comment">// 私有整数字段，存储私有整数值</span></span><br><span class="line">    <span class="attr">&quot;protectedI&quot;</span><span class="punctuation">:</span> <span class="number">99</span>                                           <span class="comment">// 受保护整数字段，存储受保护整数值</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<h2 id="Excel转Json"><a href="#Excel转Json" class="headerlink" title="Excel转Json"></a>Excel转Json</h2><p><code>Json文件格式-Excel转Json</code></p>
<p><strong><font size="4">Excel中配置数据</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/Json_Excel%E8%A1%A8%E6%A0%BC.png" class="" title="Json_Excel表格"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>


<p><strong><font size="4">Excel数据转Json数据</font></strong></p>
<ul>
<li>1.在百度或者Google搜索Excel转Json</li>
<li>2.选择在线转换的网站，比如：<a target="_blank" rel="noopener" href="https://www.bejson.com/json/col2json/">https://www.bejson.com/json/col2json/</a></li>
<li>3.进行转换</li>
<li>4.保存Json格式的数据</li>
</ul>
<p><strong><font size="3">转换数据如下：</font></strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">[</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;speed&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/T1&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">15</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;speed&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/T2&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">15</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span><span class="attr">&quot;speed&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/T3&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">15</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;speed&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/T4&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;hp&quot;</span><span class="punctuation">:</span><span class="number">6</span><span class="punctuation">,</span><span class="attr">&quot;speed&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;volume&quot;</span><span class="punctuation">:</span><span class="number">7</span><span class="punctuation">,</span><span class="attr">&quot;resName&quot;</span><span class="punctuation">:</span><span class="string">&quot;Airplane/T5&quot;</span><span class="punctuation">,</span><span class="attr">&quot;scale&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>以后会用脚本或者编辑器工具，就不用每次都去网页上转换了</p>
</blockquote>
<p><strong><font size="4">总结</font></strong></p>
<ul>
<li>1.在Excel表中配置游戏数据——更方便策划人员配置</li>
<li>2.将Excel表中配置的数据转为Json配置——方便将数据读取到内存中</li>
</ul>
<h3 id="练习题-5"><a href="#练习题-5" class="headerlink" title="练习题"></a>练习题</h3><p><strong><font size="4">将下面的数据转换在Excel表中配置，转换为Json数据，存储到一个Json文件中</font></strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UYF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">FireData</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fireInfoList</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">FireInfo</span> <span class="attr">id</span>=<span class="string">&quot;1&quot;</span> <span class="attr">type</span>=<span class="string">&quot;1&quot;</span> <span class="attr">num</span>=<span class="string">&quot;5&quot;</span> <span class="attr">cd</span>=<span class="string">&quot;0.8&quot;</span> <span class="attr">ids</span>=<span class="string">&quot;1,10&quot;</span> <span class="attr">delay</span>=<span class="string">&quot;8&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">FireInfo</span> <span class="attr">id</span>=<span class="string">&quot;2&quot;</span> <span class="attr">type</span>=<span class="string">&quot;2&quot;</span> <span class="attr">num</span>=<span class="string">&quot;5&quot;</span> <span class="attr">cd</span>=<span class="string">&quot;0&quot;</span> <span class="attr">ids</span>=<span class="string">&quot;11,20&quot;</span> <span class="attr">delay</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">FireInfo</span> <span class="attr">id</span>=<span class="string">&quot;3&quot;</span> <span class="attr">type</span>=<span class="string">&quot;2&quot;</span> <span class="attr">num</span>=<span class="string">&quot;8&quot;</span> <span class="attr">cd</span>=<span class="string">&quot;0.5&quot;</span> <span class="attr">ids</span>=<span class="string">&quot;1,20&quot;</span> <span class="attr">delay</span>=<span class="string">&quot;5&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">FireInfo</span> <span class="attr">id</span>=<span class="string">&quot;4&quot;</span> <span class="attr">type</span>=<span class="string">&quot;1&quot;</span> <span class="attr">num</span>=<span class="string">&quot;10&quot;</span> <span class="attr">cd</span>=<span class="string">&quot;0.5&quot;</span> <span class="attr">ids</span>=<span class="string">&quot;5,15&quot;</span> <span class="attr">delay</span>=<span class="string">&quot;10&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">fireInfoList</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Firedata</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">编写excel，复制到网页转换，转换工具转换的结果可能会出现问题，要注意检查</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/Json_Excel%E8%BD%ACJson%E7%BB%83%E4%B9%A0-1.png" class="" title="Json_数据转为Excel"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<p><strong><font size="3">Excel数据复制到记事本</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/Json_Excel%E8%BD%ACJson%E7%BB%83%E4%B9%A0-2.png" class="" title="Json_Excel数据复制到记事本"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<p><strong><font size="3">Excel数据复制到转换网站</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/Json_Excel%E8%BD%ACJson%E7%BB%83%E4%B9%A0-3.png" class="" title="Json_Excel数据复制到转换网站"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<p><strong><font size="3">转换数据如下：</font></strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;num&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;cd&quot;</span><span class="punctuation">:</span><span class="number">0.8</span><span class="punctuation">,</span><span class="attr">&quot;ids&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;delay&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span><span class="attr">&quot;num&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="attr">&quot;cd&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;ids&quot;</span><span class="punctuation">:</span><span class="number">11</span><span class="punctuation">,</span><span class="number">20</span><span class="punctuation">,</span><span class="attr">&quot;delay&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span><span class="attr">&quot;num&quot;</span><span class="punctuation">:</span><span class="number">8</span><span class="punctuation">,</span><span class="attr">&quot;cd&quot;</span><span class="punctuation">:</span><span class="number">0.5</span><span class="punctuation">,</span><span class="attr">&quot;ids&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="number">20</span><span class="punctuation">,</span><span class="attr">&quot;delay&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">&#123;</span><span class="attr">&quot;id&quot;</span><span class="punctuation">:</span><span class="number">4</span><span class="punctuation">,</span><span class="attr">&quot;type&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;num&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">,</span><span class="attr">&quot;cd&quot;</span><span class="punctuation">:</span><span class="number">0.5</span><span class="punctuation">,</span><span class="attr">&quot;ids&quot;</span><span class="punctuation">:</span><span class="number">5</span><span class="punctuation">,</span><span class="number">15</span><span class="punctuation">,</span><span class="attr">&quot;delay&quot;</span><span class="punctuation">:</span><span class="number">10</span><span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="JsonUtility"><a href="#JsonUtility" class="headerlink" title="JsonUtility"></a>JsonUtility</h2><p><code>CSharp操作Json-JsonUtility</code></p>
<p><strong><font size="4">JsonUtlity是什么</font></strong><br>JsonUtlity 是Unity自带的用于解析Json的公共类。</p>
<p>JsonUtlity可以:</p>
<ul>
<li>将内存中对象序列化为Json格式的字符串。</li>
<li>将Json字符串反序列化为类对象。</li>
</ul>
<p><strong><font size="4">在文件中存读字符串</font></strong></p>
<p><strong><font size="3">File.WriteAllText方法</font></strong></p>
<ul>
<li>存储字符串到指定路径文件中</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//File类中的WriteAllText方法 存储字符串到指定路径文件中</span></span><br><span class="line"><span class="comment">//第一个参数 填写的是 存储的路径</span></span><br><span class="line"><span class="comment">//第二个参数 填写的是 存储的字符串内容</span></span><br><span class="line"><span class="comment">//注意：第一个参数 必须是存在的文件路径 如果没有对应文件夹 会报错</span></span><br><span class="line">File.WriteAllText(Application.persistentDataPath + <span class="string">&quot;/Test.json&quot;</span>, <span class="string">&quot;存储的json文件&quot;</span>);</span><br><span class="line">print(Application.persistentDataPath);<span class="comment">//C:/Users/78529/AppData/LocalLow/DefaultCompany/Json_Teach</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong><font size="3">File.ReadAllText方法 </font></strong></p>
<ul>
<li>在指定路径文件中读取字符串</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//File类中的ReadAllText方法 在指定路径文件中读取字符串</span></span><br><span class="line"><span class="built_in">string</span> str = File.ReadAllText(Application.persistentDataPath + <span class="string">&quot;/Test.json&quot;</span>);</span><br><span class="line">print(str);<span class="comment">//存储的json文件</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong><font size="4">使用JsonUtlity进行序列化</font></strong></p>
<ul>
<li>序列化：把内存中的数据存储到硬盘上。为此，需要准备一个类和对象实例。</li>
</ul>
<p><strong><font size="3">准备一个类和对象实例</font></strong></p>
<ul>
<li>测试类</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">[<span class="meta">System.Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Student</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student</span>(<span class="params"><span class="built_in">int</span> age, <span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MrTao</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> testF;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">double</span> testD;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>[] ids;</span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; ids2;</span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; dic;</span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; dic2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Student s1;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Student&gt; s2s;</span><br><span class="line"></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> privateI = <span class="number">1</span>;</span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">int</span> protectedI = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>实例</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">MrTao t = <span class="keyword">new</span> MrTao();</span><br><span class="line">t.name = <span class="string">&quot;L&quot;</span>;</span><br><span class="line">t.age = <span class="number">18</span>;</span><br><span class="line">t.sex = <span class="literal">false</span>;</span><br><span class="line">t.testF = <span class="number">1.4f</span>;</span><br><span class="line">t.testD = <span class="number">1.4</span>;</span><br><span class="line"></span><br><span class="line">t.ids = <span class="keyword">new</span> <span class="built_in">int</span>[] &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span> &#125;;</span><br><span class="line">t.ids2 = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;() &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line">t.dic = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt;() &#123; &#123; <span class="number">1</span>, <span class="string">&quot;123&quot;</span> &#125;, &#123; <span class="number">2</span>, <span class="string">&quot;234&quot;</span> &#125; &#125;;</span><br><span class="line">t.dic2 = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;() &#123; &#123; <span class="string">&quot;1&quot;</span>, <span class="string">&quot;123&quot;</span> &#125;, &#123; <span class="string">&quot;2&quot;</span>, <span class="string">&quot;234&quot;</span> &#125; &#125;;</span><br><span class="line"></span><br><span class="line">t.s1 = <span class="literal">null</span>;<span class="comment">//new Student(1, &quot;小红&quot;);</span></span><br><span class="line">t.s2s = <span class="keyword">new</span> List&lt;Student&gt;() &#123; <span class="keyword">new</span> Student(<span class="number">2</span>, <span class="string">&quot;小明&quot;</span>), <span class="keyword">new</span> Student(<span class="number">3</span>, <span class="string">&quot;小强&quot;</span>) &#125;;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">JsonUtility.ToJson方法</font></strong></p>
<ul>
<li>序列化对象</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//JsonUtility类中的ToJson方法 序列化对象</span></span><br><span class="line"><span class="comment">//Jsonutility提供了线程的方法 可以把类对象 序列化为 json字符串</span></span><br><span class="line"><span class="comment">//生成对象的公共字段的 JSON 表示形式。</span></span><br><span class="line"><span class="comment">//JsonUtility.ToJson(对象)</span></span><br><span class="line"><span class="built_in">string</span> jsonStr = JsonUtility.ToJson(t);</span><br><span class="line">File.WriteAllText(Application.persistentDataPath + <span class="string">&quot;/MrTao.json&quot;</span>, jsonStr);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">JsonUtlity序列化时注意事项</font></strong></p>
<ul>
<li>float序列化时看起来会有一些误差。</li>
<li>自定义类需要加上序列化特性[System.Serializable]。</li>
<li>想要序列化私有变量，需要加上特性[SerializeField]。</li>
<li>JsonUtility不支持字典。</li>
<li>JsonUtlity存储null对象不会是null，而是默认值的数据。</li>
</ul>
<p><strong><font size="3">查看序列化后的json文件</font></strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;L&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span><span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span><span class="attr">&quot;testF&quot;</span><span class="punctuation">:</span><span class="number">1.399999976158142</span><span class="punctuation">,</span><span class="attr">&quot;testD&quot;</span><span class="punctuation">:</span><span class="number">1.4</span><span class="punctuation">,</span><span class="attr">&quot;ids&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;ids2&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;s1&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">0</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;s2s&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;小明&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;小强&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;privateI&quot;</span><span class="punctuation">:</span><span class="number">1</span><span class="punctuation">,</span><span class="attr">&quot;protectedI&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">使用JsonUtlity进行反序列化</font></strong></p>
<ul>
<li>反序列化：把硬盘上的数据读取到内存中。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//读取文件中的 Json字符串</span></span><br><span class="line">jsonStr = File.ReadAllText(Application.persistentDataPath + <span class="string">&quot;/MrTao.json&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">JsonUtility.FromJson方法 反序列化对象</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//JsonUtility类中的FromJson方法 反序列化对象</span></span><br><span class="line"><span class="comment">//通过 JSON 表示形式创建对象。</span></span><br><span class="line"><span class="comment">//JsonUtility.FromJson(字符串)</span></span><br><span class="line"><span class="comment">//使用Json字符串内容 转换成类对象</span></span><br><span class="line">MrTao t2 = JsonUtility.FromJson(jsonStr, <span class="keyword">typeof</span>(MrTao)) <span class="keyword">as</span> MrTao;</span><br><span class="line">MrTao t3 = JsonUtility.FromJson&lt;MrTao&gt;(jsonStr);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">JsonUtlity反序列化时注意事项</font></strong></p>
<ul>
<li>如果Json中数据少了，读取到内存中类对象中时不会报错。</li>
</ul>
<p><strong><font size="3">JsonUtility注意事项</font></strong></p>
<ul>
<li>JsonUtlity无法直接读取数据集合，比如直接读取List或数组会报错。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[<span class="meta">System.Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RoleInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> hp;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> speed;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> volume;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> resName;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> scale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//JsonUtlity无法直接读取数据集合 比如直接读取List或数组 会报错</span></span><br><span class="line">    <span class="built_in">string</span> jsonStr1 = File.ReadAllText(Application.streamingAssetsPath + <span class="string">&quot;/RoleInfo.json&quot;</span>);</span><br><span class="line">    print(jsonStr1);</span><br><span class="line">    <span class="comment">//List&lt;RoleInfo&gt; roleInfoList = JsonUtility.FromJson&lt;List&lt;RoleInfo&gt;&gt;(jsonStr1);//报错</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>用对象包裹一层List同时修改json文件也用对象包裹List就不会报错。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RoleData</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;RoleInfo&gt; list;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">string</span> jsonStr2 = File.ReadAllText(Application.streamingAssetsPath + <span class="string">&quot;/RoleInfo2.json&quot;</span>);</span><br><span class="line">    print(jsonStr2);</span><br><span class="line">    RoleData data = JsonUtility.FromJson&lt;RoleData&gt;(jsonStr2);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>文本编码格式需要是UTF-8，否则无法加载。如果修改了文件格式不是UTF-8，会报错。</p>
</blockquote>
<p><strong><font size="4">总结</font></strong></p>
<ul>
<li>必备知识点——File存读字符串的方法ReadAllText和WriteAllText。</li>
<li>JsonUtlity提供的序列化反序列化方法ToJson和FromJson。</li>
<li>自定义类需要加上序列化特性[System.Serializable]。</li>
<li>私有保护成员需要加上[SerializeField]。</li>
<li>JsonUtlity不支持字典。</li>
<li>JsonUtlity不能直接将数据反序列化为数据集合。</li>
<li>Json文档编码格式必须是UTF-8。</li>
</ul>
<h3 id="练习题-6"><a href="#练习题-6" class="headerlink" title="练习题"></a>练习题</h3><p><strong><font size="4">1.有一个玩家数据类,为该类写一个方法结合JsonUtility知识点,完成对象的序列化和反序列化</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/Json_%E7%BB%83%E4%B9%A0%E9%A2%98%E6%95%B0%E6%8D%AE%E7%B1%BB.png" class="" title="Json_练习题数据类"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<p><strong><font size="3">声明物品类和玩家信息类，注意自定义类和私有字段要添加特性</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 物品类</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">[<span class="meta">System.Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Item</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> id;       <span class="comment">// 物品ID</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> num;      <span class="comment">// 物品数量</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Item</span>(<span class="params"><span class="built_in">int</span> id, <span class="built_in">int</span> num</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 玩家信息类</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInfo</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;                      <span class="comment">// 玩家姓名</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> atk;                          <span class="comment">// 玩家攻击力</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> def;                          <span class="comment">// 玩家防御力</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> moveSpeed;                  <span class="comment">// 玩家移动速度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">double</span> roundSpeed;                <span class="comment">// 玩家旋转速度</span></span><br><span class="line">    <span class="keyword">public</span> Item weapon;                      <span class="comment">// 玩家武器信息</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; listInt;                <span class="comment">// 整型列表</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Item&gt; itemList;              <span class="comment">// 物品列表</span></span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">int</span>, Item&gt; itemDic;    <span class="comment">// 物品字典，以物品ID作为键</span></span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">string</span>, Item&gt; itemDic2;<span class="comment">// 物品字典，以字符串型的物品ID作为键</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> privateI = <span class="number">1</span>;                <span class="comment">// 私有整数字段</span></span><br><span class="line">    [<span class="meta">SerializeField</span>]</span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">int</span> protectedI = <span class="number">2</span>;            <span class="comment">// 受保护整数字段</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">创建一个玩家对象并设置其属性</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建一个玩家对象并设置其属性</span></span><br><span class="line">    PlayerInfo player = <span class="keyword">new</span> PlayerInfo();</span><br><span class="line">    player.name = <span class="string">&quot;L&quot;</span>;</span><br><span class="line">    player.atk = <span class="number">11</span>;</span><br><span class="line">    player.def = <span class="number">5</span>;</span><br><span class="line">    player.moveSpeed = <span class="number">20.5f</span>;</span><br><span class="line">    player.roundSpeed = <span class="number">21.4f</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个武器对象并将其赋值给玩家的武器属性</span></span><br><span class="line">    player.weapon = <span class="keyword">new</span> Item(<span class="number">1</span>, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个整型列表并将其赋值给玩家的整型列表属性</span></span><br><span class="line">    player.listInt = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;() &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个物品列表并将其赋值给玩家的物品列表属性</span></span><br><span class="line">    player.itemList = <span class="keyword">new</span> List&lt;Item&gt;() &#123; <span class="keyword">new</span> Item(<span class="number">1</span>, <span class="number">99</span>), <span class="keyword">new</span> Item(<span class="number">2</span>, <span class="number">44</span>) &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个物品字典并将其赋值给玩家的物品字典属性（以物品ID作为键）</span></span><br><span class="line">    player.itemDic = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">int</span>, Item&gt;() &#123; &#123; <span class="number">1</span>, <span class="keyword">new</span> Item(<span class="number">1</span>, <span class="number">12</span>) &#125;, &#123; <span class="number">2</span>, <span class="keyword">new</span> Item(<span class="number">2</span>, <span class="number">22</span>) &#125; &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个物品字典并将其赋值给玩家的物品字典属性（以字符串型的物品ID作为键）</span></span><br><span class="line">    player.itemDic2 = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, Item&gt;() &#123; &#123; <span class="string">&quot;1&quot;</span>, <span class="keyword">new</span> Item(<span class="number">1</span>, <span class="number">12</span>) &#125;, &#123; <span class="string">&quot;2&quot;</span>, <span class="keyword">new</span> Item(<span class="number">2</span>, <span class="number">22</span>) &#125; &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">创建序列化对象并保存为JSON文件的方法并调用</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 将玩家对象保存为JSON文件</span></span><br><span class="line">    SaveData(player, <span class="string">&quot;PlayerInfo&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 序列化对象并保存为JSON文件</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;player&quot;&gt;</span>要序列化的玩家对象<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;path&quot;&gt;</span>保存的文件路径<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SaveData</span>(<span class="params">PlayerInfo player, <span class="built_in">string</span> path</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 将玩家对象序列化为JSON字符串</span></span><br><span class="line">    <span class="built_in">string</span> jsonStr = JsonUtility.ToJson(player);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印持久化数据的路径</span></span><br><span class="line">    print(Application.persistentDataPath);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将JSON字符串写入指定路径的文件中</span></span><br><span class="line">    File.WriteAllText(Application.persistentDataPath + <span class="string">&quot;/&quot;</span> + path + <span class="string">&quot;.json&quot;</span>, jsonStr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">创建加载JSON文件并反序列化为玩家对象的方法并调用</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 加载JSON文件并将其反序列化为玩家对象</span></span><br><span class="line">    PlayerInfo player2 = LoadData(<span class="string">&quot;PlayerInfo&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 加载JSON文件并反序列化为玩家对象</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;path&quot;&gt;</span>要加载的文件路径<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>反序列化后的玩家对象<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PlayerInfo <span class="title">LoadData</span>(<span class="params"><span class="built_in">string</span> path</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 读取JSON文件内容</span></span><br><span class="line">    <span class="built_in">string</span> jsonStr = File.ReadAllText(Application.persistentDataPath + <span class="string">&quot;/&quot;</span> + path + <span class="string">&quot;.json&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将JSON字符串反序列化为玩家对象</span></span><br><span class="line">    <span class="keyword">return</span> JsonUtility.FromJson&lt;PlayerInfo&gt;(jsonStr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>






<h2 id="LitJson"><a href="#LitJson" class="headerlink" title="LitJson"></a>LitJson</h2><p><code>CSharp操作Json-LitJson</code></p>
<p><strong><font size="4">LitJson是什么？</font></strong></p>
<ul>
<li>LitJson 是一个第三方库，用于处理Json的序列化和反序列化。</li>
<li>它是C#编写的，体积小、速度快、易于使用。</li>
<li>可以很容易地嵌入到我们的代码中，只需要将LitJson代码拷贝到工程中即可。</li>
</ul>
<p><strong><font size="4">获取LitJson</font></strong></p>
<p><strong><font size="4">使用LitJson进行序列化</font></strong></p>
<p><strong><font size="3">准备一个类和对象实例</font></strong></p>
<ul>
<li>测试类</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Student2</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student2</span>()</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Student2</span>(<span class="params"><span class="built_in">int</span> age, <span class="built_in">string</span> name</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.age = age;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">MrTao2</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> testF;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">double</span> testD;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>[] ids;</span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; ids2;</span><br><span class="line">    <span class="comment">//public Dictionary&lt;int, string&gt; dic;</span></span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt; dic2;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Student2 s1;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Student2&gt; s2s;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="built_in">int</span> privateI = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="built_in">int</span> protectedI = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>实例</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    MrTao2 t = <span class="keyword">new</span> MrTao2();</span><br><span class="line">    t.name = <span class="string">&quot;L&quot;</span>;</span><br><span class="line">    t.age = <span class="number">18</span>;</span><br><span class="line">    t.sex = <span class="literal">true</span>;</span><br><span class="line">    t.testF = <span class="number">1.4f</span>;</span><br><span class="line">    t.testD = <span class="number">1.4</span>;</span><br><span class="line"></span><br><span class="line">    t.ids = <span class="keyword">new</span> <span class="built_in">int</span>[] &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span> &#125;;</span><br><span class="line">    t.ids2 = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;() &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span> &#125;;</span><br><span class="line">    <span class="comment">//t.dic = new Dictionary&lt;int, string&gt;() &#123; &#123; 1, &quot;123&quot; &#125;, &#123; 2, &quot;234&quot; &#125; &#125;;</span></span><br><span class="line">    t.dic2 = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">string</span>&gt;() &#123; &#123; <span class="string">&quot;1&quot;</span>, <span class="string">&quot;123&quot;</span> &#125;, &#123; <span class="string">&quot;2&quot;</span>, <span class="string">&quot;234&quot;</span> &#125; &#125;;</span><br><span class="line"></span><br><span class="line">    t.s1 = <span class="literal">null</span>;<span class="comment">//new Student(1, &quot;小红&quot;);</span></span><br><span class="line">    t.s2s = <span class="keyword">new</span> List&lt;Student2&gt;() &#123; <span class="keyword">new</span> Student2(<span class="number">2</span>, <span class="string">&quot;小明&quot;</span>), <span class="keyword">new</span> Student2(<span class="number">3</span>, <span class="string">&quot;小强&quot;</span>) &#125;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">JsonMapper.ToJson方法 序列化对象</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//JsonMapper类中的ToJson方法 序列化对象</span></span><br><span class="line"><span class="comment">//JsonMapper.ToJson(对象)</span></span><br><span class="line"><span class="built_in">string</span> jsonStr = JsonMapper.ToJson(t);</span><br><span class="line">print(Application.persistentDataPath);</span><br><span class="line">File.WriteAllText(Application.persistentDataPath + <span class="string">&quot;/MrTao2.json&quot;</span>, jsonStr);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">LitJson序列化时注意事项</font></strong></p>
<ul>
<li>相对JsonUtlity不需要加特性。</li>
<li>不能序列化私有变量。</li>
<li>支持字典类型，字典的键 建议都是字符串，因为Json的特点 Json中的键会加上双引号。</li>
<li>需要引用LitJson命名空间。</li>
<li>LitJson可以准确的保存null类型。</li>
</ul>
<p><strong><font size="3">查看序列化后的json文件</font></strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;\u97EC\u8001\u72EE&quot;</span><span class="punctuation">,</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">18</span><span class="punctuation">,</span><span class="attr">&quot;sex&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">true</span></span><span class="punctuation">,</span><span class="attr">&quot;testF&quot;</span><span class="punctuation">:</span><span class="number">1.4</span><span class="punctuation">,</span><span class="attr">&quot;testD&quot;</span><span class="punctuation">:</span><span class="number">1.4</span><span class="punctuation">,</span><span class="attr">&quot;ids&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">4</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;ids2&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span><span class="punctuation">,</span><span class="attr">&quot;dic2&quot;</span><span class="punctuation">:</span><span class="punctuation">&#123;</span><span class="attr">&quot;1&quot;</span><span class="punctuation">:</span><span class="string">&quot;123&quot;</span><span class="punctuation">,</span><span class="attr">&quot;2&quot;</span><span class="punctuation">:</span><span class="string">&quot;234&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="attr">&quot;s1&quot;</span><span class="punctuation">:</span><span class="literal"><span class="keyword">null</span></span><span class="punctuation">,</span><span class="attr">&quot;s2s&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">2</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;\u5C0F\u660E&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">,</span><span class="punctuation">&#123;</span><span class="attr">&quot;age&quot;</span><span class="punctuation">:</span><span class="number">3</span><span class="punctuation">,</span><span class="attr">&quot;name&quot;</span><span class="punctuation">:</span><span class="string">&quot;\u5C0F\u5F3A&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span><span class="punctuation">&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">使用LitJson反序列化</font></strong></p>
<ul>
<li>读取对应路径下文件中的Json字符串</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    jsonStr = File.ReadAllText(Application.persistentDataPath + <span class="string">&quot;/MrTao2.json&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong><font size="3">JsonMapper.ToObject方法 反序列化对象</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//JsonMapper类中的ToObject方法 反序列化对象</span></span><br><span class="line">    <span class="comment">//JsonMapper.ToObject(字符串)</span></span><br><span class="line">    <span class="comment">//JsonData是LitJson提供的类对象 </span></span><br><span class="line">    JsonData data = JsonMapper.ToObject(jsonStr);</span><br><span class="line">    <span class="comment">//可以用键值对的形式去访问其中的内容</span></span><br><span class="line">    print(data[<span class="string">&quot;name&quot;</span>]);</span><br><span class="line">    print(data[<span class="string">&quot;age&quot;</span>]);</span><br><span class="line">    <span class="comment">//通过泛型转换 更加的方便 建议使用这种方式</span></span><br><span class="line">    MrTao2 t2 = JsonMapper.ToObject&lt;MrTao2&gt;(jsonStr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">LitJson进行反序列化时注意事项</font></strong></p>
<ul>
<li>类结构需要无参构造函数，否则反序列化时报错。</li>
<li>字典虽然支持，但是键在使用为数值时会有问题，需要使用字符串类型。</li>
</ul>
<p><strong><font size="4">LitJson中的注意事项</font></strong></p>
<ul>
<li>LitJson可以直接读取数据集合</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">RoleInfo2</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> hp;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> speed;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> volume;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> resName;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> scale;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//读取数组或List</span></span><br><span class="line">    jsonStr = File.ReadAllText(Application.streamingAssetsPath + <span class="string">&quot;/RoleInfo.json&quot;</span>);</span><br><span class="line">    RoleInfo2[] arr = JsonMapper.ToObject&lt;RoleInfo2[]&gt;(jsonStr);</span><br><span class="line">    List&lt;RoleInfo2&gt; list = JsonMapper.ToObject&lt;List&lt;RoleInfo2&gt;&gt;(jsonStr);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//读取键为string类型的字典</span></span><br><span class="line">    jsonStr = File.ReadAllText(Application.streamingAssetsPath + <span class="string">&quot;/Dic.json&quot;</span>);</span><br><span class="line">    Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">int</span>&gt; dicTest = JsonMapper.ToObject&lt;Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">int</span>&gt;&gt;(jsonStr);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>注意检测json文件最后一行会不会多了一个逗号<br>文本编码格式需要是UTF-8，否则无法加载</p>
</blockquote>
<p><strong><font size="4">总结</font></strong></p>
<ul>
<li>LitJson提供的序列化反序列化方法 JsonMapper.ToJson和ToObject&lt;&gt;</li>
<li>LitJson无需加特性</li>
<li>LitJson不支持私有变量</li>
<li>LitJson支持字典序列化反序列化</li>
<li>LitJson可以直接将数据反序列化为数据集合</li>
<li>LitJson反序列化时 自定义类型需要无参构造</li>
<li>Json文档编码格式必须是UTF-8</li>
</ul>
<h3 id="练习题-7"><a href="#练习题-7" class="headerlink" title="练习题"></a>练习题</h3><p><strong><font size="4">1.有一个玩家数据类,请为该类写一个方法结合LitJson知识点,完成对象的序列化和反序列化</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/Json_%E7%BB%83%E4%B9%A0%E9%A2%98%E6%95%B0%E6%8D%AE%E7%B1%BB.png" class="" title="Json_练习题数据类"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<p><strong><font size="3">声明物品类和玩家信息类，可以不用添加特性，保证自定义类有无参构造函数</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 物品类</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Item2</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> id;   <span class="comment">// 物品ID</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> num;  <span class="comment">// 物品数量</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 无参构造方法</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Item2</span>()</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 带参构造方法</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;id&quot;&gt;</span>物品ID<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;num&quot;&gt;</span>物品数量<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Item2</span>(<span class="params"><span class="built_in">int</span> id, <span class="built_in">int</span> num</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.num = num;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 玩家信息类</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInfo2</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;                  <span class="comment">// 玩家姓名</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> atk;                      <span class="comment">// 攻击力</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> def;                      <span class="comment">// 防御力</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> moveSpeed;              <span class="comment">// 移动速度</span></span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">double</span> roundSpeed;            <span class="comment">// 回合速度</span></span><br><span class="line">    <span class="keyword">public</span> Item2 weapon;                 <span class="comment">// 武器</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; listInt;           <span class="comment">// 整型列表</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;Item2&gt; itemList;        <span class="comment">// 物品列表</span></span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">string</span>, Item2&gt; itemDic2;  <span class="comment">// 字典</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 无参构造方法</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PlayerInfo2</span>()</span> &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">创建一个玩家对象并设置其属性</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建玩家信息对象</span></span><br><span class="line">    PlayerInfo2 player = <span class="keyword">new</span> PlayerInfo2();</span><br><span class="line">    player.name = <span class="string">&quot;L&quot;</span>;</span><br><span class="line">    player.atk = <span class="number">11</span>;</span><br><span class="line">    player.def = <span class="number">5</span>;</span><br><span class="line">    player.moveSpeed = <span class="number">20.5f</span>;</span><br><span class="line">    player.roundSpeed = <span class="number">21.4</span>;</span><br><span class="line"></span><br><span class="line">    player.weapon = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">    player.listInt = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;() &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line">    player.itemList = <span class="keyword">new</span> List&lt;Item2&gt;() &#123; <span class="keyword">new</span> Item2(<span class="number">1</span>, <span class="number">99</span>), <span class="keyword">new</span> Item2(<span class="number">2</span>, <span class="number">44</span>) &#125;;</span><br><span class="line"></span><br><span class="line">    player.itemDic2 = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, Item2&gt;() &#123; &#123; <span class="string">&quot;1&quot;</span>, <span class="keyword">new</span> Item2(<span class="number">1</span>, <span class="number">12</span>) &#125;, &#123; <span class="string">&quot;2&quot;</span>, <span class="keyword">new</span> Item2(<span class="number">2</span>, <span class="number">22</span>) &#125; &#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">创建序列化对象并保存为JSON文件的方法并调用</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 序列化对象并保存为JSON文件</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;data&quot;&gt;</span>要序列化的对象<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;path&quot;&gt;</span>保存的文件路径<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SaveData</span>(<span class="params">PlayerInfo2 data, <span class="built_in">string</span> path</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 将对象序列化为JSON字符串</span></span><br><span class="line">    <span class="built_in">string</span> jsonStr = JsonMapper.ToJson(data);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 打印持久化数据的路径</span></span><br><span class="line">    print(Application.persistentDataPath);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将JSON字符串写入指定路径的文件中</span></span><br><span class="line">    File.WriteAllText(Application.persistentDataPath + <span class="string">&quot;/&quot;</span> + path + <span class="string">&quot;.json&quot;</span>, jsonStr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 调用SaveData方法，将玩家信息对象序列化为JSON字符串，并保存为JSON文件</span></span><br><span class="line">    SaveData(player, <span class="string">&quot;PlayerInfo2&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">创建加载JSON文件并反序列化为玩家对象的方法并调用</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 加载JSON文件并反序列化为对象</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;path&quot;&gt;</span>要加载的文件路径<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>反序列化后的对象<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PlayerInfo2 <span class="title">LoadData</span>(<span class="params"><span class="built_in">string</span> path</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 读取JSON文件内容</span></span><br><span class="line">    <span class="built_in">string</span> jsonStr = File.ReadAllText(Application.persistentDataPath + <span class="string">&quot;/&quot;</span> + path + <span class="string">&quot;.json&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将JSON字符串反序列化为对象</span></span><br><span class="line">    <span class="keyword">return</span> JsonMapper.ToObject&lt;PlayerInfo2&gt;(jsonStr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 调用LoadData方法，加载JSON文件，并将其反序列化为玩家信息对象</span></span><br><span class="line">    PlayerInfo2 p = LoadData(<span class="string">&quot;PlayerInfo2&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="JsonUtility和LitJson对比"><a href="#JsonUtility和LitJson对比" class="headerlink" title="JsonUtility和LitJson对比"></a>JsonUtility和LitJson对比</h2><p><code>CSharp操作Json-JsonUtility和LitJson对比</code></p>
<p><strong><font size="4">JsonUtlity和LitJson相同点</font></strong></p>
<ul>
<li>它们都是用于Json的序列化反序列化</li>
<li>Json文档编码格式必须是UTF-8</li>
<li>都是通过静态类进行方法调用</li>
</ul>
<p><strong><font size="4">JsonUtlity和LitJson不同点</font></strong></p>
<ul>
<li>JsonUtlity是Unity自带，LitJson是第三方需要引用命名空间</li>
<li>JsonUtlity使用时自定义类需要加特性，LitJson不需要</li>
<li>JsonUtlity支持私有变量(加特性)，LitJson不支持</li>
<li>JsonUtlity不支持字典，LitJson支持(但是键只能是字符串)</li>
<li>JsonUtlity不能直接将数据反序列化为数据集合(数组字典)，要包裹一层，LitJson可以</li>
<li>JsonUtlity对自定义类不要求有无参构造，LitJson需要</li>
<li>JsonUtlity存储空对象时会存储默认值而不是null，LitJson会存null</li>
</ul>
<p><strong><font size="4">如何选择两者</font></strong></p>
<ul>
<li>根据实际需求</li>
<li>建议使用LitJson</li>
<li>原因：LitJson不用加特性，支持字典，支持直接反序列化为数据集合，存储null更准确</li>
</ul>
<h2 id="Json实践项目"><a href="#Json实践项目" class="headerlink" title="Json实践项目"></a>Json实践项目</h2><p><strong><font size="4">需求分析和Json数据管理器</font></strong><br><code>需求分析和Json数据管理类创建</code></p>
<p><strong><font size="3">Json数据管理类需要有一键存储和读取对应对象的方法</font></strong></p>
<ul>
<li>创建Json数据管理类，实现单例</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> Json数据管理类 主要用于进行 Json的序列化存储到硬盘 和 反序列化从硬盘中读取到内存中</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">JsonDataMgr</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> JsonDataMgr instance = <span class="keyword">new</span> JsonDataMgr();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> JsonDataMgr Instance =&gt; instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">JsonDataMgr</span>()</span> &#123; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">存储和读取数据</font></strong><br><code>Json数据管理类存储和读取数据</code></p>
<p><strong><font size="3">创建Json类型方案枚举，可以让外部选择用哪个方案</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 序列化和反序列化Json时 使用的是哪种方案</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="built_in">enum</span> JsonType</span><br><span class="line">&#123;</span><br><span class="line">    JsonUtlity,</span><br><span class="line">    LitJson,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">创建存储Json数据方法。</font></strong></p>
<ul>
<li>外部传入对象和文件名，可以选择Json方案。</li>
<li>确定存储路径，判断Json类型方案选择不同的序列化方法得到对应Json字符串，写入文件到对应路径中</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//存储Json数据 序列化</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">SaveData</span>(<span class="params"><span class="built_in">object</span> data, <span class="built_in">string</span> fileName, JsonType type = JsonType.LitJson</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//确定存储路径</span></span><br><span class="line">    <span class="built_in">string</span> path = Application.persistentDataPath + <span class="string">&quot;/&quot;</span> + fileName + <span class="string">&quot;.json&quot;</span>;</span><br><span class="line">    <span class="comment">//序列化 得到Json字符串</span></span><br><span class="line">    <span class="built_in">string</span> jsonStr = <span class="string">&quot;&quot;</span>;</span><br><span class="line">    <span class="keyword">switch</span> (type)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> JsonType.JsonUtlity:</span><br><span class="line">            jsonStr = JsonUtility.ToJson(data);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> JsonType.LitJson:</span><br><span class="line">            jsonStr = JsonMapper.ToJson(data);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//把序列化的Json字符串 存储到指定路径的文件中</span></span><br><span class="line">    File.WriteAllText(path, jsonStr);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">创建读取Json数据的方法。</font></strong></p>
<ul>
<li>外部传入文件名，可以选择Json方案。</li>
<li>确定从哪个路径读取文件。</li>
<li>首先判断默认数据文件夹（Application.streamingAssetsPath）中是否有我们想要的文件，如果有就从中获取。如果没有，就判断读写文件夹（Application.persistentDataPath）中是否有，如果有就从中获取。如果都没有，就返回一个新创建的对象。</li>
<li>注意这个给这个方法添加泛型约束有默认无参构造函数。读取文件内容，把它存储在一个字符串变量jsonStr中。根据Json类型的参数，选择使用哪种库来把jsonStr转换成一个指定类型的对象data。返回data对象。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//读取指定文件中的 Json数据 反序列化</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">LoadData</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="built_in">string</span> fileName, JsonType type = JsonType.LitJson</span>) <span class="keyword">where</span> T : <span class="keyword">new</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//确定从哪个路径读取</span></span><br><span class="line">    <span class="comment">//首先先判断 默认数据文件夹中是否有我们想要的数据 如果有 就从中获取</span></span><br><span class="line">    <span class="built_in">string</span> path = Application.streamingAssetsPath + <span class="string">&quot;/&quot;</span> + fileName + <span class="string">&quot;.json&quot;</span>;</span><br><span class="line">    <span class="comment">//先判断 是否存在这个文件</span></span><br><span class="line">    <span class="comment">//如果不存在默认文件 就从 读写文件夹中去寻找</span></span><br><span class="line">    <span class="keyword">if</span>(!File.Exists(path))</span><br><span class="line">        path = Application.persistentDataPath + <span class="string">&quot;/&quot;</span> + fileName + <span class="string">&quot;.json&quot;</span>;</span><br><span class="line">    <span class="comment">//如果读写文件夹中都还没有 那就返回一个默认对象</span></span><br><span class="line">    <span class="keyword">if</span> (!File.Exists(path))</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> T();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//进行反序列化</span></span><br><span class="line">    <span class="built_in">string</span> jsonStr = File.ReadAllText(path);</span><br><span class="line">    <span class="comment">//数据对象</span></span><br><span class="line">    T data = <span class="literal">default</span>(T);</span><br><span class="line">    <span class="keyword">switch</span> (type)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">case</span> JsonType.JsonUtlity:</span><br><span class="line">            data = JsonUtility.FromJson&lt;T&gt;(jsonStr);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> JsonType.LitJson:</span><br><span class="line">            data = JsonMapper.ToObject&lt;T&gt;(jsonStr);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//把对象返回出去</span></span><br><span class="line">    <span class="keyword">return</span> data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>










<h1 id="Binary（二进制）"><a href="#Binary（二进制）" class="headerlink" title="Binary（二进制）"></a>Binary（二进制）</h1><h2 id="各数据类型转字节数据"><a href="#各数据类型转字节数据" class="headerlink" title="各数据类型转字节数据"></a>各数据类型转字节数据</h2><p><code>各数据类型转字节数据</code></p>
<p><strong><font size="4">回顾C#知识——不同变量类型</font></strong></p>
<p><strong><font size="3">有符号整数类型：</font></strong></p>
<ul>
<li>sbyte：有符号的8位整数，取值范围为-128到127。</li>
<li>int：有符号的32位整数，取值范围为-2,147,483,648到2,147,483,647。</li>
<li>short：有符号的16位整数，取值范围为-32,768到32,767。</li>
<li>long：有符号的64位整数，取值范围为-9,223,372,036,854,775,808到9,223,372,036,854,775,807。</li>
</ul>
<p><strong><font size="3">无符号整数类型：</font></strong></p>
<ul>
<li>byte：无符号的8位整数，取值范围为0到255。</li>
<li>uint：无符号的32位整数，取值范围为0到4,294,967,295。</li>
<li>ushort：无符号的16位整数，取值范围为0到65,535。</li>
<li>ulong：无符号的64位整数，取值范围为0到18,446,744,073,709,551,615。</li>
</ul>
<p><strong><font size="3">浮点数类型：</font></strong></p>
<ul>
<li>float：单精度浮点数，占用32位，用于表示小数，取值范围大约为±1.5 x 10^-45到±3.4 x 10^38。</li>
<li>double：双精度浮点数，占用64位，用于表示更大范围的小数，取值范围大约为±5.0 x 10^-324到±1.7 x 10^308。</li>
<li>decimal：高精度的小数，占用128位，适用于财务和货币计算，取值范围大约为±1.0 x 10^-28到±7.9 x 10^28。</li>
</ul>
<p><strong><font size="3">特殊类型：</font></strong></p>
<ul>
<li>bool：布尔值，表示真或假。</li>
<li>char：字符类型，表示单个Unicode字符。</li>
<li>string：字符串类型，表示一串Unicode字符组成的文本。</li>
</ul>
<p><strong><font size="4">回顾C#知识——变量的本质</font></strong></p>
<ul>
<li>变量的本质是2进制，在内存中都以字节的形式存储着。</li>
<li>1byte &#x3D; 8bit，1bit(位)不是0就是1。</li>
<li>通过sizeof方法可以看到常用变量类型占用的字节空间长度。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">print(<span class="string">&quot;有符号&quot;</span>); <span class="comment">// 打印 &quot;有符号&quot;</span></span><br><span class="line">print(<span class="string">&quot;sbyte&quot;</span> + <span class="keyword">sizeof</span>(<span class="built_in">sbyte</span>) + <span class="string">&quot;字节&quot;</span>); <span class="comment">// 打印 &quot;sbyte4字节&quot;</span></span><br><span class="line">print(<span class="string">&quot;int&quot;</span> + <span class="keyword">sizeof</span>(<span class="built_in">int</span>) + <span class="string">&quot;字节&quot;</span>); <span class="comment">// 打印 &quot;int4字节&quot;</span></span><br><span class="line">print(<span class="string">&quot;short&quot;</span> + <span class="keyword">sizeof</span>(<span class="built_in">short</span>) + <span class="string">&quot;字节&quot;</span>); <span class="comment">// 打印 &quot;short2字节&quot;</span></span><br><span class="line">print(<span class="string">&quot;long&quot;</span> + <span class="keyword">sizeof</span>(<span class="built_in">long</span>) + <span class="string">&quot;字节&quot;</span>); <span class="comment">// 打印 &quot;long8字节&quot;</span></span><br><span class="line">print(<span class="string">&quot;无符号&quot;</span>); <span class="comment">// 打印 &quot;无符号&quot;</span></span><br><span class="line">print(<span class="string">&quot;byte&quot;</span> + <span class="keyword">sizeof</span>(<span class="built_in">byte</span>) + <span class="string">&quot;字节&quot;</span>); <span class="comment">// 打印 &quot;byte1字节&quot;</span></span><br><span class="line">print(<span class="string">&quot;uint&quot;</span> + <span class="keyword">sizeof</span>(<span class="built_in">uint</span>) + <span class="string">&quot;字节&quot;</span>); <span class="comment">// 打印 &quot;uint4字节&quot;</span></span><br><span class="line">print(<span class="string">&quot;ushort&quot;</span> + <span class="keyword">sizeof</span>(<span class="built_in">ushort</span>) + <span class="string">&quot;字节&quot;</span>); <span class="comment">// 打印 &quot;ushort2字节&quot;</span></span><br><span class="line">print(<span class="string">&quot;ulong&quot;</span> + <span class="keyword">sizeof</span>(<span class="built_in">ulong</span>) + <span class="string">&quot;字节&quot;</span>); <span class="comment">// 打印 &quot;ulong8字节&quot;</span></span><br><span class="line">print(<span class="string">&quot;浮点&quot;</span>); <span class="comment">// 打印 &quot;浮点&quot;</span></span><br><span class="line">print(<span class="string">&quot;float&quot;</span> + <span class="keyword">sizeof</span>(<span class="built_in">float</span>) + <span class="string">&quot;字节&quot;</span>); <span class="comment">// 打印 &quot;float4字节&quot;</span></span><br><span class="line">print(<span class="string">&quot;double&quot;</span> + <span class="keyword">sizeof</span>(<span class="built_in">double</span>) + <span class="string">&quot;字节&quot;</span>); <span class="comment">// 打印 &quot;double8字节&quot;</span></span><br><span class="line">print(<span class="string">&quot;decimal&quot;</span> + <span class="keyword">sizeof</span>(<span class="built_in">decimal</span>) + <span class="string">&quot;字节&quot;</span>); <span class="comment">// 打印 &quot;decimal16字节&quot;</span></span><br><span class="line">print(<span class="string">&quot;特殊&quot;</span>); <span class="comment">// 打印 &quot;特殊&quot;</span></span><br><span class="line">print(<span class="string">&quot;bool&quot;</span> + <span class="keyword">sizeof</span>(<span class="built_in">bool</span>) + <span class="string">&quot;字节&quot;</span>); <span class="comment">// 打印 &quot;bool1字节&quot;</span></span><br><span class="line">print(<span class="string">&quot;char&quot;</span> + <span class="keyword">sizeof</span>(<span class="built_in">char</span>) + <span class="string">&quot;字节&quot;</span>); <span class="comment">// 打印 &quot;char2字节&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">2进制文件读写的本质</font></strong></p>
<ul>
<li>它就是通过将各类型变量转换为字节数组，将字节数组直接存储到文件中。</li>
<li>一般人是看不懂存储的数据的，不仅可以节约存储空间，提升效率，还可以提升安全性。</li>
<li>而且在网络通信中我们直接传输的数据也是字节数据（2进制数据）。</li>
</ul>
<p><strong><font size="4">各类型数据和字节数组相互转换</font></strong></p>
<ul>
<li>C#提供了一个公共类帮助我们进行转化，我们只需要记住API即可。</li>
<li>类名：BitConverter，命名空间：using System。</li>
</ul>
<p><strong><font size="3">BitConverter.GetBytes</font></strong> </p>
<ul>
<li>将各类型转字节，可以传入各个类型的变量作为参数。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//BitConverter.GetBytes方法 将各类型转字节 可以传入各个类型的变量作为参数</span></span><br><span class="line"><span class="built_in">byte</span>[] bytes = BitConverter.GetBytes(<span class="number">257</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">BitConverter.ToXX</font></strong> </p>
<ul>
<li>字节数组转各类型</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//BitConverter.ToXX方法 字节数组转各类型 第二个参数是从数组的第几个字节开始转换</span></span><br><span class="line"><span class="comment">//注意：这里需要确保数组长度至少为4，否则会抛出ArgumentOutOfRangeException异常</span></span><br><span class="line"><span class="built_in">int</span> i = BitConverter.ToInt32(bytes, <span class="number">0</span>); <span class="comment">//修改了起始索引为0，表示从最低有效字节开始转换 假如传入1 就只有3个字节给系统转换导致报错 </span></span><br><span class="line">print(i);<span class="comment">//257</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">标准编码格式</font></strong></p>
<ul>
<li>编码是一种将文字、数字或其它对象转换成二进制数据的方法，以便于计算机存储和处理。</li>
<li>不同的编码格式有不同的转换规则，因此需要统一和标准化，才能保证编码的正确性和互通性。</li>
<li>常见的编码格式有 ASCII、ANSI、GBK、GB2312、UTF-8、GB18030 和 UNICODE 等。</li>
</ul>
<p><strong><font size="3">说人话</font></strong></p>
<ul>
<li>计算机中数据的本质就是2进制数据。</li>
<li>编码格式就是用对应的2进制数表示不同的文字。</li>
<li>由于世界上有各种不同的语言，所以会有很多种不同的编码格式。</li>
<li>不同的编码格式对应的规则是不同的。</li>
<li>如果在读取字符时采用了不匹配的编码格式，可能会出现乱码。</li>
</ul>
<p><strong><font size="3">游戏开发中常用编码格式 UTF-8</font></strong></p>
<ul>
<li>中文相关编码格式 GBK</li>
<li>英文相关编码格式 ASCII</li>
</ul>
<p><strong><font size="3">在C#中有一个专门的Encoding类来帮助我们将字符串和字节数组进行转换</font></strong></p>
<ul>
<li>类名：Encoding</li>
<li>需要引用命名空间：using System.Text;</li>
</ul>
<p><strong><font size="3">Encoding.UTF8.GetBytes</font></strong> </p>
<ul>
<li>将字符串以指定编码格式转字节</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="built_in">byte</span>[] bytes2 = Encoding.UTF8.GetBytes(<span class="string">&quot;LLL&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">Encoding.UTF8.GetString </font></strong></p>
<ul>
<li>字节数组以指定编码格式转字符串</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">string</span> s1 = Encoding.UTF8.GetString(bytes2);</span><br><span class="line"><span class="built_in">string</span> s2 = Encoding.UTF8.GetString(bytes2, <span class="number">0</span>, bytes2.Length);<span class="comment">//这种重载可以指定从数组的哪个位置开始转换，以及转换多少个字节</span></span><br><span class="line">print(s1);<span class="comment">//LLL</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="4">总结</font></strong></p>
<ul>
<li>我们可以通过 BitConverter 和 Encoding 类将所有 C# 提供给我们的数据类型和字节数组之间进行相互转换了。</li>
<li>我们需要熟练掌握其中的 API。</li>
</ul>
<h2 id="File文件类"><a href="#File文件类" class="headerlink" title="File文件类"></a>File文件类</h2><p><code>文件操作相关-文件相关</code></p>
<p><strong><font size="4">代码中的文件操作是做什么</font></strong></p>
<ul>
<li>在电脑上我们可以在操作系统中创建删除修改文件</li>
<li>可以增删查改各种各样的文件类型</li>
<li>代码中的文件操作就是通过代码来做这些事情</li>
</ul>
<p><strong><font size="4">文件相关操作公共类</font></strong></p>
<ul>
<li>C#提供了一个名为File（文件）的公共类</li>
<li>让我们可以快捷的通过代码操作文件相关</li>
<li>类名：File</li>
<li>命名空间：System.IO</li>
</ul>
<p><strong><font size="4">文件操作File类的常用内容</font></strong></p>
<p><strong><font size="3">File.Exists </font></strong></p>
<ul>
<li>判断文件是否存在</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//Exists方法 判断文件是否存在</span></span><br><span class="line"><span class="keyword">if</span> (File.Exists(Application.dataPath + <span class="string">&quot;/UnityTeach.tao&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="string">&quot;UnityTeach.tao文件存在&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="string">&quot;UnityTeach.tao文件不存在&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">File.Create </font></strong></p>
<ul>
<li>创建文件</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//注意要传入的是路径</span></span><br><span class="line"><span class="comment">//要有/ 同时可能要手动在Inspector窗口右键刷新一次才能显示</span></span><br><span class="line"><span class="comment">//之后会使用创建文件方法的文件流返回值 进行写入</span></span><br><span class="line">FileStream fs = File.Create(Application.dataPath + <span class="string">&quot;/UnityTeach.tao&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">File.WriteAllXX </font></strong></p>
<ul>
<li>写入内容到文件中</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//WriteAll XX方法 写入文件</span></span><br><span class="line"><span class="comment">//将指定字节数组 写入到指定路径的文件中</span></span><br><span class="line"><span class="comment">//写入的是二进制数据</span></span><br><span class="line"><span class="built_in">byte</span>[] bytes = BitConverter.GetBytes(<span class="number">999</span>);</span><br><span class="line">File.WriteAllBytes(Application.dataPath + <span class="string">&quot;/UnityTeach.tao&quot;</span>, bytes);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//写入行信息 将指定的string数组内容 一行行写入到指定路径中</span></span><br><span class="line"><span class="comment">//写入的是字符串</span></span><br><span class="line"><span class="comment">//写入文件方法假如没有对应文件的话会在对应路径自动创建 可能要手动在Inspector窗口右键刷新一次才能显示</span></span><br><span class="line"><span class="built_in">string</span>[] strs = <span class="keyword">new</span> <span class="built_in">string</span>[] &#123; <span class="string">&quot;123&quot;</span>, <span class="string">&quot;L&quot;</span>, <span class="string">&quot;123123kdjfsalk&quot;</span>, <span class="string">&quot;123123123125243&quot;</span>&#125;;</span><br><span class="line">File.WriteAllLines(Application.dataPath + <span class="string">&quot;/UnityTeach2.tao&quot;</span>, strs);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//写入文本信息</span></span><br><span class="line"><span class="comment">//将指定字符串写入指定路径 支持转义字符</span></span><br><span class="line">File.WriteAllText(Application.dataPath + <span class="string">&quot;/UnityTeach3.tao&quot;</span>, <span class="string">&quot;L\n哈哈哈哈123123131231241234123&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">File.ReadAllXX </font></strong></p>
<ul>
<li>从文件读取内容</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//ReadAllXX方法 读取文件</span></span><br><span class="line"><span class="comment">//读取字节数据</span></span><br><span class="line">bytes = File.ReadAllBytes(Application.dataPath + <span class="string">&quot;/UnityTeach.tao&quot;</span>);</span><br><span class="line">print(BitConverter.ToInt32(bytes, <span class="number">0</span>));</span><br><span class="line"><span class="comment">//读取所有行信息</span></span><br><span class="line">strs = File.ReadAllLines(Application.dataPath + <span class="string">&quot;/UnityTeach2.tao&quot;</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; strs.Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">    print(strs[i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//读取所有文本信息</span></span><br><span class="line">print(File.ReadAllText(Application.dataPath + <span class="string">&quot;/UnityTeach3.tao&quot;</span>));</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">File.Delete</font></strong> </p>
<ul>
<li>删除文件</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//Delete方法 删除文件</span></span><br><span class="line"><span class="comment">//可能要手动在Inspector窗口右键刷新一次才能显示被删除</span></span><br><span class="line"><span class="comment">//注意 如果删除打开着的文件 会报错</span></span><br><span class="line">File.Delete(Application.dataPath + <span class="string">&quot;/UnityTeach.tao&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">File.Copy </font></strong></p>
<ul>
<li>复制文件</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Copy方法 复制文件</span></span><br><span class="line"><span class="comment">//可能要手动在Inspector窗口右键刷新一次才能显示复制出来的文件</span></span><br><span class="line"><span class="comment">//假如被拷贝的路径上已经有对应文件 会报错 要传入第三个参数为true进行覆盖才不会报错 </span></span><br><span class="line"><span class="comment">//参数一：现有文件 需要是流关闭状态</span></span><br><span class="line"><span class="comment">//参数二：目标文件</span></span><br><span class="line"><span class="comment">//参数三：是否覆盖写入</span></span><br><span class="line">File.Copy(Application.dataPath + <span class="string">&quot;/UnityTeach2.tao&quot;</span>, Application.dataPath + <span class="string">&quot;/L.taolaoshi&quot;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong><font size="3">File.Replace </font></strong></p>
<ul>
<li>文件替换</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Replace方法 文件替换</span></span><br><span class="line"><span class="comment">//参数一：用来替换的路径</span></span><br><span class="line"><span class="comment">//参数二：被替换的路径</span></span><br><span class="line"><span class="comment">//参数三：备份路径 避免被替换的文件丢失 可以在备份路径看被替换的文件</span></span><br><span class="line">File.Replace(Application.dataPath + <span class="string">&quot;/UnityTeach3.tao&quot;</span>, Application.dataPath + <span class="string">&quot;/L.taolaoshi&quot;</span>, Application.dataPath + <span class="string">&quot;/L备份.taolaoshi&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">File.Open </font></strong></p>
<ul>
<li>打开文件并写入或读取</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//Open方法 以流的形式 打开文件并写入或读取</span></span><br><span class="line"><span class="comment">//参数一：路径</span></span><br><span class="line"><span class="comment">//参数二：打开模式</span></span><br><span class="line"><span class="comment">//参数三：访问模式</span></span><br><span class="line">FileStream fs = File.Open(Application.dataPath + <span class="string">&quot;/UnityTeach2.tao&quot;</span>, FileMode.OpenOrCreate, FileAccess.ReadWrite);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="4">总结</font></strong></p>
<ul>
<li>File类提供了各种方法帮助我们进行文件的基础操作，需要记住这些关键API</li>
<li>一般情况下想要整体读写内容可以使用File提供的Write和Read相关功能</li>
</ul>
<h2 id="FileStrean文件流类"><a href="#FileStrean文件流类" class="headerlink" title="FileStrean文件流类"></a>FileStrean文件流类</h2><p><code>文件操作相关-文件流相关</code></p>
<p><strong><font size="4">什么是文件流</font></strong></p>
<ul>
<li>C#中，有一个叫做FileStream的类，它提供了对文件进行读写的详细控制。相比我们之前学过的File类只能对整个文件进行读写，FileStream可以以字节的形式处理文件。</li>
<li>说认话，文件中存储的数据就像是一个数据流（类似数组或列表），我们可以通过FileStream逐个部分地读取或写入这个数据流。</li>
<li>举个例子，我们可以先存储一个int（4个字节），再存储一个bool（1个字节），再存储一个string（n个字节）。利用FileStream，我们可以以流式的方式逐个读取或写入这些数据。</li>
</ul>
<p><strong><font size="4">FileStream文件流类</font></strong></p>
<ul>
<li>类名：FileStream</li>
<li>需要引用命名空间：System.IO</li>
</ul>
<p><strong><font size="4">FileStream文件流类常用方法</font></strong></p>
<p><strong><font size="3">实例化(new FileStream)</font></strong></p>
<ul>
<li>打开或创建指定文件</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//方法一：new FileStream</span></span><br><span class="line"><span class="comment">//参数一：路径</span></span><br><span class="line"><span class="comment">//参数二：打开模式</span></span><br><span class="line"><span class="comment">//  CreateNew:创建新文件 如果文件存在 则报错</span></span><br><span class="line"><span class="comment">//  Create:创建文件，如果文件存在 则覆盖</span></span><br><span class="line"><span class="comment">//  Open:打开文件，如果文件不存在 报错</span></span><br><span class="line"><span class="comment">//  OpenOrCreate:打开或者创建文件根据实际情况操作</span></span><br><span class="line"><span class="comment">//  Append:若存在文件，则打开并查找文件尾，或者创建一个新文件</span></span><br><span class="line"><span class="comment">//  Truncate:打开并清空文件内容</span></span><br><span class="line"><span class="comment">//参数三：访问读写模式</span></span><br><span class="line"><span class="comment">//参数四：共享权限</span></span><br><span class="line"><span class="comment">//  None 谢绝共享</span></span><br><span class="line"><span class="comment">//  Read 允许别的程序读取当前文件</span></span><br><span class="line"><span class="comment">//  Write 允许别的程序写入该文件</span></span><br><span class="line"><span class="comment">//  ReadWrite 允许别的程序读写该文件</span></span><br><span class="line">FileStream fileStream1 = <span class="keyword">new</span> FileStream(Application.dataPath + <span class="string">&quot;/Lesson04_文件操作相关_文件流相关.tao&quot;</span>, FileMode.Create, FileAccess.ReadWrite);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">File.Create</font></strong></p>
<ul>
<li>打开或创建指定文件</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//方法二：File.Create</span></span><br><span class="line"><span class="comment">//参数一：路径</span></span><br><span class="line"><span class="comment">//参数二：缓存大小</span></span><br><span class="line"><span class="comment">//参数三：描述如何创建或覆盖该文件（不常用）</span></span><br><span class="line"><span class="comment">//  Asynchronous 可用于异步读写</span></span><br><span class="line"><span class="comment">//  DeleteOnClose 不在使用时，自动删除</span></span><br><span class="line"><span class="comment">//  Encrypted 加密</span></span><br><span class="line"><span class="comment">//  None 不应用其它选项</span></span><br><span class="line"><span class="comment">//  RandomAccess 随机访问文件</span></span><br><span class="line"><span class="comment">//  SequentialScan 从头到尾顺序访问文件</span></span><br><span class="line"><span class="comment">//  WriteThrough 通过中间缓存直接写入磁盘</span></span><br><span class="line">FileStream fileStream2 = File.Create(Application.dataPath + <span class="string">&quot;/Lesson04_文件操作相关_文件流相关.tao&quot;</span>,<span class="number">2048</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">File.Open</font></strong></p>
<ul>
<li>打开指定文件</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//方法三：File.Open</span></span><br><span class="line"><span class="comment">//参数一：路径</span></span><br><span class="line"><span class="comment">//参数二：打开模式</span></span><br><span class="line">FileStream fileStream3 = File.Open(Application.dataPath + <span class="string">&quot;/Lesson04_文件操作相关_文件流相关.tao&quot;</span>, FileMode.OpenOrCreate);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">重要属性和方法</font></strong></p>
<p><strong><font size="3">FileStream.Length </font></strong></p>
<ul>
<li>文本字节长度</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//文本字节长度</span></span><br><span class="line">print(fileStream4.Length);<span class="comment">//0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">FileStream.CanRead </font></strong></p>
<ul>
<li>是否可写</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//是否可写</span></span><br><span class="line"><span class="keyword">if</span> (fileStream4.CanRead)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">FileStream.CanWrite </font></strong></p>
<ul>
<li>是否可读</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//是否可读</span></span><br><span class="line"><span class="keyword">if</span> (fileStream4.CanWrite)</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">FileStream.Flush </font></strong></p>
<ul>
<li>将缓冲区中的数据立即写入到文件中</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//将字节写入文件 当写入后 一定执行写入流 才能保证写入文件成功 不然可能丢失</span></span><br><span class="line">fileStream4.Flush();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>通常情况下，文件写入是通过缓冲区进行的，这样可以提高写入效率。但是，如果您希望确保数据尽快写入到磁盘，而不是等待缓冲区满或者流关闭时才写入，您可以调用 Flush() 方法。<br>调用 Flush() 方法时，它会强制将缓冲区中的数据刷新到文件中，然后清空缓冲区，这样可以确保文件中的数据是最新的。这在某些情况下非常有用，比如在需要确保数据实时保存到文件时，或者在程序即将关闭之前需要确保所有数据都已写入到文件中。</p>
</blockquote>
<p><strong><font size="3">FileStream.Close </font></strong></p>
<ul>
<li>关闭流</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//关闭流 当文件读写完毕后 一定执行关闭流</span></span><br><span class="line">fileStream4.Close();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">FileStream.Dispose </font></strong></p>
<ul>
<li>缓存资源销毁回收</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//缓存资源销毁回收</span></span><br><span class="line">fileStream4.Dispose();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong><font size="3">FileStream.Write </font></strong></p>
<ul>
<li>写入字节</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//打印可读写路径</span></span><br><span class="line">print(Application.persistentDataPath);</span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> (FileStream fileStream5 = <span class="keyword">new</span> FileStream(Application.persistentDataPath + <span class="string">&quot;/Lesson04_文件操作相关_文件流相关.tao&quot;</span>, FileMode.OpenOrCreate, FileAccess.Write))</span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">byte</span>[] bytes = BitConverter.GetBytes(<span class="number">999</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//方法：Write</span></span><br><span class="line">    <span class="comment">//参数一：写入的字节数组</span></span><br><span class="line">    <span class="comment">//参数二：数组中的开始索引</span></span><br><span class="line">    <span class="comment">//参数三：写入多少个字节</span></span><br><span class="line">    <span class="comment">//要传入开始索引和写入多少字节的原因：有可能一个数组前面代表一个数据 中间一截代表另一串数据 可以直接传数组长度</span></span><br><span class="line">    fileStream5.Write(bytes, <span class="number">0</span>, bytes.Length);</span><br><span class="line">    <span class="comment">//fileStream5.Write(bytes, 0, 4);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//写入字符串时 先把字符串转成字节数组</span></span><br><span class="line">    bytes = Encoding.UTF8.GetBytes(<span class="string">&quot;LLLL哈哈哈哈&quot;</span>);</span><br><span class="line">    <span class="comment">//要先写入长度 不然无法自动字符串有多长 传入字节数组长度的直接数组</span></span><br><span class="line">    <span class="comment">//int length = bytes.Length;</span></span><br><span class="line">    fileStream5.Write(BitConverter.GetBytes(bytes.Length), <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="comment">//再写入字符串具体内容 传入直接数组</span></span><br><span class="line">    fileStream5.Write(bytes, <span class="number">0</span>, bytes.Length);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//避免数据丢失 一定写入后要执行的方法</span></span><br><span class="line">    fileStream5.Flush();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//销毁缓存 释放资源</span></span><br><span class="line">    fileStream5.Dispose();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">FileStream.Read </font></strong></p>
<ul>
<li><p>读取字节</p>
</li>
<li><p>挨个读取字节数组并转换</p>
</li>
<li><p>核心思想是读一个转换一个</p>
</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> (FileStream fileStream6 = File.Open(Application.persistentDataPath + <span class="string">&quot;/Lesson04_文件操作相关_文件流相关.tao&quot;</span>, FileMode.Open, FileAccess.Read))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//读取时可以理解为流有个看不见的索引 读到哪索引加到哪</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//用于存储读取的字节数组的容器</span></span><br><span class="line">    <span class="built_in">byte</span>[] bytes2 = <span class="keyword">new</span> <span class="built_in">byte</span>[<span class="number">4</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//参数一：用于存储读取的字节数组的容器</span></span><br><span class="line">    <span class="comment">//参数二：容器中开始的位置</span></span><br><span class="line">    <span class="comment">//参数三：读取多少个字节装入容器</span></span><br><span class="line">    <span class="comment">//返回值：当前流索引前进了几个位置</span></span><br><span class="line">    <span class="built_in">int</span> index = fileStream6.Read(bytes2, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">    <span class="built_in">int</span> i = BitConverter.ToInt32(bytes2, <span class="number">0</span>);</span><br><span class="line">    print(<span class="string">&quot;取出来的第一个整数&quot;</span> + i);<span class="comment">//999</span></span><br><span class="line">    print(<span class="string">&quot;索引向前移动&quot;</span> + index + <span class="string">&quot;个位置&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//读取第二个字符串</span></span><br><span class="line">    <span class="comment">//读取字符串字节数组长度</span></span><br><span class="line">    index = fileStream6.Read(bytes2, <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">    print(<span class="string">&quot;索引向前移动&quot;</span> + index + <span class="string">&quot;个位置&quot;</span>);</span><br><span class="line">    <span class="comment">//转换出直接数组有多长</span></span><br><span class="line">    <span class="built_in">int</span> length = BitConverter.ToInt32(bytes2, <span class="number">0</span>);</span><br><span class="line">    print(<span class="string">&quot;字符串数组长度为&quot;</span> + length);<span class="comment">//21</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//要根据我们存储的字符串字节数组的长度 来声明一个新的字节数组 用来装载读取出来的数据</span></span><br><span class="line">    bytes2 = <span class="keyword">new</span> <span class="built_in">byte</span>[length];</span><br><span class="line">    index = fileStream6.Read(bytes2, <span class="number">0</span>, length);</span><br><span class="line">    print(<span class="string">&quot;索引向前移动&quot;</span> + index + <span class="string">&quot;个位置&quot;</span>);</span><br><span class="line">    <span class="comment">//得到最终的字符串 打印出来</span></span><br><span class="line">    print(Encoding.UTF8.GetString(bytes2));<span class="comment">//LLL哈哈哈哈</span></span><br><span class="line"></span><br><span class="line">    fileStream6.Dispose();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>一次性读取再挨个转换</li>
<li>核心思想是读完全部再转换</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> (FileStream fileStream7 = File.Open(Application.persistentDataPath + <span class="string">&quot;/Lesson04_文件操作相关_文件流相关.tao&quot;</span>, FileMode.Open, FileAccess.Read))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//一开始就申明一个 和文件字节数组长度一样的容器</span></span><br><span class="line">    <span class="built_in">byte</span>[] bytes3 = <span class="keyword">new</span> <span class="built_in">byte</span>[fileStream7.Length];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//一口气读取文件所有字节</span></span><br><span class="line">    fileStream7.Read(bytes3, <span class="number">0</span>, (<span class="built_in">int</span>)fileStream7.Length);</span><br><span class="line"></span><br><span class="line">    fileStream7.Dispose();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//读取整数 因为是int自动读4个字节 从0位置开始读</span></span><br><span class="line">    print(BitConverter.ToInt32(bytes3, <span class="number">0</span>));<span class="comment">//999</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//得去字符串字节数组的长度 因为是int自动读4个字节 从4位置开始读</span></span><br><span class="line">    <span class="built_in">int</span> length2 = BitConverter.ToInt32(bytes3, <span class="number">4</span>);<span class="comment">//21</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到字符串 读取长度是刚刚取出来的字节数组的长度 因为是string 要指定读几位 读味</span></span><br><span class="line">    print(Encoding.UTF8.GetString(bytes3, <span class="number">8</span>, length2));<span class="comment">//LLL哈哈哈哈</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">更加安全的使用文件流对象</font></strong><br>普通用法：</p>
<ul>
<li>申明一个引用对象</li>
<li>使用对象</li>
<li>销毁对象</li>
</ul>
<p>using关键字用法：</p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">using</span> (申明一个引用对象)</span><br><span class="line">&#123;</span><br><span class="line">    使用对象</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>无论发生什么情况，当using语句块结束后，会自动调用该对象的销毁方法，避免忘记销毁或关闭流。using 是一种更安全的使用方法。</li>
<li>强调目前我们对文件流进行操作，为了文件操作安全，都用 using 来进行处理最好。</li>
</ul>
<p><strong><font size="4">总结</font></strong></p>
<ul>
<li>在使用 FileStream 进行读写操作时，需要确保读写的规则是一致的。存储数据的顺序由我们制定的规则决定，按照规则进行读写可以保证数据的正确性。</li>
</ul>
<h2 id="Directory文件夹类、DirectoryInfo文件夹信息类和FileInfo文件信息类"><a href="#Directory文件夹类、DirectoryInfo文件夹信息类和FileInfo文件信息类" class="headerlink" title="Directory文件夹类、DirectoryInfo文件夹信息类和FileInfo文件信息类"></a>Directory文件夹类、DirectoryInfo文件夹信息类和FileInfo文件信息类</h2><p><code>文件操作相关-文件夹相关</code></p>
<p><strong><font size="4">文件夹操作是指什么</font></strong></p>
<ul>
<li>平时我们可以在操作系统的文件管理系统中通过一些操作增删查改文件夹。</li>
<li>我们目前要学习的就是通过代码的形式来对文件夹进行增删查改的操作。</li>
</ul>
<p><strong><font size="4">C#提供给我们的文件夹操作公共类</font></strong></p>
<ul>
<li>类名: Directory</li>
<li>命名空间：using System.IO</li>
</ul>
<p><strong><font size="3">Directory.Exists 判断路径下文件夹是否存在</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//Exists方法 传入判断路径 文件夹是否存在</span></span><br><span class="line"><span class="keyword">if</span> ( Directory.Exists(Application.dataPath + <span class="string">&quot;/二进制教程&quot;</span> + <span class="string">&quot;/Lesson05_文件操作相关_文件夹相关&quot;</span> + <span class="string">&quot;/Lesson05_文件操作相关_文件夹相关&quot;</span>))</span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="string">&quot;存在 Lesson05_文件操作相关_文件夹相关 文件夹&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="string">&quot; Lesson05_文件操作相关_文件夹相关 不存在&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">Directory.CreateDirectory 创建文件夹</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//CreateDirectory方法 创建文件夹 已经存在了的话不会覆盖 会返回文件夹信息</span></span><br><span class="line">DirectoryInfo directoryInfo = Directory.CreateDirectory(Application.dataPath + <span class="string">&quot;/二进制教程&quot;</span> + <span class="string">&quot;/Lesson05_文件操作相关_文件夹相关&quot;</span> + <span class="string">&quot;/Lesson05_文件操作相关_文件夹相关&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">Directory.Delete 删除文件夹</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//Delete方法 删除文件夹</span></span><br><span class="line"><span class="comment">//参数一：路径</span></span><br><span class="line"><span class="comment">//参数二：是否删除非空目录，如果为true，将删除整个目录，如果是false，仅当该目录为空时才可删除。默认是false，就是默认一定要文件夹是空的才删除</span></span><br><span class="line">Directory.Delete(Application.dataPath + <span class="string">&quot;/二进制教程&quot;</span> + <span class="string">&quot;/Lesson05_文件操作相关_文件夹相关&quot;</span> + <span class="string">&quot;/Lesson05_文件操作相关_文件夹相关&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong><font size="3">Directory.GetDirectories 查找文件夹和所有子文件夹</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//GetDirectories方法 查找文件夹</span></span><br><span class="line"><span class="comment">//得到指定路径下所有文件夹名 只能打印文件夹名 不能打印文件名</span></span><br><span class="line"><span class="built_in">string</span>[] strs = Directory.GetDirectories(Application.dataPath);</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; strs.Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//print(strs[i]);</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">Directory.GetFiles 查找文件和所有子文件</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//得到指定路径下所有文件名 只能打印文件名 不能打印文件夹名</span></span><br><span class="line">strs = Directory.GetFiles(Application.dataPath);</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; strs.Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">    print(strs[i]);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">Directory.Move 移动文件夹</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//Move方法 移动文件夹</span></span><br><span class="line"><span class="comment">//如果第二个参数所在的路径 已经存在了一个同名的文件夹 那么会报错</span></span><br><span class="line"><span class="comment">//移动会把文件夹中下的所有内容一起移到新的路径 之前的文件夹就没了</span></span><br><span class="line">Directory.Move(Application.dataPath + <span class="string">&quot;/二进制教程&quot;</span> + <span class="string">&quot;/Lesson05_文件操作相关_文件夹相关&quot;</span> + <span class="string">&quot;/Lesson05_文件操作相关_文件夹相关&quot;</span>,</span><br><span class="line">Application.dataPath + <span class="string">&quot;/二进制教程&quot;</span> + <span class="string">&quot;/Lesson05_文件操作相关_文件夹相关&quot;</span> + <span class="string">&quot;/Lesson05_文件操作相关_文件夹相关移动后&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">DirectoryInfo</font></strong></p>
<p><strong><font size="3">DirectoryInfo目录信息类</font></strong></p>
<ul>
<li>我们可以通过它获取文件夹的更多信息，它主要出现在创建文件夹方法的返回值和查找上级文件夹信息。</li>
</ul>
<p><strong><font size="3">Directory.CreateDirectory得到DirectoryInfo对象</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//创建文件夹方法的返回值 用目录信息类接</span></span><br><span class="line">DirectoryInfo directoryInfo1 = Directory.CreateDirectory(Application.dataPath + <span class="string">&quot;/二进制教程&quot;</span> + <span class="string">&quot;/Lesson05_文件操作相关_文件夹相关&quot;</span> + <span class="string">&quot;/创建文件夹方法的返回值&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">Directory.FullName 全路径</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//全路径</span></span><br><span class="line">print(<span class="string">&quot;创建文件夹方法的返回值 全路径&quot;</span> + directoryInfo1.FullName);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">Directory.Name 文件名</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//文件名</span></span><br><span class="line">print(<span class="string">&quot;创建文件夹方法的返回值 文件名&quot;</span> + directoryInfo1.Name);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">Directory.GetParent 查找上级文件夹信息</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//查找上级文件夹信息</span></span><br><span class="line">directoryInfo1 = Directory.GetParent(Application.dataPath + <span class="string">&quot;/二进制教程&quot;</span> + <span class="string">&quot;/Lesson05_文件操作相关_文件夹相关&quot;</span> + <span class="string">&quot;/创建文件夹方法的返回值&quot;</span>);</span><br><span class="line"><span class="comment">//全路径</span></span><br><span class="line">print(<span class="string">&quot;查找上级文件夹信息 全路径&quot;</span> + directoryInfo1.FullName);</span><br><span class="line"><span class="comment">//文件名</span></span><br><span class="line">print(<span class="string">&quot;查找上级文件夹信息 文件名&quot;</span> + directoryInfo1.Name);</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">DirectoryInfo.GetDirectories 得到所有子文件夹信息</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//GetDirectories方法 得到所有子文件夹的目录信息</span></span><br><span class="line">DirectoryInfo[] directoryInfos = directoryInfo1.GetDirectories();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">FileInfo文件信息类</font></strong></p>
<p><strong><font size="3">DirectoryInfo.GetFiles 得到所有子文件信息</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment">//GetFiles方法 可以通过DirectoryInfo得到该文件下的所有文件信息</span></span><br><span class="line">FileInfo[] fileInfos = directoryInfo1.GetFiles();</span><br><span class="line"><span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; fileInfos.Length; i++)</span><br><span class="line">&#123;</span><br><span class="line">    print(<span class="string">&quot;**************&quot;</span>);</span><br><span class="line">    print(fileInfos[i].Name);<span class="comment">//文件名</span></span><br><span class="line">    print(fileInfos[i].FullName);<span class="comment">//路径</span></span><br><span class="line">    print(fileInfos[i].Length);<span class="comment">//字节长度</span></span><br><span class="line">    print(fileInfos[i].Extension);<span class="comment">//后缀名</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">总结</font></strong></p>
<ul>
<li>Directory 提供给我们了常用的文件夹相关操作的 API，只需要熟练使用它即可。</li>
<li>DirectoryInfo 和 FileInfo 一般在多文件夹和多文件操作时会用到，了解即可。目前用的相对较少，它们的用法和 Directory 和 File 类的用法大同小异。</li>
</ul>
<h2 id="Student类实现存储读取2进制"><a href="#Student类实现存储读取2进制" class="headerlink" title="Student类实现存储读取2进制"></a>Student类实现存储读取2进制</h2><p><code>文件操作相关-综合练习题</code></p>
<p><strong><font size="4">Student类实现保存和读取2进制文件的方法</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/%E4%BA%8C%E8%BF%9B%E5%88%B6_Student%E7%B1%BB.png" class="" title="二进制_Student类"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>


<p><strong><font size="3">创建Student类</font></strong></p>
<ul>
<li>添加对应的变量</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Student</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> number;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">bool</span> sex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">Student类中创建保存方法</font></strong></p>
<ul>
<li>传入文件名参数。判断可读可写路径下是否存在Student文件夹，不存在则创建。新建流进行写入对应变量。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Save</span>(<span class="params"><span class="built_in">string</span> fileName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    Debug.Log(Application.persistentDataPath); <span class="comment">// 打印存储的路径</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果不存在指定路径，则创建一个文件夹</span></span><br><span class="line">    <span class="keyword">if</span> (!Directory.Exists(Application.persistentDataPath + <span class="string">&quot;/Student&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        Directory.CreateDirectory(Application.persistentDataPath + <span class="string">&quot;/Student&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 新建一个指定名字的文件，并返回文件流进行字节的存储</span></span><br><span class="line">    <span class="keyword">using</span> (FileStream fileStream = <span class="keyword">new</span> FileStream(Application.persistentDataPath + <span class="string">&quot;/Student/&quot;</span> + fileName + <span class="string">&quot;.linwentao&quot;</span>, FileMode.OpenOrCreate, FileAccess.Write))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 写入 age</span></span><br><span class="line">        <span class="built_in">byte</span>[] bytes = BitConverter.GetBytes(age);</span><br><span class="line">        fileStream.Write(bytes, <span class="number">0</span>, bytes.Length);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 写入 name</span></span><br><span class="line">        bytes = Encoding.UTF8.GetBytes(name);</span><br><span class="line">        <span class="comment">// 存储字符串字节数组的长度</span></span><br><span class="line">        fileStream.Write(BitConverter.GetBytes(bytes.Length), <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">        <span class="comment">// 存储字符串字节数组</span></span><br><span class="line">        fileStream.Write(bytes, <span class="number">0</span>, bytes.Length);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 写入 number</span></span><br><span class="line">        bytes = BitConverter.GetBytes(number);</span><br><span class="line">        fileStream.Write(bytes, <span class="number">0</span>, bytes.Length);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 写入 sex</span></span><br><span class="line">        bytes = BitConverter.GetBytes(sex);</span><br><span class="line">        fileStream.Write(bytes, <span class="number">0</span>, bytes.Length);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 刷新缓冲区，确保所有数据已写入文件</span></span><br><span class="line">        fileStream.Flush();</span><br><span class="line">        <span class="comment">// 关闭文件流</span></span><br><span class="line">        fileStream.Close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong><font size="3">Student类中创建读取方法</font></strong></p>
<ul>
<li>传入文件名参数。判断文件是否存在，不存在返回空。申明Student对象，读取文件中全部直接数组，挨个读取其中的内容，用一个索引记录。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Student <span class="title">Load</span>(<span class="params"><span class="built_in">string</span> fileName</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//判断文件是否存在</span></span><br><span class="line">    <span class="keyword">if</span> (!File.Exists(Application.persistentDataPath + <span class="string">&quot;/Student/&quot;</span> + fileName + <span class="string">&quot;.linwentao&quot;</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        Debug.LogWarning(<span class="string">&quot;没有找到对应的文件&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//申明对象</span></span><br><span class="line">    Student student = <span class="keyword">new</span> Student();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//加载2进制文件 进行赋值</span></span><br><span class="line">    <span class="keyword">using</span> (FileStream fileStream = File.Open(Application.persistentDataPath + <span class="string">&quot;/Student/&quot;</span> + fileName + <span class="string">&quot;.linwentao&quot;</span>, FileMode.Open, FileAccess.Read))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//把我们文件中的字节 全部读取出来</span></span><br><span class="line">        <span class="built_in">byte</span>[] bytes = <span class="keyword">new</span> <span class="built_in">byte</span>[fileStream.Length];</span><br><span class="line">        fileStream.Read(bytes, <span class="number">0</span>, bytes.Length);</span><br><span class="line">        fileStream.Close();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取索引</span></span><br><span class="line">        <span class="built_in">int</span> index = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//挨个读取其中的内容</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取age</span></span><br><span class="line">        student.age = BitConverter.ToInt32(bytes, index);</span><br><span class="line">        index += <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取字符串字节数组的长度</span></span><br><span class="line">        <span class="built_in">int</span> length = BitConverter.ToInt32(bytes, index);</span><br><span class="line">        index += <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取name</span></span><br><span class="line">        student.name = Encoding.UTF8.GetString(bytes, index, length);</span><br><span class="line">        index += length;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取number</span></span><br><span class="line">        student.number = BitConverter.ToInt32(bytes, index);</span><br><span class="line">        index += <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取sex</span></span><br><span class="line">        student.sex = BitConverter.ToBoolean(bytes, index);</span><br><span class="line">        index += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> student;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>对读取存储方法进行测试</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestScript</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        Student student1 = <span class="keyword">new</span> Student();</span><br><span class="line">        student1.age = <span class="number">18</span>;</span><br><span class="line">        student1.name = <span class="string">&quot;L&quot;</span>;</span><br><span class="line">        student1.number = <span class="number">1</span>;</span><br><span class="line">        student1.sex = <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">        student1.Save(<span class="string">&quot;L&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Student student2 = Student.Load(<span class="string">&quot;L&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h2 id="序列化二进制数据"><a href="#序列化二进制数据" class="headerlink" title="序列化二进制数据"></a>序列化二进制数据</h2><p><strong><font size="4">申明类对象</font></strong></p>
<ul>
<li>注意：如果要使用C#自带的序列化2进制方法</li>
<li>申明类和结构体时需要添加[System.Serializable]特性</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[<span class="meta">System.Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Person</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> age = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name = <span class="string">&quot;老师&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span>[] ints = <span class="keyword">new</span> <span class="built_in">int</span>[] &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span> &#125;;</span><br><span class="line">    <span class="keyword">public</span> List&lt;<span class="built_in">int</span>&gt; list = <span class="keyword">new</span> List&lt;<span class="built_in">int</span>&gt;() &#123; <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span> &#125;;</span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt; dic = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">int</span>, <span class="built_in">string</span>&gt;() &#123; &#123; <span class="number">1</span>,<span class="string">&quot;123&quot;</span>&#125;,&#123; <span class="number">2</span>,<span class="string">&quot;1223&quot;</span>&#125;,&#123; <span class="number">3</span>,<span class="string">&quot;435345&quot;</span> &#125; &#125;;</span><br><span class="line">    <span class="keyword">public</span> StructTest st = <span class="keyword">new</span> StructTest(<span class="number">2</span>, <span class="string">&quot;123&quot;</span>);</span><br><span class="line">    <span class="keyword">public</span> ClssTest ct = <span class="keyword">new</span> ClssTest();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">System.Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">struct</span> StructTest</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> i;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> s;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">StructTest</span>(<span class="params"><span class="built_in">int</span> i, <span class="built_in">string</span> s</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">this</span>.i = i;</span><br><span class="line">        <span class="keyword">this</span>.s = s;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">System.Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ClssTest</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> i = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong><font size="4">将对象进行二进制序列化</font></strong></p>
<p><strong><font size="3">新知识点：</font></strong><br>内存流对象 主要用于得到字节数组，可用于网络传输</p>
<ul>
<li>类名：MemoryStream</li>
<li>命名空间：System.IO</li>
<li>主要方法：得到字节数组方法 GetBuffer</li>
</ul>
<p>2进制格式化对象</p>
<ul>
<li>类名：BinaryFormatter</li>
<li>命名空间：System.Runtime.Serialization.Formatters.Binary</li>
<li>主要方法：序列化方法 Serialize</li>
</ul>
<p><strong><font size="3">声明Person对象</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">Person person = <span class="keyword">new</span> Person();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">方法一：使用内存流得到2进制字节数组</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> (MemoryStream memoryStream = <span class="keyword">new</span> MemoryStream())</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建2进制格式化对象</span></span><br><span class="line">    BinaryFormatter binaryFormatter = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 序列化对象，生成2进制字节数组，写入到内存流当中</span></span><br><span class="line">    binaryFormatter.Serialize(memoryStream, person);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 得到内存流的2进制字节数组</span></span><br><span class="line">    <span class="built_in">byte</span>[] bytes = memoryStream.GetBuffer();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 存储字节</span></span><br><span class="line">    File.WriteAllBytes(Application.dataPath + <span class="string">&quot;/Lesson07_CSharp类对象相关_序列化1.linwentao&quot;</span>, bytes);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭内存流</span></span><br><span class="line">    memoryStream.Close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">方法二：使用文件流进行存储</font></strong></p>
<ul>
<li>主要用于存储到文件中</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> (FileStream fileStream = <span class="keyword">new</span> FileStream(Application.dataPath + <span class="string">&quot;/Lesson07_CSharp类对象相关_序列化2.linwentao&quot;</span>, FileMode.OpenOrCreate, FileAccess.Write))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 创建2进制格式化对象</span></span><br><span class="line">    BinaryFormatter binaryFormatter = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 序列化对象，生成2进制字节数组，写入到文件流当中</span></span><br><span class="line">    binaryFormatter.Serialize(fileStream, person);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 刷新存储</span></span><br><span class="line">    fileStream.Flush();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 关闭文件流</span></span><br><span class="line">    fileStream.Close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="4">总结</font></strong></p>
<ul>
<li>C#提供的类对象2进制序列化主要类是 BinaryFormatter，通过其中的序列化方法即可进行序列化生成字节数组</li>
</ul>
<h2 id="反序列化二进制数据"><a href="#反序列化二进制数据" class="headerlink" title="反序列化二进制数据"></a>反序列化二进制数据</h2><p><code>CSharp类对象相关-反序列化</code></p>
<p><strong><font size="4">反序列化文件中数据</font></strong></p>
<p><strong><font size="3">主要类</font></strong></p>
<ul>
<li>FileStream文件流类</li>
<li>BinaryFormatter 2进制格式化类</li>
</ul>
<p><strong><font size="3">主要方法</font></strong></p>
<ul>
<li>Deserizlize：通过文件流打开指定的2进制数据文件</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> (FileStream fileStream = File.Open(Application.dataPath + <span class="string">&quot;/Lesson07_CSharp类对象相关_序列化1.linwentao&quot;</span>, FileMode.Open, FileAccess.Read))</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//申明一个 2进制格式化类</span></span><br><span class="line">    BinaryFormatter binaryFormatter = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//反序列化</span></span><br><span class="line">    Person person = binaryFormatter.Deserialize(fileStream) <span class="keyword">as</span> Person;</span><br><span class="line"></span><br><span class="line">    fileStream.Close();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<blockquote>
<p>目前没有网络传输，我们还是直接从文件中获取，模拟网络加载的字节数组</p>
</blockquote>
<h2 id="二进制数据加密"><a href="#二进制数据加密" class="headerlink" title="二进制数据加密"></a>二进制数据加密</h2><p><strong><font size="4">何时加密？何时解密？</font></strong></p>
<ul>
<li>当我们将类对象转换为二进制数据时进行加密。</li>
<li>当我们将二进制数据转换为类对象时进行解密。</li>
<li>这样如果第三方获取到我们的二进制数据，当他们不知道加密规则和解密秘钥时就无法获取正确的数据，起到保证数据安全的作用。</li>
</ul>
<p><strong><font size="4">加密是否是100%安全？</font></strong></p>
<ul>
<li>一定记住加密只是提高破解门槛，没有100%保密的数据。</li>
<li>通过各种尝试始终是可以破解加密规则的，只是时间问题。</li>
<li>加密只能起到提升一定的安全性。</li>
</ul>
<p><strong><font size="4">常用加密算法</font></strong></p>
<ul>
<li>MD5算法</li>
<li>SHA1算法</li>
<li>HMAC算法</li>
<li>AES&#x2F;DES&#x2F;3DES算法</li>
<li>等等等</li>
</ul>
<blockquote>
<p>有很多的别人写好的第三发加密算法库，可以直接获取用于在程序中对数据进行加密。这里我们不深究，感兴趣的可以自己去了解。</p>
</blockquote>
<p><strong><font size="4">用简单的异或加密感受加密的作用</font></strong></p>
<ul>
<li>注意：两次异或操作会使得原始值恢复</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">   &#123;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 创建一个名为person1的Person对象实例</span></span><br><span class="line">       Person person1 = <span class="keyword">new</span> Person();</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 定义一个名为key的byte变量，并赋值为199</span></span><br><span class="line">       <span class="built_in">byte</span> key = <span class="number">199</span>;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 使用using语句块创建一个名为memoryStream的MemoryStream对象实例</span></span><br><span class="line">       <span class="keyword">using</span> (MemoryStream memoryStream = <span class="keyword">new</span> MemoryStream())</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="comment">// 创建一个BinaryFormatter对象实例</span></span><br><span class="line">           BinaryFormatter binaryFormatter = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line"></span><br><span class="line">           <span class="comment">// 将person1对象序列化到memoryStream中</span></span><br><span class="line">           binaryFormatter.Serialize(memoryStream, person1);</span><br><span class="line"></span><br><span class="line">           <span class="comment">// 获取memoryStream中的字节数组</span></span><br><span class="line">           <span class="built_in">byte</span>[] bytes = memoryStream.GetBuffer();</span><br><span class="line"></span><br><span class="line">           <span class="comment">// 对字节数组进行异或加密</span></span><br><span class="line">           <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; bytes.Length; i++)</span><br><span class="line">           &#123;</span><br><span class="line">               bytes[i] ^= key;</span><br><span class="line">           &#125;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// 将加密后的字节数组写入文件</span></span><br><span class="line">           File.WriteAllBytes(Application.dataPath + <span class="string">&quot;/Lesson09_CSharp类对象相关_二进制数据加密.linwentao&quot;</span>, bytes);</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 解密</span></span><br><span class="line">       <span class="comment">// 从文件中读取字节数组</span></span><br><span class="line">       <span class="built_in">byte</span>[] bytes2 = File.ReadAllBytes(Application.dataPath + <span class="string">&quot;/Lesson09_CSharp类对象相关_二进制数据加密.linwentao&quot;</span>);</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 对字节数组进行异或解密</span></span><br><span class="line">       <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; bytes2.Length; i++)</span><br><span class="line">       &#123;</span><br><span class="line">           bytes2[i] ^= key;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       <span class="comment">// 使用using语句块创建一个名为memoryStream的MemoryStream对象实例，并传入解密后的字节数组</span></span><br><span class="line">       <span class="keyword">using</span> (MemoryStream memoryStream = <span class="keyword">new</span> MemoryStream(bytes2))</span><br><span class="line">       &#123;</span><br><span class="line">           <span class="comment">// 创建一个BinaryFormatter对象实例</span></span><br><span class="line">           BinaryFormatter binaryFormatter = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line"></span><br><span class="line">           <span class="comment">// 从memoryStream中反序列化出一个Person对象，并将其赋值给person2变量</span></span><br><span class="line">           Person person2 = binaryFormatter.Deserialize(memoryStream) <span class="keyword">as</span> Person;</span><br><span class="line"></span><br><span class="line">           <span class="comment">// 关闭memoryStream</span></span><br><span class="line">           memoryStream.Close();</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="二进制数据管理器"><a href="#二进制数据管理器" class="headerlink" title="二进制数据管理器"></a>二进制数据管理器</h2><p><code>CSharp类对象相关-综合练习题</code></p>
<p><strong><font size="4">请实现一个管理类，用于快捷读写自定义类对象数据</font></strong></p>
<p><strong><font size="3">定义二进制数据管理类，做成单例，定义数据存储路径</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 二进制数据管理器</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BinaryDataMgr</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> BinaryDataMgr instance = <span class="keyword">new</span> BinaryDataMgr();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> BinaryDataMgr Instance =&gt; instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">BinaryDataMgr</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 数据存储路径</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">string</span> SAVE_PATH = Application.persistentDataPath + <span class="string">&quot;/Data/&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">创建二进制保存类对象函数。</font></strong></p>
<ul>
<li>检查指定的路径文件夹是否存在，如果不存在则创建该文件夹。使用 FileStream 创建一个文件流，指定要打开或创建的文件的方式为打开或创建。创建 BinaryFormatter 对象，用于序列化数据。调用 BinaryFormatter 对象的 Serialize 方法，将要保存的对象 obj 序列化到文件流中，以保存对象的数据。关闭文件流，确保数据已经保存到文件中。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BinaryDataMgr</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 存储类对象数据</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;obj&quot;&gt;</span>要保存的对象<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;fileName&quot;&gt;</span>文件名<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Save</span>(<span class="params"><span class="built_in">object</span> obj, <span class="built_in">string</span> fileName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 先判断路径文件夹是否存在，如果不存在则创建</span></span><br><span class="line">        <span class="keyword">if</span> (!Directory.Exists(SAVE_PATH))</span><br><span class="line">        Directory.CreateDirectory(SAVE_PATH);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用 FileStream 创建一个文件流，并指定打开或创建文件的方式</span></span><br><span class="line">        <span class="keyword">using</span> (FileStream fs = <span class="keyword">new</span> FileStream(SAVE_PATH + fileName + <span class="string">&quot;.tao&quot;</span>, FileMode.OpenOrCreate, FileAccess.Write))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 创建 BinaryFormatter 对象用于序列化数据</span></span><br><span class="line">            BinaryFormatter bf = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将对象 obj 序列化到文件流中</span></span><br><span class="line">            bf.Serialize(fs, obj);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 关闭文件流</span></span><br><span class="line">            fs.Close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">创建二进制读取类对象函数。</font></strong></p>
<ul>
<li>检查指定的二进制数据文件是否存在，如果文件不存在，则直接返回指定类型对象的默认值。创建一个泛型对象 obj，用于存储反序列化后的对象数据。使用 FileStream 打开文件流，指定要打开的文件的路径、打开方式为只读。创建 BinaryFormatter 对象，用于反序列化数据。调用 BinaryFormatter 对象的 Deserialize 方法，将文件流中的数据反序列化为指定类型的对象，并将其赋值给 obj。关闭文件流，确保资源释放。返回读取到的对象 obj。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BinaryDataMgr</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 从二进制数据文件中读取并转换为指定类型的对象</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span>对象类型<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;fileName&quot;&gt;</span>文件名<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>读取到的对象<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">Load</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="built_in">string</span> fileName</span>) <span class="keyword">where</span> T : <span class="keyword">class</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果文件不存在，则直接返回指定类型对象的默认值</span></span><br><span class="line">        <span class="keyword">if</span> (!File.Exists(SAVE_PATH + fileName + <span class="string">&quot;.tao&quot;</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">default</span>(T);</span><br><span class="line"></span><br><span class="line">        T obj;</span><br><span class="line">        <span class="comment">// 使用 FileStream 打开文件流，并指定打开文件的方式为只读</span></span><br><span class="line">        <span class="keyword">using</span> (FileStream fs = File.Open(SAVE_PATH + fileName + <span class="string">&quot;.tao&quot;</span>, FileMode.Open, FileAccess.Read))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 创建 BinaryFormatter 对象用于反序列化数据</span></span><br><span class="line">            BinaryFormatter bf = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将文件流中的数据反序列化为指定类型的对象</span></span><br><span class="line">            obj = bf.Deserialize(fs) <span class="keyword">as</span> T;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 关闭文件流</span></span><br><span class="line">            fs.Close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">创建测试类进行测试，注意添加可序列化特性</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestScript</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//练习题 请实现一个管理类，用于快捷读写自定义类对象数据</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//Test t1 = new Test();</span></span><br><span class="line">        <span class="comment">//t1.i = 250;</span></span><br><span class="line">        <span class="comment">//t1.str = &quot;北京欢迎你&quot;;</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">//print(Application.persistentDataPath);</span></span><br><span class="line">        <span class="comment">//BinaryDataMgr.Instance.Save(t1, &quot;哈哈哈&quot;);</span></span><br><span class="line">        </span><br><span class="line">        Test t2 = BinaryDataMgr.Instance.Load&lt;Test&gt;(<span class="string">&quot;哈哈哈&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">[<span class="meta">System.Serializable</span>]</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">Test</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> i;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Binary基础知识总结"><a href="#Binary基础知识总结" class="headerlink" title="Binary基础知识总结"></a>Binary基础知识总结</h2><p><strong><font size="4">优点</font></strong></p>
<ul>
<li>效率高</li>
<li>节约空间</li>
<li>安全性高</li>
<li>建议优先选择使用的数据持久化方案</li>
</ul>
<p><strong><font size="4">缺点</font></strong></p>
<ul>
<li>可读性较差</li>
<li>无法从数据文件看懂数据或修改数据</li>
</ul>
<p><strong><font size="4">主要用处</font></strong></p>
<p><strong><font size="3">网络游戏</font></strong></p>
<ul>
<li>可以用于储存客户端数据</li>
<li>可以用于传输信息</li>
</ul>
<p><strong><font size="3">单机游戏</font></strong></p>
<ul>
<li>用于存储游戏相关数据</li>
<li>用于配置游戏数据</li>
</ul>
<h2 id="Binary（二进制）实践项目"><a href="#Binary（二进制）实践项目" class="headerlink" title="Binary（二进制）实践项目"></a>Binary（二进制）实践项目</h2><p><strong><font size="4">添加菜单栏按钮和刷新Project窗口</font></strong><br><code>知识点补充-Unity添加菜单栏按钮</code></p>
<p><strong><font size="3">为编辑器菜单栏添加新的选项入口</font></strong><br>可以通过 Unity 提供的 MenuItem 特性在菜单栏添加选项按钮。</p>
<ul>
<li>特性名：MenuItem</li>
<li>命名空间：UnityEditor</li>
</ul>
<p>规则：</p>
<ul>
<li>1.一定是静态方法</li>
<li>2.我们这个菜单栏按钮必须有至少一个斜杠，不然会报错，它不支持只有一个菜单栏入口</li>
<li>3.这个特性可以用在任意的类当中，可以不继承 MonoBehaviour 也正常使用</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestScript</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">MenuItem(<span class="string">&quot;Unity添加菜单栏按钮/新的选项&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> 为编辑器菜单栏添加新的选项入口()</span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;为编辑器菜单栏添加新的选项入口&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/%E4%BA%8C%E8%BF%9B%E5%88%B6_%E5%88%9B%E5%BB%BA%E8%8F%9C%E5%8D%95%E6%A0%8F%E6%8C%89%E9%92%AE.png" class="" title="二进制_创建菜单栏按钮"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>


<p><strong><font size="3">刷新Project窗口内容</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestScript</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    [<span class="meta">MenuItem(<span class="string">&quot;Unity添加菜单栏按钮/新的选项&quot;</span>)</span>]</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> 为编辑器菜单栏添加新的选项入口()</span><br><span class="line">    &#123;</span><br><span class="line">        Debug.Log(<span class="string">&quot;为编辑器菜单栏添加新的选项入口&quot;</span>);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 类名：AssetDatabase</span></span><br><span class="line">        <span class="comment">// 命名空间：UnityEditor</span></span><br><span class="line">        <span class="comment">// 方法：Refresh</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建文件夹并刷新</span></span><br><span class="line">        Directory.CreateDirectory(Application.dataPath + <span class="string">&quot;/刷新Project窗口内容测试文件夹&quot;</span>);</span><br><span class="line">        AssetDatabase.Refresh();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/%E4%BA%8C%E8%BF%9B%E5%88%B6_%E8%8F%9C%E5%8D%95%E6%A0%8F%E6%8C%89%E9%92%AE%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E5%A4%B9.png" class="" title="二进制_菜单栏按钮创建文件夹"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>


<p><strong><font size="3">Editor文件夹</font></strong></p>
<ul>
<li>Editor 文件夹可以放在项目的任何文件夹下，可以有多个。</li>
<li>放在其中的内容，在项目打包时不会被打包到项目中。</li>
<li>一般编辑器相关代码都可以放在该文件夹中。</li>
</ul>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/%E4%BA%8C%E8%BF%9B%E5%88%B6_Editor%E6%96%87%E4%BB%B6%E5%A4%B9.png" class="" title="二进制_Editor文件夹"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<p><strong><font size="3">总结</font></strong></p>
<ul>
<li>我们之后在学习通过 Excel 表生成数据的功能时，可以在菜单栏加一个按钮，点击后就可以自动为我们生成对应数据了。</li>
</ul>
<p><strong><font size="4">导入Excel.dll</font></strong></p>
<p><strong><font size="3">了解Excel表的本质</font></strong></p>
<ul>
<li>Excel表本质上也是一堆数据</li>
<li>只不过它有自己的存储读取规则</li>
<li>如果我们想要通过代码读取它</li>
<li>那么必须知道它的存储规则</li>
<li>官网是专门提供了对应的DLL文件用来解析Excel文件的</li>
<li>Dll文件：库文件，你可以理解为它是许多代码的集合</li>
<li>将相关代码集合在库文件中可以方便迁移和使用</li>
<li>有了某个DLL文件，我们就可以使用其中已经写好的代码</li>
<li>而Excel的DLL包就是官方已经把解析Excel表的相关类和方法写好了</li>
<li>方便用户直接使用</li>
</ul>
<p><strong><font size="3">导入官方提供的Excel相关DLL文件</font></strong></p>
<ul>
<li>最好放到Editor文件夹里面，一般Excel解析都在编辑器中，不会在游戏运行时解析</li>
</ul>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/%E4%BA%8C%E8%BF%9B%E5%88%B6_Excel.Dii.png" class="" title="二进制_Excel.Dii"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>


<p><strong><font size="4">读取Excel表数据</font></strong></p>
<p><strong><font size="3">打开Excel表</font></strong><br>注意</p>
<ul>
<li>假如ExcelDll放到Eiditor文件夹下 对Excel数据读取的脚本也要放到Eiditor文件夹下 否则无法访问 同时代码访问对应Excel表时不能打开占用对应Excel表 否则报错</li>
</ul>
<p>在Editor文件夹下创建一个Excel表。写入一些内容。</p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/%E4%BA%8C%E8%BF%9B%E5%88%B6_Excel%E8%A1%A8%E6%A0%BC.png" class="" title="二进制_Excel表格"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>



<p><strong><font size="3">创建打开Excel表方法</font></strong></p>
<p>主要知识点：</p>
<ul>
<li>FileStream读取文件流</li>
<li>IExcelDataReader类，从流中读取Excel数据</li>
<li>DataSet 数据集合类 将Excel数据转存进其中方便读取</li>
</ul>
<p>注意：</p>
<ul>
<li>excelReader.AsDataSet()得到的是DataSet 代表整个Excel文件的数据</li>
<li>excelReader.AsDataSet().Tables得到的是tableConllection tableConllection是DataTable集合 代表的是一个是Excel文件中的子表集合</li>
<li>比如PlayerInfo和Sheet2都算一个子表 对应数据结构是一个DataTable 只不过Sheet2是空而已</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[<span class="meta">MenuItem(<span class="string">&quot;Excel/OpenExcelTable&quot;</span>)</span>]</span><br><span class="line">  <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OpenExcel</span>()</span></span><br><span class="line">  &#123;</span><br><span class="line">      <span class="keyword">using</span> (FileStream fileStream = File.Open(Application.dataPath + <span class="string">&quot;/Client/Script/Del/Editor/Excel/PlayerInfo.xlsx&quot;</span>, FileMode.Open, FileAccess.Read))</span><br><span class="line">      &#123;</span><br><span class="line">          <span class="comment">// 通过ExcelReaderFactory的CreateOpenXmlReader和我们的文件流 获取Excel数据</span></span><br><span class="line">          IExcelDataReader iExcelDataReader = ExcelReaderFactory.CreateOpenXmlReader(fileStream);</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 将excel表中的数据转换为DataSet数据类型 方便我们 获取其中的内容</span></span><br><span class="line">          DataSet dataSet = iExcelDataReader.AsDataSet();</span><br><span class="line"></span><br><span class="line">          <span class="comment">// 得到Excel文件中的所有表信息 现在Excel文件有PlayerInfo表和Sheet2空表 假如是空表不会遍历</span></span><br><span class="line">          <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; dataSet.Tables.Count; i++)</span><br><span class="line">          &#123;</span><br><span class="line">              Debug.Log(<span class="string">&quot;表名：&quot;</span> + dataSet.Tables[i].TableName);</span><br><span class="line">              Debug.Log(<span class="string">&quot;行数：&quot;</span> + dataSet.Tables[i].Rows.Count);</span><br><span class="line">              Debug.Log(<span class="string">&quot;列数：&quot;</span> + dataSet.Tables[i].Columns.Count);</span><br><span class="line">          &#125;</span><br><span class="line"></span><br><span class="line">          fileStream.Close();</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/%E4%BA%8C%E8%BF%9B%E5%88%B6_Excel%E8%A1%A8%E6%A0%BC%E8%8E%B7%E5%8F%96%E8%A1%A8%E5%90%8D%E5%92%8C%E8%A1%8C%E5%88%97%E6%95%B0.png" class="" title="二进制_Excel表格获取表名和行列数"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<p><strong><font size="3">获取Excel表中单元格的信息</font></strong></p>
<ul>
<li>FileStream读取文件流</li>
<li>IExcelDataReader类，从流中读取Excel数据</li>
<li>DataSet 数据集合类 将Excel数据转存进其中方便读取</li>
<li>DataTable 数据表类 表示Excel文件中的一个表</li>
<li>DataRow 数据行类 表示某张表中的一行数据</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[<span class="meta">MenuItem(<span class="string">&quot;Excel/OpenExcelTable&quot;</span>)</span>]</span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">OpenExcel</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">using</span> (FileStream fileStream = File.Open(Application.dataPath + <span class="string">&quot;/Client/Script/Del/Editor/Excel/PlayerInfo.xlsx&quot;</span>, FileMode.Open, FileAccess.Read))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 通过ExcelReaderFactory的CreateOpenXmlReader和我们的文件流 获取Excel数据</span></span><br><span class="line">            IExcelDataReader iExcelDataReader = ExcelReaderFactory.CreateOpenXmlReader(fileStream);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将excel表中的数据转换为DataSet数据类型 方便我们 获取其中的内容</span></span><br><span class="line">            DataSet dataSet = iExcelDataReader.AsDataSet();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 得到Excel文件中的所有表信息 现在Excel文件有PlayerInfo表和Sheet2空表 假如是空表不会遍历</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; dataSet.Tables.Count; i++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="comment">//Debug.Log(&quot;表名：&quot; + dataSet.Tables[i].TableName);</span></span><br><span class="line">                <span class="comment">//Debug.Log(&quot;行数：&quot; + dataSet.Tables[i].Rows.Count);</span></span><br><span class="line">                <span class="comment">//Debug.Log(&quot;列数：&quot; + dataSet.Tables[i].Columns.Count);</span></span><br><span class="line"></span><br><span class="line">                <span class="comment">// 得到当前表格</span></span><br><span class="line">                DataTable table = dataSet.Tables[i];</span><br><span class="line"></span><br><span class="line">                <span class="comment">// 遍历当前表格中的所有行</span></span><br><span class="line">                DataRow row;</span><br><span class="line">                <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; table.Rows.Count; j++)</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">// 得到当前行数据</span></span><br><span class="line">                    row = table.Rows[j];</span><br><span class="line"></span><br><span class="line">                    Debug.Log(<span class="string">&quot;*********新的一行************&quot;</span>);</span><br><span class="line"></span><br><span class="line">                    <span class="comment">// 遍历当前行中的所有列</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="built_in">int</span> k = <span class="number">0</span>; k &lt; table.Columns.Count; k++)</span><br><span class="line">                    &#123;</span><br><span class="line">                        <span class="comment">// 打印当前列的数据</span></span><br><span class="line">                        Debug.Log(row[k].ToString());</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">                fileStream.Close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/%E4%BA%8C%E8%BF%9B%E5%88%B6_Excel%E8%A1%A8%E6%A0%BC%E8%8E%B7%E5%8F%96%E5%8D%95%E5%85%83%E6%A0%BC%E4%BF%A1%E6%81%AF.png" class="" title="二进制_Excel表格获取单元格信息"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>



<p><strong><font size="3">获取Excel表中信息对于我们的意义？</font></strong></p>
<p>既然我们能够获取到Excel表中的所有数据</p>
<p>那么我们可以根据表中数据来动态的生成相关数据</p>
<ul>
<li>数据结构类</li>
<li>容器类</li>
<li>2进制数据</li>
</ul>
<p>为什么不直接读取Excel表而要把它转成2进制数据</p>
<ul>
<li>提升读取效率</li>
<li>提升数据安全性</li>
</ul>
<p><strong><font size="4">需求分析</font></strong></p>
<p>点击编辑器下拉列表的按钮，要生成三个文件</p>
<ul>
<li>2进制文件，高效的对Excel表数据进行存储读取</li>
<li>数据结构类脚本文件，关联Excel表数据的字段</li>
<li>容器类文件，用数据结构类字典存储Excel表数据</li>
</ul>
<p><strong><font size="4">制定配表规则</font></strong><br><code>Excel表自动生成相关文件-制定配表规则</code></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/%E4%BA%8C%E8%BF%9B%E5%88%B6_Excel%E8%A1%A8%E6%A0%BC.png" class="" title="二进制_Excel表格"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<ul>
<li>第一行为字段名。</li>
<li>第二行为字段类型。</li>
<li>第三行为字典中的键，控制一条数据的主键。</li>
<li>第四行为描述信息。第</li>
<li>五行开始是具体数据。</li>
<li>表名就是数据结构名。</li>
</ul>
<p><strong><font size="3">如下是一些测试用表。</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/%E4%BA%8C%E8%BF%9B%E5%88%B6_Excel%E8%A1%A8%E6%A0%BC_2.png" class="" title="二进制_Excel表格"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>



<p><strong><font size="4">读取Excel目录下所有Excel文件</font></strong></p>
<p><strong><font size="3">创建ExcelTool类</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ExcelTool</span></span><br><span class="line">&#123;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">在ExcelTool类中定义了一个常量EXCEL_PATH</font></strong></p>
<ul>
<li>表示Excel文件存放的路径。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">ExcelTool</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> excel文件存放的路径</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> EXCEL_PATH = Application.dataPath + <span class="string">&quot;/Client/Script/Del/Editor/Excel&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


<p><strong><font size="3">创建为GenerateExcelInfo静态方法</font></strong></p>
<ul>
<li>使用[MenuItem]特性为GenerateExcelInfo方法创建了一个菜单项，用于在Unity编辑器中手动触发Excel数据生成的操作。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">[<span class="meta">MenuItem(<span class="string">&quot;GameTool/GenerateExcel&quot;</span>)</span>]</span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateExcelInfo</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>GenerateExcelInfo方法中首先通过Directory.CreateDirectory方法得到了存放Excel文件的目录对象dInfo，CreateDirectory方法如果存在对应路径的话会返回目录对象，否则会创建对应目录。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateExcelInfo</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//加载指定路径中的所有Excel文件 用于生成对应的3个文件 CreateDirectory方法如果存在对应路径的话会返回目录对象</span></span><br><span class="line">    DirectoryInfo dInfo = Directory.CreateDirectory(EXCEL_PATH);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>获取目录中的所有文件信息，即Excel文件，保存在FileInfo数组files中。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateExcelInfo</span>()</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//得到指定路径中的所有文件信息 相当于就是得到所有的Excel表</span></span><br><span class="line">    FileInfo[] files = dInfo.GetFiles();</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>初始化一个DataTableCollection对象tableConllection用于存储读取到的Excel表格数据。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateExcelInfo</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//数据表容器</span></span><br><span class="line">    DataTableCollection tableConllection;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<ul>
<li>对目录中的所有文件信息进行遍历，判断文件的扩展名是否是.xlsx或.xls，如果是则继续处理，否则跳过该文件。</li>
<li>使用FileStream打开Excel文件流，并使用ExcelReaderFactory.CreateOpenXmlReader方法创建一个IExcelDataReader实例Excel文件数据对象excelReader。</li>
<li>将Excel文件数据对象读取为DataSet对象，并获取其中的数据表集合，将其赋值给tableConllection。关闭文件流。</li>
<li>遍历tableConllection中的每个数据表table，输出当前表格的名称，即Debug.Log(table.TableName)。之后遍历表的每条循环中，根据表格数据生成数据结构类，容器类和二进制数据。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateExcelInfo</span>()</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//遍历所有文件</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; files.Length; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//如果不是excel文件就不要处理了</span></span><br><span class="line">        <span class="keyword">if</span> (files[i].Extension != <span class="string">&quot;.xlsx&quot;</span> &amp;&amp;</span><br><span class="line">            files[i].Extension != <span class="string">&quot;.xls&quot;</span>)</span><br><span class="line">            <span class="keyword">continue</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//打开一个 Excel 文件并获取其中的所有表的数据</span></span><br><span class="line">        <span class="keyword">using</span> (FileStream fs = files[i].Open(FileMode.Open, FileAccess.Read))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//创建 ExcelDataReader 实例 调用ExcelReaderFactory的CreateOpenXmlReader方法读取文件流</span></span><br><span class="line">            IExcelDataReader excelReader = ExcelReaderFactory.CreateOpenXmlReader(fs);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//将 Excel 数据读取为 DataSet 对象，并获取其中的数据表集合</span></span><br><span class="line">            tableConllection = excelReader.AsDataSet().Tables;</span><br><span class="line"></span><br><span class="line">            fs.Close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//遍历文件中的所有表的信息</span></span><br><span class="line">        <span class="keyword">foreach</span> (DataTable table <span class="keyword">in</span> tableConllection)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(table.TableName);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//生成数据结构类</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//生成容器类</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//生成2进制数据</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p>注意：</p>
<ul>
<li>excelReader.AsDataSet()得到的是DataSet 代表整个Excel文件的数据</li>
<li>excelReader.AsDataSet().Tables得到的是tableConllection tableConllection是DataTable集合 代表的是一个是Excel文件中的子表集合</li>
</ul>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/%E4%BA%8C%E8%BF%9B%E5%88%B6_Table%E8%A1%A8%E6%A0%BC_%E5%AD%90%E8%A1%A8.png" class="" title="二进制_Table表格_子表"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<ul>
<li>比如PlayerInfo_1和PlayerInfo_2都算一个子表 对应数据结构是一个DataTable</li>
</ul>
<p><strong><font size="4">生成Excel数据结构类</font></strong></p>
<p><strong><font size="3">创建生成Excel表对应的数据结构类函数</font></strong></p>
<ul>
<li>在生成Excel信息函数的遍历表循环中调用</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateExcelInfo</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//......................</span></span><br><span class="line">      <span class="keyword">foreach</span> (DataTable table <span class="keyword">in</span> tableConllection)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(table.TableName);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 生成数据结构类</span></span><br><span class="line">            GenerateExcelDataClass(table);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//生成容器类</span></span><br><span class="line"></span><br><span class="line">            <span class="comment">//生成2进制数据</span></span><br><span class="line">        &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateExcelDataClass</span>(<span class="params">DataTable table</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">创建获取变量名所在行函数和获取变量类型所在行函数</font></strong></p>
<ul>
<li>分别返回第0行和第1行，在生成Excel表对应的数据结构类函数中调用。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 生成Excel表对应的数据结构类</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;table&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateExcelDataClass</span>(<span class="params">DataTable table</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 字段名行</span></span><br><span class="line">    DataRow rowName = GetVariableNameRow(table);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 字段类型行</span></span><br><span class="line">    DataRow rowType = GetVariableTypeRow(table);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取变量名所在行</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;table&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> DataRow <span class="title">GetVariableNameRow</span>(<span class="params">DataTable table</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> table.Rows[<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取变量类型所在行</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;table&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> DataRow <span class="title">GetVariableTypeRow</span>(<span class="params">DataTable table</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">return</span> table.Rows[<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">创建数据结构类脚本存储位置路径</font></strong></p>
<ul>
<li>在生成Excel表对应的数据结构类函数中判断数据结构类脚本存储位置路径是否存在，没有的话就创建文件夹</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 数据结构类脚本存储位置路径</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> DATA_CLASS_PATH = Application.dataPath + <span class="string">&quot;/Client//Scripts/Del/ExcelData/DataClass/&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateExcelDataClass</span>(<span class="params">DataTable table</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//..............</span></span><br><span class="line">    <span class="comment">// 判断路径是否存在，没有的话就创建文件夹</span></span><br><span class="line">    <span class="keyword">if</span> (!Directory.Exists(DATA_CLASS_PATH))</span><br><span class="line">        Directory.CreateDirectory(DATA_CLASS_PATH);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">在生成Excel表对应的数据结构类函数中用字符串逐个拼接出数据结构类和对应变量。</font></strong></p>
<ul>
<li>把拼接好的字符串存到指定文件中去。刷新Project窗口。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateExcelDataClass</span>(<span class="params">DataTable table</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//..............</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果我们要生成对应的数据结构类脚本，其实就是通过代码进行字符串拼接，然后存进文件就行了</span></span><br><span class="line">    <span class="built_in">string</span> str = <span class="string">&quot;public class &quot;</span> + table.TableName + <span class="string">&quot;\n&#123;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 遍历表的列 变量进行字符串拼接</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; table.Columns.Count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        str += <span class="string">&quot;    public &quot;</span> + rowType[i].ToString() + <span class="string">&quot; &quot;</span> + rowName[i].ToString() + <span class="string">&quot;;\n&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    str += <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 把拼接好的字符串存到指定文件中去</span></span><br><span class="line">    File.WriteAllText(DATA_CLASS_PATH + table.TableName + <span class="string">&quot;.cs&quot;</span>, str);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 刷新Project窗口</span></span><br><span class="line">    AssetDatabase.Refresh();</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">运行结果</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/%E4%BA%8C%E8%BF%9B%E5%88%B6_Excel%E8%A1%A8%E6%A0%BC%E6%9E%84%E9%80%A0%E7%B1%BB.png" class="" title="二进制_Excel表格构造类"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>

<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//PlayerInfo_1：</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInfo_1</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span>  name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> attack;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> defend;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//PlayerInfo_2：</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInfo_2</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> name;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> money;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> atk;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> atkRange;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">float</span> offsetTime;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> nextLev;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> imgRes;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> res;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">int</span> atkType;</span><br><span class="line">    <span class="keyword">public</span> <span class="built_in">string</span> eff;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong><font size="4">生成包含字典的容器类</font></strong></p>
<p><strong><font size="3">定义容器类脚本存储位置路径</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 容器类脚本存储位置路径</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> DATA_CONTAINER_PATH = Application.dataPath + <span class="string">&quot;/Client/Scripts/Del/ExcelData/Container/&quot;</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>


<p><strong><font size="3">创建生成Excel表对应的数据容器类函数</font></strong></p>
<ul>
<li>在生成Excel信息的菜单项函数调用</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateExcelInfo</span>()</span></span><br><span class="line"> &#123;</span><br><span class="line">     <span class="comment">//......................</span></span><br><span class="line">      <span class="keyword">foreach</span> (DataTable table <span class="keyword">in</span> tableConllection)</span><br><span class="line">         &#123;</span><br><span class="line">             Debug.Log(table.TableName);</span><br><span class="line"></span><br><span class="line">             <span class="comment">// 生成数据结构类</span></span><br><span class="line">             GenerateExcelDataClass(table);</span><br><span class="line"></span><br><span class="line">             <span class="comment">//生成容器类</span></span><br><span class="line">             GenerateExcelContainer(table);</span><br><span class="line">             <span class="comment">//生成2进制数据</span></span><br><span class="line">         &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"> <span class="comment"><span class="doctag">///</span> 生成Excel表对应的数据容器类</span></span><br><span class="line"> <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"> <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;table&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"> <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateExcelContainer</span>(<span class="params">DataTable table</span>)</span></span><br><span class="line"> &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">创建获取主键索引函数，方便等一下在生成Excel表对应的数据容器类函数调用。</font></strong></p>
<ul>
<li>获取表的第三行数据（索引从0开始），即字段类型所在行，遍历表的所有列，判断当前列的值是否等于”key”，如果是主键列，则返回列索引， 如果没有找到主键列，则返回默认值0。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 获取主键索引</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;table&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span> // 传入一个DataTable对象，表示数据表</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span><span class="doctag">&lt;/returns&gt;</span> // 返回一个整型值，表示主键所在的列索引</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">int</span> <span class="title">GetKeyIndex</span>(<span class="params">DataTable table</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获取表的第三行数据（索引从0开始），即字段类型所在行</span></span><br><span class="line">    DataRow row = table.Rows[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 遍历表的所有列</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; table.Columns.Count; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 判断当前列的值是否等于&quot;key&quot;，即判断是否是主键列</span></span><br><span class="line">        <span class="keyword">if</span> (row[i].ToString() == <span class="string">&quot;key&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> i; <span class="comment">// 如果是主键列，则返回列索引</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果没有找到主键列，则返回默认值0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">在生成Excel表对应的数据容器类函数中，通过获取主键索引函数获得组件索引。 </font></strong></p>
<ul>
<li>获取字段类型所在行。判断容器存储路径存不存在，如果路径不存在，则创建路径。</li>
<li>字符串拼接容器类，导入所需命名空间，生成数据容器类的代码字符串，声明数据字典并初始化。</li>
<li>将代码字符串写入文件，文件名为表名加上”Container.cs”。</li>
<li>刷新Unity的Project窗口。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 生成Excel表对应的数据容器类</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;table&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateExcelContainer</span>(<span class="params">DataTable table</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获取主键索引</span></span><br><span class="line">    <span class="built_in">int</span> keyIndex = GetKeyIndex(table);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获取字段类型所在行</span></span><br><span class="line">    DataRow rowType = GetVariableTypeRow(table);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 如果路径不存在，则创建路径</span></span><br><span class="line">    <span class="keyword">if</span> (!Directory.Exists(DATA_CONTAINER_PATH))</span><br><span class="line">        Directory.CreateDirectory(DATA_CONTAINER_PATH);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 导入所需命名空间</span></span><br><span class="line">    <span class="built_in">string</span> str = <span class="string">&quot;using System.Collections.Generic;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 生成数据容器类的代码字符串</span></span><br><span class="line">    str += <span class="string">&quot;public class &quot;</span> + table.TableName + <span class="string">&quot;Container&quot;</span> + <span class="string">&quot;\n&#123;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 声明数据字典并初始化</span></span><br><span class="line">    str += <span class="string">&quot;    &quot;</span>;</span><br><span class="line">    str += <span class="string">&quot;public Dictionary&lt;&quot;</span> + rowType[keyIndex].ToString() + <span class="string">&quot;, &quot;</span> + table.TableName + <span class="string">&quot;&gt;&quot;</span>;</span><br><span class="line">    str += <span class="string">&quot;dataDic = new &quot;</span> + <span class="string">&quot;Dictionary&lt;&quot;</span> + rowType[keyIndex].ToString() + <span class="string">&quot;, &quot;</span> + table.TableName + <span class="string">&quot;&gt;();\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    str += <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 将代码字符串写入文件，文件名为表名加上&quot;Container.cs&quot;</span></span><br><span class="line">    File.WriteAllText(DATA_CONTAINER_PATH + table.TableName + <span class="string">&quot;Container.cs&quot;</span>, str);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 刷新Unity的Project窗口</span></span><br><span class="line">    AssetDatabase.Refresh();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">运行结果</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/%E4%BA%8C%E8%BF%9B%E5%88%B6_Excel%E8%A1%A8%E6%A0%BC%E6%9E%84%E9%80%A0%E5%AD%97%E5%85%B8.png" class="" title="二进制_Excel表格构造字典"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>


<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//PlayerInfo_1Container：</span></span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInfo_1Container</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">int</span>, PlayerInfo_1&gt;dataDic = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">int</span>, PlayerInfo_1&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//PlayerInfo_2Container：</span></span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">PlayerInfo_2Container</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">public</span> Dictionary&lt;<span class="built_in">int</span>, PlayerInfo_2&gt;dataDic = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">int</span>, PlayerInfo_2&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="4">生成二进制数据文件</font></strong></p>
<p><strong><font size="3">声明2进制数据存储位置路径和真正内容开始的行号</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> DATA_BINARY_PATH = Application.streamingAssetsPath + <span class="string">&quot;/Binary/&quot;</span>;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">int</span> BEGIN_INDEX = <span class="number">4</span>;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">创建生成excel2进制数据函数</font></strong></p>
<ul>
<li>在生成Excel信息的菜单项函数调用</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateExcelInfo</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//......................</span></span><br><span class="line">     <span class="keyword">foreach</span> (DataTable table <span class="keyword">in</span> tableConllection)</span><br><span class="line">        &#123;</span><br><span class="line">            Debug.Log(table.TableName);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 生成数据结构类</span></span><br><span class="line">            GenerateExcelDataClass(table);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//生成容器类</span></span><br><span class="line">            GenerateExcelContainer(table);</span><br><span class="line">            <span class="comment">//生成2进制数据</span></span><br><span class="line">            GenerateExcelBinary(table);</span><br><span class="line">        &#125;</span><br><span class="line">   </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 生成excel2进制数据</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;table&quot;&gt;</span><span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateExcelBinary</span>(<span class="params">DataTable table</span>)</span></span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>检查二进制路径是否存在，如果不存在则创建二进制路径。</li>
<li>创建一个二进制文件进行写入，文件名由表格的名称和后缀组成。</li>
<li>写入数据行数（减去4是因为前面4行是配置规则，不是需要记录的数据内容）。</li>
<li>存储主键变量名，将字符串转换为字节数组，并写入字节数组的长度和内容。</li>
<li>遍历所有数据行，获取每一行的数据。获取类型行，根据类型来决定如何写入数据。</li>
<li>根据类型进行相应的写入操作：如果是整数类型，将整数值转换为字节数组，并写入4个字节。如果是浮点数类型，将浮点数值转换为字节数组，并写入4个字节。如果是布尔类型，将布尔值转换为字节数组，并写入1个字节。如果是字符串类型，将字符串转换为字节数组，并依次写入字节数组的长度和内容。关闭文件流。</li>
<li>刷新项目窗口。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">GenerateExcelBinary</span>(<span class="params">DataTable table</span>)</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 检查路径是否存在，不存在则创建路径</span></span><br><span class="line">    <span class="keyword">if</span> (!Directory.Exists(DATA_BINARY_PATH))</span><br><span class="line">        Directory.CreateDirectory(DATA_BINARY_PATH);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 创建一个二进制文件进行写入</span></span><br><span class="line">    <span class="keyword">using</span> (FileStream fs = <span class="keyword">new</span> FileStream(DATA_BINARY_PATH + table.TableName + <span class="string">&quot;.tao&quot;</span>, FileMode.OpenOrCreate, FileAccess.Write))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 存储具体的excel对应的二进制信息</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1. 先存储数据行数，方便读取</span></span><br><span class="line">        <span class="comment">// -4 的原因是前面4行是配置规则，不是我们需要记录的数据内容</span></span><br><span class="line">        fs.Write(BitConverter.GetBytes(table.Rows.Count - <span class="number">4</span>), <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 存储主键变量名</span></span><br><span class="line">        <span class="built_in">string</span> keyName = GetVariableNameRow(table)[GetKeyIndex(table)].ToString();<span class="comment">//id</span></span><br><span class="line">        <span class="built_in">byte</span>[] bytes = Encoding.UTF8.GetBytes(keyName);</span><br><span class="line">        <span class="comment">// 存储字符串字节数组的长度</span></span><br><span class="line">        fs.Write(BitConverter.GetBytes(bytes.Length), <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">        <span class="comment">// 存储字符串字节数组</span></span><br><span class="line">        fs.Write(bytes, <span class="number">0</span>, bytes.Length);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 遍历所有内容的行进行二进制写入</span></span><br><span class="line">        DataRow row;</span><br><span class="line">        <span class="comment">// 得到类型行，根据类型来决定如何写入数据</span></span><br><span class="line">        DataRow rowType = GetVariableTypeRow(table);</span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = BEGIN_INDEX; i &lt; table.Rows.Count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 得到一行的数据</span></span><br><span class="line">            row = table.Rows[i];</span><br><span class="line">            <span class="keyword">for</span> (<span class="built_in">int</span> j = <span class="number">0</span>; j &lt; table.Columns.Count; j++)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">switch</span> (rowType[j].ToString())</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;int&quot;</span>:</span><br><span class="line">                        fs.Write(BitConverter.GetBytes(<span class="built_in">int</span>.Parse(row[j].ToString())), <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;float&quot;</span>:</span><br><span class="line">                        fs.Write(BitConverter.GetBytes(<span class="built_in">float</span>.Parse(row[j].ToString())), <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;bool&quot;</span>:</span><br><span class="line">                        fs.Write(BitConverter.GetBytes(<span class="built_in">bool</span>.Parse(row[j].ToString())), <span class="number">0</span>, <span class="number">1</span>);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    <span class="keyword">case</span> <span class="string">&quot;string&quot;</span>:</span><br><span class="line">                        bytes = Encoding.UTF8.GetBytes(row[j].ToString());</span><br><span class="line">                        <span class="comment">// 写入字符串字节数组的长度</span></span><br><span class="line">                        fs.Write(BitConverter.GetBytes(bytes.Length), <span class="number">0</span>, <span class="number">4</span>);</span><br><span class="line">                        <span class="comment">// 写入字符串字节数组</span></span><br><span class="line">                        fs.Write(bytes, <span class="number">0</span>, bytes.Length);</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        fs.Close();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 刷新Project窗口</span></span><br><span class="line">    AssetDatabase.Refresh();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">查看二进制数据文件是否生成成功</font></strong></p>
<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/%E4%BA%8C%E8%BF%9B%E5%88%B6_%E7%94%9F%E6%88%90%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6.png" class="" title="二进制_生成二进制数据文件"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>


<p><strong><font size="4">二进制数据管理器使用Excel数据</font></strong></p>
<p><strong><font size="3">导入二进制数据管理器</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">using</span> System.Collections;</span><br><span class="line"><span class="keyword">using</span> System.Collections.Generic;</span><br><span class="line"><span class="keyword">using</span> System.IO;</span><br><span class="line"><span class="keyword">using</span> System.Runtime.Serialization.Formatters.Binary;</span><br><span class="line"><span class="keyword">using</span> UnityEngine;</span><br><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 二进制数据管理器</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">BinaryDataMgr</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> BinaryDataMgr instance = <span class="keyword">new</span> BinaryDataMgr();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> BinaryDataMgr Instance =&gt; instance;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">BinaryDataMgr</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 数据存储路径</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="built_in">string</span> SAVE_PATH = Application.persistentDataPath + <span class="string">&quot;/Data/&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 存储类对象数据</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;obj&quot;&gt;</span>要保存的对象<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;fileName&quot;&gt;</span>文件名<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Save</span>(<span class="params"><span class="built_in">object</span> obj, <span class="built_in">string</span> fileName</span>)</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 先判断路径文件夹是否存在，如果不存在则创建</span></span><br><span class="line">        <span class="keyword">if</span> (!Directory.Exists(SAVE_PATH))</span><br><span class="line">            Directory.CreateDirectory(SAVE_PATH);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用 FileStream 创建一个文件流，并指定打开或创建文件的方式</span></span><br><span class="line">        <span class="keyword">using</span> (FileStream fs = <span class="keyword">new</span> FileStream(SAVE_PATH + fileName + <span class="string">&quot;.tao&quot;</span>, FileMode.OpenOrCreate, FileAccess.Write))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 创建 BinaryFormatter 对象用于序列化数据</span></span><br><span class="line">            BinaryFormatter bf = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将对象 obj 序列化到文件流中</span></span><br><span class="line">            bf.Serialize(fs, obj);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 关闭文件流</span></span><br><span class="line">            fs.Close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> 从二进制数据文件中读取并转换为指定类型的对象</span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span>对象类型<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;param name=&quot;fileName&quot;&gt;</span>文件名<span class="doctag">&lt;/param&gt;</span></span></span><br><span class="line">    <span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>读取到的对象<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> T <span class="title">Load</span>&lt;<span class="title">T</span>&gt;(<span class="params"><span class="built_in">string</span> fileName</span>) <span class="keyword">where</span> T : <span class="keyword">class</span></span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">// 如果文件不存在，则直接返回指定类型对象的默认值</span></span><br><span class="line">        <span class="keyword">if</span> (!File.Exists(SAVE_PATH + fileName + <span class="string">&quot;.tao&quot;</span>))</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">default</span>(T);</span><br><span class="line"></span><br><span class="line">        T obj;</span><br><span class="line">        <span class="comment">// 使用 FileStream 打开文件流，并指定打开文件的方式为只读</span></span><br><span class="line">        <span class="keyword">using</span> (FileStream fs = File.Open(SAVE_PATH + fileName + <span class="string">&quot;.tao&quot;</span>, FileMode.Open, FileAccess.Read))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">// 创建 BinaryFormatter 对象用于反序列化数据</span></span><br><span class="line">            BinaryFormatter bf = <span class="keyword">new</span> BinaryFormatter();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 将文件流中的数据反序列化为指定类型的对象</span></span><br><span class="line">            obj = bf.Deserialize(fs) <span class="keyword">as</span> T;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 关闭文件流</span></span><br><span class="line">            fs.Close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> obj;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">在BinaryDataMgr创建用于存储所有Excel表数据的容器字典</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 用于存储所有Excel表数据的容器</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">private</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">object</span>&gt; tableDic = <span class="keyword">new</span> Dictionary&lt;<span class="built_in">string</span>, <span class="built_in">object</span>&gt;();</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">在BinaryDataMgr创建用于2进制数据存储位置路径</font></strong></p>
<ul>
<li>可以从ExcelTool剪切过来。</li>
<li>在ExcelTool加个前缀引用解决报错。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 2进制数据存储位置路径</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="built_in">string</span> DATA_BINARY_PATH = Application.streamingAssetsPath + <span class="string">&quot;/Binary/&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">在BinaryDataMgr中，创建加载Excel表的2进制数据到内存中函数</font></strong></p>
<ul>
<li>要传入泛型参数分别为容器类类名和数据结构类类名使用FileStream打开Excel表对应的二进制文件，以只读方式打开，并使用using语句确保文件流正确关闭。</li>
<li>创建一个字节数组bytes，长度为文件流的长度，然后将文件流中的数据读取到bytes数组中。</li>
<li>关闭文件流。</li>
<li>声明一个变量index，表示当前读取的字节数。</li>
<li>通过BitConverter.ToInt32方法从bytes数组中读取一个int类型的值取名count，表示需要读取多少行数据，并将index增加4（int类型占用4个字节）。</li>
<li>通过BitConverter.ToInt32方法从bytes数组中读取一个int类型的值，表示主键名字的长度，并将index增加4。</li>
<li>根据主键名字的长度和index，使用Encoding.UTF8.GetString方法将bytes数组中的数据转换为字符串形式的主键名字，并将index增加主键名字的长度。</li>
<li>获取泛型参数T所代表的容器类的Type。</li>
<li>使用反射创建泛型参数T所代表的容器类的对象。</li>
<li>获取泛型参数K所代表的数据结构类的Type。</li>
<li>使用反射获取泛型参数K所代表的数据结构类的所有字段信息。</li>
<li>遍历从0到count-1的循环，表示一共要读取count行的数据。</li>
<li>使用反射创建泛型参数K所代表的数据结构类的对象。</li>
<li>遍历数据结构类的所有字段信息。根据字段类型的不同，使用相应的BitConverter.ToXXX方法从bytes数组中读取值，并将index增加对应的字节数。</li>
<li>将读取到的值赋给数据结构类的对应字段。</li>
<li>获取容器对象中的字典字段dataDic，并通过反射获取其中的Add方法。</li>
<li>通过反射获取数据结构类对象中指定主键字段的值。</li>
<li>调用Add方法，将主键值和数据结构类对象作为参数，向字典中添加数据。</li>
<li>将读取完的表格存储到tableDic中，以容器类名作为Key，容器对象作为值。</li>
<li>关闭文件流。</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 加载Excel表的2进制数据到内存中 </span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span>容器类名<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;K&quot;&gt;</span>数据结构类类名<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">LoadTable</span>&lt;<span class="title">T</span>,<span class="title">K</span>&gt;()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">//读取 对应路径下 excel表对应的2进制文件 来进行解析</span></span><br><span class="line">    <span class="keyword">using</span> (FileStream fs = File.Open(DATA_BINARY_PATH + <span class="keyword">typeof</span>(K).Name + <span class="string">&quot;.tao&quot;</span>, FileMode.Open, FileAccess.Read))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//把所有的文件流数据存到直接数组综合</span></span><br><span class="line">        <span class="built_in">byte</span>[] bytes = <span class="keyword">new</span> <span class="built_in">byte</span>[fs.Length];</span><br><span class="line">        fs.Read(bytes, <span class="number">0</span>, bytes.Length);</span><br><span class="line">        fs.Close();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//标识 用于记录当前读取了多少字节了</span></span><br><span class="line">        <span class="built_in">int</span> index = <span class="number">0</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//读取一个要读多少行数据</span></span><br><span class="line">        <span class="built_in">int</span> count = BitConverter.ToInt32(bytes, index);</span><br><span class="line">        <span class="comment">//读了一个int 序号标识要加四个字节</span></span><br><span class="line">        index += <span class="number">4</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//读取主键的名字</span></span><br><span class="line">        <span class="comment">//想读取主键的长度</span></span><br><span class="line">        <span class="built_in">int</span> keyNameLength = BitConverter.ToInt32(bytes, index);</span><br><span class="line">        <span class="comment">//读了一个int 序号标识要加四个字节</span></span><br><span class="line">        index += <span class="number">4</span>;</span><br><span class="line">        <span class="comment">//根据主键的长度在读取主键名字</span></span><br><span class="line">        <span class="built_in">string</span> keyName = Encoding.UTF8.GetString(bytes, index, keyNameLength);</span><br><span class="line">        <span class="comment">//序号标识要加上主键的长度</span></span><br><span class="line">        index += keyNameLength;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//创建容器类对象</span></span><br><span class="line">        <span class="comment">//得到容器类的Type</span></span><br><span class="line">        Type contaninerType = <span class="keyword">typeof</span>(T);</span><br><span class="line">        <span class="comment">//用反射方法根据类创建容器对象</span></span><br><span class="line">        <span class="built_in">object</span> contaninerObj = Activator.CreateInstance(contaninerType);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//得到数据结构类的Type</span></span><br><span class="line">        Type classType = <span class="keyword">typeof</span>(K);</span><br><span class="line">        <span class="comment">//通过反射 得到数据结构类 所有字段的信息</span></span><br><span class="line">        FieldInfo[] infos = classType.GetFields();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//读取每一行的信息</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="built_in">int</span> i = <span class="number">0</span>; i &lt; count; i++)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="comment">//实例化一个数据结构类 对象</span></span><br><span class="line">            <span class="built_in">object</span> dataObj = Activator.CreateInstance(classType);</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//遍历所有字段信息 </span></span><br><span class="line">            <span class="keyword">foreach</span> (FieldInfo info <span class="keyword">in</span> infos)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>( info.FieldType == <span class="keyword">typeof</span>(<span class="built_in">int</span>) )</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//相当于就是把2进制数据转为int 然后赋值给了实例化一个数据结构类的对象的对应的字段</span></span><br><span class="line">                    info.SetValue(dataObj, BitConverter.ToInt32(bytes, index));</span><br><span class="line">                    index += <span class="number">4</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (info.FieldType == <span class="keyword">typeof</span>(<span class="built_in">float</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    info.SetValue(dataObj, BitConverter.ToSingle(bytes, index));</span><br><span class="line">                    index += <span class="number">4</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (info.FieldType == <span class="keyword">typeof</span>(<span class="built_in">bool</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    info.SetValue(dataObj, BitConverter.ToBoolean(bytes, index));</span><br><span class="line">                    index += <span class="number">1</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (info.FieldType == <span class="keyword">typeof</span>(<span class="built_in">string</span>))</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="comment">//读取字符串字节数组的长度</span></span><br><span class="line">                    <span class="built_in">int</span> length = BitConverter.ToInt32(bytes, index);</span><br><span class="line">                    index += <span class="number">4</span>;</span><br><span class="line">                    <span class="comment">//根据字符串长度在读字符串</span></span><br><span class="line">                    info.SetValue(dataObj, Encoding.UTF8.GetString(bytes, index, length));</span><br><span class="line">                    index += length;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">//读取完一行的数据了 应该把这个数据添加到容器对象中</span></span><br><span class="line">            </span><br><span class="line">            <span class="comment">//得到容器对象中的 字典对象这个字段</span></span><br><span class="line">            <span class="built_in">object</span> dicObject = contaninerType.GetField(<span class="string">&quot;dataDic&quot;</span>).GetValue(contaninerObj);</span><br><span class="line">            <span class="comment">//通过字典对象得到其中的 Add方法</span></span><br><span class="line">            MethodInfo mInfo = dicObject.GetType().GetMethod(<span class="string">&quot;Add&quot;</span>);</span><br><span class="line">            <span class="comment">//得到数据结构类对象中 指定主键字段的值 先得到数据结构类的 在得到数据结构类的主键 在得到主键的值</span></span><br><span class="line">            <span class="built_in">object</span> keyValue = classType.GetField(keyName).GetValue(dataObj);</span><br><span class="line">            <span class="comment">//调用Add方法 传入字典对象 和字典的key还有具体要存储的一条数据对象</span></span><br><span class="line">            mInfo.Invoke(dicObject, <span class="keyword">new</span> <span class="built_in">object</span>[] &#123; keyValue, dataObj &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//把读取完的表记录下来 传入容器名作为Key 容器对象做为值</span></span><br><span class="line">        tableDic.Add(<span class="keyword">typeof</span>(T).Name, contaninerObj);</span><br><span class="line">        </span><br><span class="line">        fs.Close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">在BinaryDataMgr可以创建初始化方法初始化数据</font></strong></p>
<ul>
<li>比如加载塔数据，也可以不写在这里</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">InitData</span>()</span></span><br><span class="line">&#123;</span><br><span class="line">    BinaryDataMgr.Instance.LoadTable&lt;TowerInfoContainer, TowerInfo&gt;();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><strong><font size="3">在BinaryDataMgr创建得到一张表的信息函数。</font></strong></p>
<ul>
<li>传入容器类名作为泛型，返回表信息出去。判断表字典中有没有包含表名，包含则转换为指定类型返回，不包含直接返回null</li>
</ul>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> 得到一张表的信息</span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;/summary&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;typeparam name=&quot;T&quot;&gt;</span>容器类名<span class="doctag">&lt;/typeparam&gt;</span></span></span><br><span class="line"><span class="comment"><span class="doctag">///</span> <span class="doctag">&lt;returns&gt;</span>返回指定类型的表信息<span class="doctag">&lt;/returns&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">public</span> T <span class="title">GetTable</span>&lt;<span class="title">T</span>&gt;() <span class="keyword">where</span> T:<span class="keyword">class</span></span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// 获取指定类型的表名</span></span><br><span class="line">    <span class="built_in">string</span> tableName = <span class="keyword">typeof</span>(T).Name;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 检查表字典中是否包含指定表名的项</span></span><br><span class="line">    <span class="keyword">if</span> (tableDic.ContainsKey(tableName))</span><br><span class="line">        <span class="comment">// 如果包含，则将该项转换为指定类型，并返回</span></span><br><span class="line">        <span class="keyword">return</span> tableDic[tableName] <span class="keyword">as</span> T;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 如果不包含，则返回null</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong><font size="3">可以在测试类中测试数据能不能拿到表数据</font></strong></p>
<figure class="highlight csharp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title">TestScript</span> : <span class="title">MonoBehaviour</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">Start</span>()</span></span><br><span class="line">    &#123;</span><br><span class="line">        <span class="comment">//BinaryDataMgr.Instance.InitData();</span></span><br><span class="line">        BinaryDataMgr.Instance.LoadTable&lt;PlayerInfo_2Container, PlayerInfo_2&gt;();</span><br><span class="line">        PlayerInfo_2Container data = BinaryDataMgr.Instance.GetTable&lt;PlayerInfo_2Container&gt;();</span><br><span class="line">        print(data.dataDic[<span class="number">5</span>].name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<img src="/L_Study.github.io/2025/08/24/Unity%E6%95%B0%E6%8D%AE%E6%8C%81%E4%B9%85%E5%8C%96/%E4%BA%8C%E8%BF%9B%E5%88%B6_%E5%BE%97%E5%88%B0%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%95%B0%E6%8D%AE%E6%96%87%E4%BB%B6%E4%B8%AD%E7%9A%84%E8%A1%A8%E6%95%B0%E6%8D%AE.png" class="" title="二进制_得到二进制数据文件中的表数据"  data-tag='post-image' onload='this.onload=null;this.style.opacity=1;' onerror='this.onerror=null;this.src="/L_Study.github.io/img/404.jpg"'>






</article>
    
    

</div>
<div class="trm-post-next-prev row">
    <div class="col-lg-12">
        <!-- title -->
        <h5 class="trm-title-with-divider">
            其他文章
            <span data-number="02"></span>
        </h5>
    </div>
    
    
        <div class="col-lg-6">
    <div class="trm-blog-card trm-scroll-animation">
        <a href="/L_Study.github.io/2025/03/14/Unity%E6%A0%B8%E5%BF%83/" class="trm-cover-frame trm-anima-link">
            
            
                <img alt="cover" class="no-fancybox" src="/L_Study.github.io/img/block.jpg">
            
        </a>
        
        <div class="trm-card-descr">
            <div class="trm-label trm-category trm-mb-20">
                <a href=" /L_Study.github.io/categories/Unity/">
                    Unity
                </a>
            </div>
            <h5>
                <a href="/L_Study.github.io/2025/03/14/Unity%E6%A0%B8%E5%BF%83/" class="trm-anima-link">
                    Unity核心
                </a>
            </h5>
            <div class="trm-divider trm-mb-20 trm-mt-20"></div>
            <ul class="trm-card-data trm-label">
                <li>25/03/14</li>
                <li>22:57</li>
                
                
            </ul>
        </div>
    </div>
</div>
    
</div>

    



                    <div class="trm-divider footer-divider"></div>

                    <!-- footer -->
                    <footer class="trm-footer-card trm-scroll-animation">

    

    

    
        <div class="trm-footer-item">
            <span>
                由 <a href="https://hexo.io" target="_blank" rel="noopener">Hexo</a> 驱动 v7.3.0
            </span>
            <span class="footer-separator" data-separator=" | "></span>
            <span> 
                主题 - 
                <a rel="noopener" href='https://github.com/MaLuns/hexo-theme-async' target='_blank'>Async</a>
                v2.2.4
            </span>
        </div>
      

     

     
</footer>
                    <!-- footer end -->

                </div>
            </div>
        </div>
    </div>
</div>
            <!-- body end -->

            

    <div id="post-toc" class="trm-post-toc">
      <div class="trm-post-toc-header">
        目录导航
				<span id="post-toc-top">
					置顶
				</span>
      </div>
      <div class="trm-post-toc-content">
        <ol class="trm-toc"><li class="trm-toc-item trm-toc-level-1" title="Unity数据持久化"><a rel="nofollow" class="trm-toc-link" href="#Unity数据持久化"><span class="trm-toc-number">1.</span> <span class="trm-toc-text">Unity数据持久化</span></a></li><li class="trm-toc-item trm-toc-level-1" title="PlayerPrefs"><a rel="nofollow" class="trm-toc-link" href="#PlayerPrefs"><span class="trm-toc-number">2.</span> <span class="trm-toc-text">PlayerPrefs</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="PlayerPrefs基础知识概述"><a rel="nofollow" class="trm-toc-link" href="#PlayerPrefs基础知识概述"><span class="trm-toc-number">2.1.</span> <span class="trm-toc-text">PlayerPrefs基础知识概述</span></a></li><li class="trm-toc-item trm-toc-level-2" title="基本方法"><a rel="nofollow" class="trm-toc-link" href="#基本方法"><span class="trm-toc-number">2.2.</span> <span class="trm-toc-text">基本方法</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="练习题"><a rel="nofollow" class="trm-toc-link" href="#练习题"><span class="trm-toc-number">2.2.1.</span> <span class="trm-toc-text">练习题</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="不同平台的存储位置"><a rel="nofollow" class="trm-toc-link" href="#不同平台的存储位置"><span class="trm-toc-number">2.3.</span> <span class="trm-toc-text">不同平台的存储位置</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="练习题"><a rel="nofollow" class="trm-toc-link" href="#练习题-1"><span class="trm-toc-number">2.3.1.</span> <span class="trm-toc-text">练习题</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="PlayerPrefs基础知识总结"><a rel="nofollow" class="trm-toc-link" href="#PlayerPrefs基础知识总结"><span class="trm-toc-number">2.4.</span> <span class="trm-toc-text">PlayerPrefs基础知识总结</span></a></li><li class="trm-toc-item trm-toc-level-2" title="PlayerPrefs实践项目"><a rel="nofollow" class="trm-toc-link" href="#PlayerPrefs实践项目"><span class="trm-toc-number">2.5.</span> <span class="trm-toc-text">PlayerPrefs实践项目</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="XML"><a rel="nofollow" class="trm-toc-link" href="#XML"><span class="trm-toc-number">3.</span> <span class="trm-toc-text">XML</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="XML基础知识概述"><a rel="nofollow" class="trm-toc-link" href="#XML基础知识概述"><span class="trm-toc-number">3.1.</span> <span class="trm-toc-text">XML基础知识概述</span></a></li><li class="trm-toc-item trm-toc-level-2" title="XML基本语法"><a rel="nofollow" class="trm-toc-link" href="#XML基本语法"><span class="trm-toc-number">3.2.</span> <span class="trm-toc-text">XML基本语法</span></a></li><li class="trm-toc-item trm-toc-level-2" title="XML属性"><a rel="nofollow" class="trm-toc-link" href="#XML属性"><span class="trm-toc-number">3.3.</span> <span class="trm-toc-text">XML属性</span></a></li><li class="trm-toc-item trm-toc-level-2" title="XML文件存放位置"><a rel="nofollow" class="trm-toc-link" href="#XML文件存放位置"><span class="trm-toc-number">3.4.</span> <span class="trm-toc-text">XML文件存放位置</span></a></li><li class="trm-toc-item trm-toc-level-2" title="读取XML文件"><a rel="nofollow" class="trm-toc-link" href="#读取XML文件"><span class="trm-toc-number">3.5.</span> <span class="trm-toc-text">读取XML文件</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="总结"><a rel="nofollow" class="trm-toc-link" href="#总结"><span class="trm-toc-number">3.5.1.</span> <span class="trm-toc-text">总结</span></a></li><li class="trm-toc-item trm-toc-level-3" title="练习题"><a rel="nofollow" class="trm-toc-link" href="#练习题-2"><span class="trm-toc-number">3.5.2.</span> <span class="trm-toc-text">练习题</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="存储和修改Xml文件"><a rel="nofollow" class="trm-toc-link" href="#存储和修改Xml文件"><span class="trm-toc-number">3.6.</span> <span class="trm-toc-text">存储和修改Xml文件</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="练习题"><a rel="nofollow" class="trm-toc-link" href="#练习题-3"><span class="trm-toc-number">3.6.1.</span> <span class="trm-toc-text">练习题</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="Xml基础知识总结"><a rel="nofollow" class="trm-toc-link" href="#Xml基础知识总结"><span class="trm-toc-number">3.7.</span> <span class="trm-toc-text">Xml基础知识总结</span></a></li><li class="trm-toc-item trm-toc-level-2" title="XML实践项目"><a rel="nofollow" class="trm-toc-link" href="#XML实践项目"><span class="trm-toc-number">3.8.</span> <span class="trm-toc-text">XML实践项目</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="Json"><a rel="nofollow" class="trm-toc-link" href="#Json"><span class="trm-toc-number">4.</span> <span class="trm-toc-text">Json</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="Json基础知识概述"><a rel="nofollow" class="trm-toc-link" href="#Json基础知识概述"><span class="trm-toc-number">4.1.</span> <span class="trm-toc-text">Json基础知识概述</span></a></li><li class="trm-toc-item trm-toc-level-2" title="Json基本语法"><a rel="nofollow" class="trm-toc-link" href="#Json基本语法"><span class="trm-toc-number">4.2.</span> <span class="trm-toc-text">Json基本语法</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="练习题"><a rel="nofollow" class="trm-toc-link" href="#练习题-4"><span class="trm-toc-number">4.2.1.</span> <span class="trm-toc-text">练习题</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="Excel转Json"><a rel="nofollow" class="trm-toc-link" href="#Excel转Json"><span class="trm-toc-number">4.3.</span> <span class="trm-toc-text">Excel转Json</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="练习题"><a rel="nofollow" class="trm-toc-link" href="#练习题-5"><span class="trm-toc-number">4.3.1.</span> <span class="trm-toc-text">练习题</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="JsonUtility"><a rel="nofollow" class="trm-toc-link" href="#JsonUtility"><span class="trm-toc-number">4.4.</span> <span class="trm-toc-text">JsonUtility</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="练习题"><a rel="nofollow" class="trm-toc-link" href="#练习题-6"><span class="trm-toc-number">4.4.1.</span> <span class="trm-toc-text">练习题</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="LitJson"><a rel="nofollow" class="trm-toc-link" href="#LitJson"><span class="trm-toc-number">4.5.</span> <span class="trm-toc-text">LitJson</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-3" title="练习题"><a rel="nofollow" class="trm-toc-link" href="#练习题-7"><span class="trm-toc-number">4.5.1.</span> <span class="trm-toc-text">练习题</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-2" title="JsonUtility和LitJson对比"><a rel="nofollow" class="trm-toc-link" href="#JsonUtility和LitJson对比"><span class="trm-toc-number">4.6.</span> <span class="trm-toc-text">JsonUtility和LitJson对比</span></a></li><li class="trm-toc-item trm-toc-level-2" title="Json实践项目"><a rel="nofollow" class="trm-toc-link" href="#Json实践项目"><span class="trm-toc-number">4.7.</span> <span class="trm-toc-text">Json实践项目</span></a></li></ol></li><li class="trm-toc-item trm-toc-level-1" title="Binary（二进制）"><a rel="nofollow" class="trm-toc-link" href="#Binary（二进制）"><span class="trm-toc-number">5.</span> <span class="trm-toc-text">Binary（二进制）</span></a><ol class="trm-toc-child"><li class="trm-toc-item trm-toc-level-2" title="各数据类型转字节数据"><a rel="nofollow" class="trm-toc-link" href="#各数据类型转字节数据"><span class="trm-toc-number">5.1.</span> <span class="trm-toc-text">各数据类型转字节数据</span></a></li><li class="trm-toc-item trm-toc-level-2" title="File文件类"><a rel="nofollow" class="trm-toc-link" href="#File文件类"><span class="trm-toc-number">5.2.</span> <span class="trm-toc-text">File文件类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="FileStrean文件流类"><a rel="nofollow" class="trm-toc-link" href="#FileStrean文件流类"><span class="trm-toc-number">5.3.</span> <span class="trm-toc-text">FileStrean文件流类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="Directory文件夹类、DirectoryInfo文件夹信息类和FileInfo文件信息类"><a rel="nofollow" class="trm-toc-link" href="#Directory文件夹类、DirectoryInfo文件夹信息类和FileInfo文件信息类"><span class="trm-toc-number">5.4.</span> <span class="trm-toc-text">Directory文件夹类、DirectoryInfo文件夹信息类和FileInfo文件信息类</span></a></li><li class="trm-toc-item trm-toc-level-2" title="Student类实现存储读取2进制"><a rel="nofollow" class="trm-toc-link" href="#Student类实现存储读取2进制"><span class="trm-toc-number">5.5.</span> <span class="trm-toc-text">Student类实现存储读取2进制</span></a></li><li class="trm-toc-item trm-toc-level-2" title="序列化二进制数据"><a rel="nofollow" class="trm-toc-link" href="#序列化二进制数据"><span class="trm-toc-number">5.6.</span> <span class="trm-toc-text">序列化二进制数据</span></a></li><li class="trm-toc-item trm-toc-level-2" title="反序列化二进制数据"><a rel="nofollow" class="trm-toc-link" href="#反序列化二进制数据"><span class="trm-toc-number">5.7.</span> <span class="trm-toc-text">反序列化二进制数据</span></a></li><li class="trm-toc-item trm-toc-level-2" title="二进制数据加密"><a rel="nofollow" class="trm-toc-link" href="#二进制数据加密"><span class="trm-toc-number">5.8.</span> <span class="trm-toc-text">二进制数据加密</span></a></li><li class="trm-toc-item trm-toc-level-2" title="二进制数据管理器"><a rel="nofollow" class="trm-toc-link" href="#二进制数据管理器"><span class="trm-toc-number">5.9.</span> <span class="trm-toc-text">二进制数据管理器</span></a></li><li class="trm-toc-item trm-toc-level-2" title="Binary基础知识总结"><a rel="nofollow" class="trm-toc-link" href="#Binary基础知识总结"><span class="trm-toc-number">5.10.</span> <span class="trm-toc-text">Binary基础知识总结</span></a></li><li class="trm-toc-item trm-toc-level-2" title="Binary（二进制）实践项目"><a rel="nofollow" class="trm-toc-link" href="#Binary（二进制）实践项目"><span class="trm-toc-number">5.11.</span> <span class="trm-toc-text">Binary（二进制）实践项目</span></a></li></ol></li></ol>
      </div>
    </div>

            
<div class="trm-fixed-container">
    
        <div class="trm-fixed-btn post-toc-btn" data-title="目录">
            <i class="iconfont fas fa-th-list"></i>
        </div>
    
    
        <div class="trm-fixed-btn" data-title="阅读模式" onclick="asyncFun.switchReadMode()">
            <i class="iconfont fas fa-book-reader"></i>
        </div>
    
    
        <div class="trm-fixed-btn hidden-md" data-title="单栏和双栏切换" onclick="asyncFun.switchSingleColumn()">
            <i class="iconfont fas fa-arrows-alt-h"></i>
        </div>
    
    <div id="trm-back-top" class="trm-fixed-btn" data-title="回到顶部">
        <i class="iconfont fas fa-arrow-up"></i>
    </div>
</div>
        </div>
      </div>
      <!-- scroll container end -->
  </div>
  <!-- app wrapper end -->

  
  <!-- Plugin -->




    
    
<script src="https://unpkg.com/@fancyapps/ui@4.0/dist/fancybox.umd.js"></script>

    

    
        <script src="/L_Study.github.io/js/plugins/typing.js?v=2.2.4"></script>
    

    

    <!-- 数学公式 -->
    

    <!-- 评论插件 -->
    
        

        
    

		




    <!-- Service Worker -->
    
    <!-- baidu push -->
    


<script id="async-script" src="/L_Study.github.io/js/main.js?v=2.2.4"></script>

<!-- CDN -->


    

    

    



</body>

</html>